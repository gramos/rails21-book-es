<!-- -*- coding: utf-8; -*- -->

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <link rel="stylesheet" type="text/css" href="../layout/second.css"/>
        <link rel="stylesheet" type="text/css" href="../layout/mac_classic.css"/>
</head>
<body>
        <div class="frontcover"></div>

        <div class="halftitlepage">
                <h1 class="no-toc">Ruby on Rails 2.1</h1>
                <h2 class="no-toc">¿Qué Hay de Nuevo?</h2>
                <h3 class="no-toc">Primer Edición</h3>
        </div>

        <div class="titlepage">
        <h1 class="no-toc">Ruby on Rails 2.1</h1>

        <h2 class="no-toc">¿Qué Hay de Nuevo?</h2>
        <h3 class="no-toc">Primer Edición</h3>

        <p class="no-toc">Carlos Brando<br/>Marcos Tapajós</p>
        <!-- also, the publisher's name would typically be printed here -->
        </div>

        <div class="imprint">
                <p>&copy; Copyright 2008 Carlos Brando. All Rights Reserved.</p>
                <br/>
                <p>Primer Edición: Junio 2008</p>
                <br/>
                <p>Carlos Brando<br/>Website: www.nomedojogo.com</p>
                <p>Marcos Tapajós<br/>Website: www.improveit.com.br/en/company/tapajos</p>
        </div>

        <!-- <div class="toc">
                <h1>Sumário</h1>
                #toc
        </div> -->

        <div class="chapter">
                <!-- -*- mode: markdown; coding: utf-8; -*- -->


<h1>Introducción</h1>

<p>Alrededor de julio de 2004 David Heinemeier Hansson lanzó la versión pública del framework Ruby on Rails, el cual surgió como consecuencia del desarrollo de una aplicación llamada Basecamp. Después de tres años, el 7 de Diciembre de 2007 se publicó Ruby on Rails 2.0 con una cantidad importante de cambios.</p>

<p>Seis meses después, y durante todo este tiempo han contribuido más de <strong>1400 desarrolladores</strong> alrededor de todo el mundo con <strong>1600 parches</strong> para el framework. Hoy, 1ero. Junio de 2008, se ha publicado la versión 2.1 del framework Ruby on Rails.</p>

<p>Según David las principales novedades de esta versión son:</p>

<ul>
<li>Timezones</li>
<li>Dirty tracking</li>
<li>Gem Dependencies</li>
<li>Named scope</li>
<li>UTC-based migrations</li>
<li>Better caching</li>
</ul>


<p>Como siempre, para actualizar o instalar la nueva versión:</p>

<pre class="mac_classic">    gem install rails
</pre>

<h2>Agradecimientos</h2>

<p>A Marcos Tapajós, co-autor de este libro. De no ser por él, no podrías estar leyendo este libro.</p>

<p>A Daniel Lopes quien hizo la hermosa tapa de esta edición.</p>

<p>A toda la comunidad Brazilera de Ruby on Rails que nos ayudó directa o indirectamente con este libro, comentando los artículos del blog o aconsejándonos. Como me gusta decir siempre, lo mejor de Rails es su comunidad! se mantiene creando, inventando, y especialmente compartiendo.</p>

<h2> Traductores</h2>

<p>Este libro fue orgullosamente traducido al inglés por estos chicos Brazileros:</p>

<p><strong>Pedro Pimentel</strong> - <a href="http://www.pedropimentel.com">http://www.pedropimentel.com</a></p>

<p>Capítulos 3-8 y 10-13</p>

<p><strong>Rafael Barbosa</strong> - <a href="http://www.act-as-newbie.com/">http://www.act-as-newbie.com</a></p>

<p>Introducción y capítulo 1</p>

<p><strong>Ricardo S Yasuda</strong> - <a href="http://blog.shadowmaru.org/">http://blog.shadowmaru.org</a></p>

<p>Capítulo 14</p>

<p><strong>Caike Souza</strong> - <a href="http://tech-death.blogspot.com/">http://tech-death.blogspot.com</a></p>

<p>Capítulo 2</p>

<p><strong>AbraÃ£o Coelho</strong> - <a href="http://abrcoelho.net/">http://abrcoelho.net</a></p>

<p>Capítulo 9
<!-- -*- coding: utf-8; -*- --></p>

<h1> ActiveRecord</h1>

<p>ActiveRecord es una capa de mapeo objeto-relacional (object-relational mapping layer) responsable tanto de la interoperabiliadad entre la aplicación y la base de datos como de la abstracción de los datos. (wikipedia)</p>

<!-- -*- coding: utf-8; -*- -->


<h2> El método <strong>sum</strong></h2>

<h3> Expresiones en el método <strong>sum</strong></h3>

<p>Ahora podemos usar expresiones en los métodos de cálculo de <strong>ActiveRecord</strong>, <strong>sum</strong>, por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Person</span>.<span class="FunctionName">sum</span>(<span class="String"><span class="String">&quot;</span>2 * age<span class="String">&quot;</span></span>)
</pre>

<h3> Cambiando el valor de retorno por defecto del método sum</h3>

<p>En las versiones previas, cuando usábamos el método <strong>sum</strong> de <strong>ActiveRecord</strong> para calcular la suma de una determinada columna para todos los registros de una tabla, si ningún registro correspondía con las condiciones expresadas en el método de invocación, entonces el valor de retorno por defecto era <strong>nil</strong>.</p>

<p>En Rails 2.1 el valor de retorno por defecto (cuando no se encuentra ningún registro) es 0. Vea el ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Account</span>.<span class="FunctionName">sum</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>balance</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; <span class="String"><span class="String">'</span>1 = 2<span class="String">'</span></span>) <span class="Comment"><span class="Comment">#</span>=&gt; 0</span>
</pre>

<!-- -*- coding: utf-8; -*- -->


<h2> Has_one</h2>

<h3> Soporte para la opción through</h3>

<p>El método <strong>has_one</strong> ahora tiene la opción <strong>through</strong>. Esta funciona como <strong>has_many :through</strong>, pero en este caso representa la asociación a un objeto simple <strong>ActiveRecord</strong>. Ejemplo:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Magazine<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>subscriptions</span>
    <span class="Keyword">end</span>

    <span class="Keyword">class</span> <span class="TypeName">Subscription<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>magazine</span>
      belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>user</span>
    <span class="Keyword">end</span>

    <span class="Keyword">class</span> <span class="TypeName">User<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>subscriptions</span>
      has_one <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>magazine</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>through</span> =&gt; : subscriptions,
                    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; [<span class="String"><span class="String">'</span>subscriptions.active = ?<span class="String">'</span></span>, <span class="BuiltInConstant">true</span>]
    <span class="Keyword">end</span>
</pre>

<h3> Has_one con :source_type</h3>

<p>El método <strong>has_one :through</strong> que acabamos de ver, puede también tomar <strong>:source_type</strong> como argumento. Voy a intentar explicar esto a través de algunos ejemplos. Vamos comenzar con estas dos clases:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Client<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>

      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contacts</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>through</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>
    <span class="Keyword">end</span>
</pre>

<p>Lo que estamos viendo hasta aquí es una clase <strong>Client</strong> la cual tiene muchos (<strong>has_many</strong>) tipos de contactos (<strong>contacts</strong>), ya que la clase <strong>ContactCard</strong> tiene una relación polimórfica.</p>

<p>Para seguir con nuestro ejemplo, vamos a crear dos clases que van a representar a <strong>ContactCard</strong>:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Person<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>as</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact</span>
    <span class="Keyword">end</span>

    <span class="Keyword">class</span> <span class="TypeName">Business<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>as</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact</span>
    <span class="Keyword">end</span>
</pre>

<p><strong>Person</strong> y <strong>Business</strong> están relacionadas con mi clase  <strong>Client</strong> a través de la tabla  <strong>ContactCard</strong>. En otras palabras, tengo dos tipos de contactos, personal y de negocios.</p>

<p>Por otro cuando intente recuperar un contacto esto no va a funcionar, veamos:</p>

<pre class="mac_classic">    <span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Client</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>).<span class="FunctionName">contacts</span>
<span class="Comment">    <span class="Comment">#</span> ArgumentError: /.../active_support/core_ext/hash/keys.rb:48:</span>
<span class="Comment">    <span class="Comment">#</span> in `assert_valid_keys': Unknown key(s): polymorphic</span>
</pre>

<p>Para que esto funcione tenemos que usar <strong>:source_type</strong>. Vamos cambiar nuestra clase  <strong>Client</strong>:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Client<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>people_contacts</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>through</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contacts</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source_type</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>person</span>

      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>business_contacts</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>through</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contacts</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source_type</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>business</span>
    <span class="Keyword">end</span>
</pre>

<p>Note que ahora tenemos dos maneras diferentes de recuperar nuestros contactos y podemos indicar que tipo de contacto <strong>:source_type</strong> esperamos.</p>

<pre class="mac_classic">    <span class="LibraryObject">Client</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>).<span class="FunctionName">people_contacts</span>
    <span class="LibraryObject">Client</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>).<span class="FunctionName">business_contacts</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Named_scope</h2>

<p>La gema  <em>has_finder</em>  ha sido incluida en Rails pero con un nombre diferente: <strong>named_scope</strong>.</p>

<p>Para entender lo que significa este agregado en Rails vamos a ver los siguientes ejemplos:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Article<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>published</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; {<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>published</span> =&gt; <span class="BuiltInConstant">true</span>}
      named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>containing_the_letter_a</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; <span class="String"><span class="String">&quot;</span>body LIKE '%a%â€™<span class="String">&quot;</span></span>
    <span class="Keyword">end</span>

    <span class="LibraryObject">Article</span>.<span class="FunctionName">published</span>.<span class="FunctionName">paginate</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>page</span> =&gt; <span class="Number">1</span>)
    <span class="LibraryObject">Article</span>.<span class="FunctionName">published</span>.<span class="FunctionName">containing_the_letter_a</span>.<span class="FunctionName">count</span>
    <span class="LibraryObject">Article</span>.<span class="FunctionName">containing_the_letter_a</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    <span class="LibraryObject">Article</span>.<span class="FunctionName">containing_the_letter_a</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; {â€¦})
</pre>

<p>En vez de crear un método nuevo llamado <strong>published</strong> para retornar todos los posts publicados, estoy usando un <strong>named_scope</strong> para que lo haga por mí. Pero puedo ir más allá que esto. Vamos a ver otro ejemplo para ver como se puede usar esto:</p>

<pre class="mac_classic">    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>written_before</span>, lambda { |<span class="Variable">time</span>|
      { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; [<span class="String"><span class="String">'</span>written_on &lt; ?<span class="String">'</span></span>, time] }
    }

    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>anonymous_extension</span> <span class="Keyword">do</span>
      <span class="Keyword">def</span> <span class="FunctionName">one</span>
        <span class="Number">1</span>
      <span class="Keyword">end</span>
    <span class="Keyword">end</span>

    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>named_extension</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>extend</span> =&gt; <span class="Variable">NamedExtension</span>

    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>multiple_extensions</span>,
            <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>extend</span> =&gt; [<span class="Variable">MultipleExtensionTwo</span>, <span class="Variable">MultipleExtensionOne</span>]
</pre>

<h2> Testeando named_scope con proxy_options</h2>

<p><strong>Named scopes</strong> es una nueva e interesante caraterística de Rails 2.1, pero después de usarlo durante un tiempo quizás sea díficil testear estas estructuras más complejas.</p>

<p>Veamos un ejemplo:</p>

<pre class="mac_classic">            <span class="Keyword">class</span> <span class="TypeName">Shirt<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
              named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>colored</span>, lambda { |<span class="Variable">color</span>|
                { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>color</span> =&gt; color } }
              }
            <span class="Keyword">end</span>
</pre>

<p>¿Cómo creamos un test que valide la generación de este scope ?</p>

<p>Para solucionar esto, se creó el método <strong>proxy_options</strong>. El cual nos permite examinar las opciones usadas en <strong>named_scope</strong>. Para testear el código de arriba podríamos escribir esto:</p>

<pre class="mac_classic">            <span class="Keyword">class</span> <span class="TypeName">ShirtTest<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> Test::Unit</span></span>
              <span class="Keyword">def</span> <span class="FunctionName">test_colored_scope</span>
                red_scope <span class="Keyword">=</span> { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>colored</span> =&gt; <span class="String"><span class="String">'</span>red<span class="String">'</span></span> } }
                blue_scope <span class="Keyword">=</span> { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>colored</span> =&gt; <span class="String"><span class="String">'</span>blue<span class="String">'</span></span> } }
                assert_equal red_scope, <span class="LibraryObject">Shirt</span>.<span class="FunctionName">colored</span>(<span class="String"><span class="String">'</span>red<span class="String">'</span></span>).<span class="FunctionName">scope_options</span>
                assert_equal blue_scope, <span class="LibraryObject">Shirt</span>.<span class="FunctionName">colored</span>(<span class="String"><span class="String">'</span>blue<span class="String">'</span></span>).<span class="FunctionName">scope_options</span>
              <span class="Keyword">end</span>
            <span class="Keyword">end</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Incremento y decremento</h2>

<p>Los métodos de <strong>ActiveRecord</strong> <strong>increment</strong>, <strong>increment!</strong>, <strong>decrement</strong> y <strong>decrement!</strong> ahora toman un nuevo parámetro opcional. En las versiones previas de Rails se podían usar estos métodos para restar 1 a una columna dada.  En rails 2.1 podemos decir que valor restar o sumar. Así:</p>

<pre class="mac_classic">    player1.<span class="FunctionName">increment!</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>points</span>, <span class="Number">5</span>)
    player2.<span class="FunctionName">decrement!</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>points</span>, <span class="Number">2</span>)
</pre>

<p>En el ejemplo estoy sumando 5 puntos al jugador 1 y restando 2 puntos al jugador 2. Cómo este es un parámetro opcional, el código viejo no se ve afectado.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Find</h2>

<h3> Conditions</h3>

<p>A partir de ahora, se va a poder pasar un objeto como parámetro al método  <strong>find</strong> de  <strong>ActiveRecord</strong>, Vea este caso como ejemplo:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Account<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      composed_of <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>balance</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class_name</span> =&gt; <span class="String"><span class="String">&quot;</span>Money<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>mapping</span> =&gt; <span class="String"><span class="String">%w(</span>balance amount<span class="String">)</span></span>
    <span class="Keyword">end</span>
</pre>

<p>En este caso, ud. puede pasar una instancia de <strong>Money</strong> cómo parámetro al método <strong>find</strong> de la clase  <strong>Account</strong>, de la siguiente manera:</p>

<pre class="mac_classic">    amount <span class="Keyword">=</span> <span class="Number">500</span>
    currency <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>USD<span class="String">&quot;</span></span>
    <span class="LibraryObject">Account</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>balance</span> =&gt; <span class="LibraryObject">Money</span>.<span class="FunctionName">new</span>(amount, currency) })
</pre>

<h3> Last</h3>

<p>Hasta ahora sólo podíamos usar tres operadores para buscar datos usando el método <strong>find</strong> de <strong>ActiveRecord</strong>: <strong>:first</strong>, <strong>:all</strong> o el propio id del objeto (en este caso no pasamos ningún operador específico más que el id en sí mismo)</p>

<p>En Rails 2.1 hay un cuarto operador llamado  <strong>:last</strong>. Vea algunos ejemplos:</p>

<pre class="mac_classic">    <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>last</span>)
    <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>last</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; [ <span class="String"><span class="String">&quot;</span>user_name = ?<span class="String">&quot;</span></span>, user_name])
    <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>last</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>order</span> =&gt; <span class="String"><span class="String">&quot;</span>created_on DESC<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>offset</span> =&gt; <span class="Number">5</span>)
</pre>

<p>Para entender como funciona este nuevo operador, veamos el siguiente test:</p>

<pre class="mac_classic">    <span class="Keyword">def</span> <span class="FunctionName">test_find_last</span>
      last  <span class="Keyword">=</span> <span class="LibraryObject">Developer</span>.<span class="FunctionName">find</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>last</span>
      assert_equal last, <span class="LibraryObject">Developer</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>order</span> =&gt; <span class="String"><span class="String">'</span>id desc<span class="String">'</span></span>)
    <span class="Keyword">end</span>
</pre>

<h3> All</h3>

<p>El método estático <strong>all</strong> es un alias al método estático <strong>find(:all)</strong>. Por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Topic</span>.<span class="FunctionName">all</span> es lo mismo que <span class="LibraryObject">Topic</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>)
</pre>

<h3> First</h3>

<p>El método estático <strong>first</strong> es un alias al método estático <strong>find(:first)</strong>. Por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Topic</span>.<span class="FunctionName">first</span> es lo mismo que <span class="LibraryObject">Topic</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
</pre>

<h3> Last</h3>

<p>El método estático <strong>last</strong> es un alias al método estático <strong>find(:last)</strong>. Por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Topic</span>.<span class="FunctionName">last</span> es lo mismo que <span class="LibraryObject">Topic</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>last</span>)
</pre>

<h2> Usando <strong>first</strong> y <strong>last</strong> con named_scope</h2>

<p>Todo los métodos mencionados anteriormente funcionan con <strong>named_scope</strong>. Supongamos que creamos un <strong>named_scope</strong> llamado <strong>recent</strong>. Entonces podríamos hacer esto:</p>

<pre class="mac_classic">            post.<span class="FunctionName">comments</span>.<span class="FunctionName">recent</span>.<span class="FunctionName">last</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2>Eager Loading</h2>

<p>Para explicar esta nueva funcionalidad, veamos el siguiente código:</p>

<pre class="mac_classic">    <span class="LibraryObject">Author</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include</span> =&gt; [<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>posts</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>comments</span>])
</pre>

<p>Estoy haciendo una búsqueda en la tabla <strong>authors</strong>  y también incluyendo las tablas <strong>posts</strong> y <strong>comments</strong> en mi consulta a través de la columna <strong>author_id</strong>, el cual es el nombre de columna por defecto de acuerdo a la conveción que rails utiliza para las claves foráneas.
Esta búsqueda genera una consulta como la siguiente:</p>

<pre class="mac_classic">    <span class="Variable">SELECT</span>
      authors.<span class="String"><span class="String">&quot;</span>id<span class="String">&quot;</span></span>          <span class="Variable">AS</span> t0_r0,
      authors.<span class="String"><span class="String">&quot;</span>created_at<span class="String">&quot;</span></span>  <span class="Variable">AS</span> t0_r1,
      authors.<span class="String"><span class="String">&quot;</span>updated_at<span class="String">&quot;</span></span>  <span class="Variable">AS</span> t0_r2,
      posts.<span class="String"><span class="String">&quot;</span>id<span class="String">&quot;</span></span>            <span class="Variable">AS</span> t1_r0,
      posts.<span class="String"><span class="String">&quot;</span>author_id<span class="String">&quot;</span></span>     <span class="Variable">AS</span> t1_r1,
      posts.<span class="String"><span class="String">&quot;</span>created_at<span class="String">&quot;</span></span>    <span class="Variable">AS</span> t1_r2,
      posts.<span class="String"><span class="String">&quot;</span>updated_at<span class="String">&quot;</span></span>    <span class="Variable">AS</span> t1_r3,
      comments.<span class="String"><span class="String">&quot;</span>id<span class="String">&quot;</span></span>         <span class="Variable">AS</span> t2_r0,
      comments.<span class="String"><span class="String">&quot;</span>author_id<span class="String">&quot;</span></span>  <span class="Variable">AS</span> t2_r1,
      comments.<span class="String"><span class="String">&quot;</span>created_at<span class="String">&quot;</span></span> <span class="Variable">AS</span> t2_r2,
      comments.<span class="String"><span class="String">&quot;</span>updated_at<span class="String">&quot;</span></span> <span class="Variable">AS</span> t2_r3
    <span class="Variable">FROM</span>
      authors
      <span class="Variable">LEFT</span> <span class="Variable">OUTER</span> <span class="Variable">JOIN</span> posts <span class="Variable">ON</span> posts.<span class="FunctionName">author_id</span> <span class="Keyword">=</span> authors.<span class="FunctionName">id</span>
      <span class="Variable">LEFT</span> <span class="Variable">OUTER</span> <span class="Variable">JOIN</span> comments <span class="Variable">ON</span> comments.<span class="FunctionName">author_id</span> <span class="Keyword">=</span> authors.<span class="FunctionName">id</span>
</pre>

<p>Un única consulta SQL con <strong>joins</strong> entre las tablas  <strong>authors</strong>, <strong>posts</strong> y <strong>comments</strong>. A esto lo llamamos <strong>producto cartesiano</strong>.</p>

<p>Este tipo de consultas no siempre tiene una buena performance, entonces esto se cambió en Rails 2.1. La misma consulta para la clase <strong>Author</strong> ahora se hace de una forma diferente para traer la información de las tres tablas. En vez de usar una única consulta SQL con las tres tablas, Rails ahora usa tres consultas diferentes - una por cada tabla - las cuales son más cortas que la anterior. El resultado se puede ver en los logs despues de ejecutar el codigo ruby on rails previo:</p>

<pre class="mac_classic">    <span class="Variable">SELECT</span> <span class="Keyword">*</span> <span class="Variable">FROM</span> <span class="String"><span class="String">&quot;</span>authors<span class="String">&quot;</span></span>
    <span class="Variable">SELECT</span> posts.<span class="Keyword">*</span> <span class="Variable">FROM</span> <span class="String"><span class="String">&quot;</span>posts<span class="String">&quot;</span></span> <span class="Variable">WHERE</span> (posts.<span class="FunctionName">author_id</span> <span class="Variable">IN</span> (<span class="Number">1</span>))
    <span class="Variable">SELECT</span> comments.<span class="Keyword">*</span> <span class="Variable">FROM</span> <span class="String"><span class="String">&quot;</span>comments<span class="String">&quot;</span></span> <span class="Variable">WHERE</span> (comments.<span class="FunctionName">author_id</span> <span class="Variable">IN</span> (<span class="Number">1</span>))
</pre>

<p>En la <strong>mayoría de los casos</strong> estas tres simples consultas se ejecutan más rápido que la consulta larga y compleja.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Belongs_to</h2>

<p>El método <strong>belongs_to</strong> se cambió en pro de permitir el uso de <strong>:dependent => :destroy</strong> y <strong>:delete</strong>
en las asociaciones.</p>

<p>Por ejemplo:</p>

<pre class="mac_classic">    belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>author_address</span>
    belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>author_address</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>dependent</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>destroy</span>
    belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>author_address_extra</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>dependent</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>delete</span>,
            <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class_name</span> =&gt; <span class="String"><span class="String">&quot;</span>AuthorAddress<span class="String">&quot;</span></span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Polymorphic url</h2>

<p>Los métodos helper para las URL polimórficas son usados para resolver de una forma más elegante una ruta nombrada cuando cuando tenemos un modelo de  <strong>ActiveRecord</strong>.</p>

<p>Estos métodos son útiles cuando queremos generar la URL para un recurso <strong>RESTful</strong> sin especificar el tipo de registro en cuestión.</p>

<p>Es muy fácil de usar. Veamos algunos ejemplos (los comentarios explican las llamdas equivalentes para las versiones anteriores a Rails 2.1)</p>

<pre class="mac_classic">    record <span class="Keyword">=</span> <span class="LibraryObject">Article</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    <span class="FunctionName">polymorphic_url</span>(record) <span class="Comment"><span class="Comment">#</span>-&gt; article_url(record)</span>

    record <span class="Keyword">=</span> <span class="LibraryObject">Comment</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    <span class="FunctionName">polymorphic_url</span>(record)  <span class="Comment"><span class="Comment">#</span>-&gt;  comment_url(record)</span>

<span class="Comment">    <span class="Comment">#</span> it can also identify recently created elements</span>
    record <span class="Keyword">=</span> <span class="LibraryObject">Comment</span>.<span class="FunctionName">new</span>
    <span class="FunctionName">polymorphic_url</span>(record)  <span class="Comment"><span class="Comment">#</span>-&gt;  comments_url()</span>
</pre>

<p>Note como el método <strong>polymorphic_url</strong> es capáz de indetificar el tipo del objeto dado y generar la ruta correcta. También soporta <strong>Recursos anidados</strong> y <strong>espacios de nombres</strong>:</p>

<pre class="mac_classic">    <span class="FunctionName">polymorphic_url</span>([<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>admin</span>, <span class="Variable"><span class="Variable">@</span>article</span>, <span class="Variable"><span class="Variable">@</span>comment</span>])
<span class="Comment">    <span class="Comment">#</span>-&gt; this will return:</span>
    <span class="FunctionName">admin_article_comment_url</span>(<span class="Variable"><span class="Variable">@</span>article</span>, <span class="Variable"><span class="Variable">@</span>comment</span>)
</pre>

<p>También se puede usar <strong>new</strong>, <strong>edit</strong> y <strong>formatted</strong> como prefijos:</p>

<pre class="mac_classic">    <span class="FunctionName">edit_polymorphic_path</span>(<span class="Variable"><span class="Variable">@</span>post</span>)
<span class="Comment">    <span class="Comment">#</span>=&gt; /posts/1/edit</span>

    <span class="FunctionName">formatted_polymorphic_path</span>([<span class="Variable"><span class="Variable">@</span>post</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>pdf</span>])
<span class="Comment">    <span class="Comment">#</span>=&gt; /posts/1.pdf</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Relaciones de sólo lectura</h2>

<p>Se agregó una nueva caraterística a las relaciones entre modelos. Con el fin de impedir alterar los modelos ahora podemos usar <strong>:readonly</strong> para asociar modelos. Veamos algunos ejemplos:</p>

<pre class="mac_classic">    has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>reports</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>readonly</span> =&gt; <span class="BuiltInConstant">true</span>

    has_one <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>boss</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>readonly</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>true</span>

    belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>project</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>readonly</span> =&gt; <span class="BuiltInConstant">true</span>

    has_and_belongs_to_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>categories</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>readonly</span> =&gt; <span class="BuiltInConstant">true</span>
</pre>

<p>De esta manera los registros protegidos no podrán ser alterados desde este modelo. Si intentamos editar algunos de los registros de este modelos entonces obtendríamos la siguiente excepción: <strong>ActiveRecord::ReadOnlyRecord</strong></p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Métodos add_timestamps y remove_timestamps</h2>

<p>Ahora tenemos 2 métodos nuevos: <strong>add_timestamps</strong> y <strong>remove_timestamps</strong>. Los cuales agregan y eliminan, respectivamente, las columnas de <strong>timestamp</strong>. Veamos un ejemplo:</p>

<pre class="mac_classic">    <span class="Keyword">def</span> <span class="FunctionName">self.up</span>
      add_timestamps <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>feeds</span>
      add_timestamps <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>urls</span>
    <span class="Keyword">end</span>

    <span class="Keyword">def</span> <span class="FunctionName">self.down</span>
      remove_timestamps <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>urls</span>
      remove_timestamps <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>feeds</span>
    <span class="Keyword">end</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Cálculos</h2>

<p><strong>ActiveRecord::Calculations</strong> ha cambiado un poco para aceptar no sólo el nombre de la columna sino también el nombre de la tabla. Esto es muy útil cuando tenemos una relación entre dos tablas que tienen una columna con el mismo nombre. Los métodos afectados son: <strong>sum</strong> o <strong>maximum</strong> de <strong>ActiveRecord</strong> (entre otros). Para resumir ahora podemos hacer esto de estas dos formas:</p>

<pre class="mac_classic">    authors.<span class="FunctionName">categories</span>.<span class="FunctionName">maximum</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>id</span>)
    authors.<span class="FunctionName">categories</span>.<span class="FunctionName">maximum</span>(<span class="String"><span class="String">&quot;</span>categories.id<span class="String">&quot;</span></span>)
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> ActiveRecord::Base.create acepta bloques</h2>

<p>Estamos acostumbrados al método <strong>ActiveRecord::Base.new</strong> que acepta el uso de bloques. Ahora podemos hacer lo mismo con el método  <strong>create</strong>:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Creación de un nuevo objeto pasándole un bloque con la descripción de sus atributos</span>
    <span class="LibraryObject">User</span>.<span class="FunctionName">create</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first_name</span> =&gt; <span class="String"><span class="String">'</span>Jamie<span class="String">'</span></span>) <span class="Keyword">do </span>|<span class="Variable">u</span>|
      u.<span class="FunctionName">is_admin</span> <span class="Keyword">=</span> <span class="BuiltInConstant">false</span>
    <span class="Keyword">end</span>
</pre>

<p>Podemos usar este mismo método para crear muchos objetos de una sola vez:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Creación de un array de objetos nuevos usando un bloque.</span>
<span class="Comment">    <span class="Comment">#</span> El bloque se ejecuta una vez por cada nuevo objeto creado.</span>
    <span class="LibraryObject">User</span>.<span class="FunctionName">create</span>([{<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first_name</span> =&gt; <span class="String"><span class="String">'</span>Jamie<span class="String">'</span></span>}, {<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first_name</span> =&gt; <span class="String"><span class="String">'</span>Jeremy<span class="String">'</span></span>}]) <span class="Keyword">do </span>|<span class="Variable">u</span>|
      u.<span class="FunctionName">is_admin</span> <span class="Keyword">=</span> <span class="BuiltInConstant">false</span>
    <span class="Keyword">end</span>
</pre>

<p>Esto también funciona para las asociaciones:</p>

<pre class="mac_classic">    author.<span class="FunctionName">posts</span>.<span class="FunctionName">create!</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span> =&gt; <span class="String"><span class="String">&quot;</span>New on Edge<span class="String">&quot;</span></span>) {|<span class="Variable">p</span>| p.<span class="FunctionName">body</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>More cool stuff!<span class="String">&quot;</span></span>}

<span class="Comment">    <span class="Comment">#</span> o</span>

    author.<span class="FunctionName">posts</span>.<span class="FunctionName">create!</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span> =&gt; <span class="String"><span class="String">&quot;</span>New on Edge<span class="String">&quot;</span></span>) <span class="Keyword">do </span>|<span class="Variable">p</span>|
      p.<span class="FunctionName">body</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>More cool stuff!<span class="String">&quot;</span></span>
    <span class="Keyword">end</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> change_table</h2>

<p>La creación de migraciones (<strong>migrations</strong>) en Rails 2.0 se hizo mucho más sexy que en las versiones previas, pero alterar una tabla usando <strong>migrations</strong> continuaba siendo como antes, nada sexy.</p>

<p>En Rails 2.1, ahora también es sexy alterar una tabla, con el nuevo método <strong>change_table</strong>. Veamos el ejemplo:</p>

<pre class="mac_classic">    change_table <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>videos</span> <span class="Keyword">do </span>|<span class="Variable">t</span>|
      t.<span class="FunctionName">timestamps</span> <span class="Comment"><span class="Comment">#</span> esto agrega las columnas created_at y updated_at</span>
      t.<span class="FunctionName">belongs_to</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>goat</span> <span class="Comment"><span class="Comment">#</span> esto agrega la columna goat_id (integer)</span>
      t.<span class="FunctionName">string</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>name</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>email</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>limit</span> =&gt; <span class="Number">20</span> <span class="Comment"><span class="Comment">#</span> esto agrega las columnas name y email</span>
      t.<span class="FunctionName">remove</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>name</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>email</span> <span class="Comment"><span class="Comment">#</span> esto elimina las columnas name y email</span>
    <span class="Keyword">end</span>
</pre>

<p>El nuevo método <strong>change_table</strong> funciona como <strong>create_table</strong> pero en vez de crear un tabla modifica una ya existente agregando o eliminando columnas e índices.</p>

<pre class="mac_classic">    change_table <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>table</span> <span class="Keyword">do </span>|<span class="Variable">t</span>|
      t.<span class="FunctionName">column</span> <span class="Comment"><span class="Comment">#</span> agrega una columna normal. Ej: t.column(:name, :string)</span>
      t.<span class="FunctionName">index</span> <span class="Comment"><span class="Comment">#</span> agrega un nuevo índice.</span>
      t.<span class="FunctionName">timestamps</span>
      t.<span class="FunctionName">change</span> <span class="Comment"><span class="Comment">#</span> cambia la definición de una columna. Ej: t.change(:name, :string, :limit =&gt; 80)</span>
      t.<span class="FunctionName">change_default</span> <span class="Comment"><span class="Comment">#</span> cambia el valor por defecto de una columna.</span>
      t.<span class="FunctionName">rename</span> <span class="Comment"><span class="Comment">#</span> cambia el nombre de una columna.</span>
      t.<span class="FunctionName">references</span>
      t.<span class="FunctionName">belongs_to</span>
      t.<span class="FunctionName">string</span>
      t.<span class="FunctionName">text</span>
      t.<span class="FunctionName">integer</span>
      t.<span class="FunctionName">float</span>
      t.<span class="FunctionName">decimal</span>
      t.<span class="FunctionName">datetime</span>
      t.<span class="FunctionName">timestamp</span>
      t.<span class="FunctionName">time</span>
      t.<span class="FunctionName">date</span>
      t.<span class="FunctionName">binary</span>
      t.<span class="FunctionName">boolean</span>
      t.<span class="FunctionName">remove</span>
      t.<span class="FunctionName">remove_references</span>
      t.<span class="FunctionName">remove_belongs_to</span>
      t.<span class="FunctionName">remove_index</span>
      t.<span class="FunctionName">remove_timestamps</span>
    <span class="Keyword">end</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Dirty Objects</h2>

<p>Ahora en Rails podemos rastrear los cambios hechos por <strong>ActiveRecord</strong>. Se puede saber si un objeto ha sido modificado o no. En caso de que haya cambiado, podemos ver que fue lo que cambió exactamente como así también comparar su estado anterior con el actual. Veamos algunos ejemplos:</p>

<pre class="mac_classic">    article <span class="Keyword">=</span> <span class="LibraryObject">Article</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    article.<span class="FunctionName">changed?</span>  <span class="Comment"><span class="Comment">#</span>=&gt; false</span>

    article.<span class="FunctionName">title</span>  <span class="Comment"><span class="Comment">#</span>=&gt; &quot;Title&quot;</span>
    article.<span class="FunctionName">title</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>New Title<span class="String">&quot;</span></span>
    article.<span class="FunctionName">title_changed?</span> <span class="Comment"><span class="Comment">#</span>=&gt; true</span>

<span class="Comment">    <span class="Comment">#</span> muestra title antes del cambio</span>
    article.<span class="FunctionName">title_was</span>  <span class="Comment"><span class="Comment">#</span>=&gt; &quot;Title&quot;</span>

<span class="Comment">    <span class="Comment">#</span> antes y despues del cambio</span>
    article.<span class="FunctionName">title_change</span>  <span class="Comment"><span class="Comment">#</span>=&gt; [&quot;Title&quot;, &quot;New Title&quot;]</span>
</pre>

<p>Como ud. puede ver es muy simple. Puede listar todos los cambios hechos al objeto de una esta dos formas:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> retorna una lista con todos los atributos que cambiaron</span>
    article.<span class="FunctionName">changed</span>  <span class="Comment"><span class="Comment">#</span>=&gt; ['title']</span>

<span class="Comment">    <span class="Comment">#</span> retorna un hash con los atributos que cambiaron</span>
<span class="Comment">    <span class="Comment">#</span> con sus valores antes y después</span>
    article.<span class="FunctionName">changes</span>  <span class="Comment"><span class="Comment">#</span>=&gt; { 'title' =&gt; [&quot;Title&quot;, &quot;New Title&quot;] }</span>
</pre>

<p>Note que cuando el objeto se guarda su estado de alterado cambia:</p>

<pre class="mac_classic">    article.<span class="FunctionName">changed?</span>  <span class="Comment"><span class="Comment">#</span>=&gt; true</span>
    article.<span class="FunctionName">save</span>  <span class="Comment"><span class="Comment">#</span>=&gt; true</span>
    article.<span class="FunctionName">changed?</span>  <span class="Comment"><span class="Comment">#</span>=&gt; false</span>
</pre>

<p>En caso de ud. quiera cambiar el estado de un objeto sin usar <strong>attr=</strong>, va a necesitar informar explícitamente que se ha modificado el atributo mediante el método <strong>attr_name_will_change!</strong> (reemplace <strong>attr</strong> con el nombre real del atributo del objeto). Veamos un ejemplo más:</p>

<pre class="mac_classic">    article <span class="Keyword">=</span> <span class="LibraryObject">Article</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    article.<span class="FunctionName">title_will_change!</span>
    article.<span class="FunctionName">title</span>.<span class="FunctionName">upcase!</span>
    article.<span class="FunctionName">title_change</span>  <span class="Comment"><span class="Comment">#</span>=&gt; ['Title', 'TITLE']</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Partial Updates</h2>

<p>La implementación de <strong>Dirty Objects</strong> dió punto de partida a otra característica muy interesante.</p>

<p>Dado que ahora podemos rastrear los cambios de los atributos de un objeto, ¿por qué no usar esto para evitar actualizaciones innecesarias en la base de datos?</p>

<p>En las versiones previas de Rails cuando ejecutábamos el método <strong>save</strong> de un objeto <strong>ActiveRecord</strong>, se actualizaban todos los campos en la base de datos. Por más que los mismos no hayan sufrido ningún cambio.</p>

<p>Con <strong>Dirty Objects</strong> esta acción podría mejorarse, y esto es exactamente lo que pasó. Miremos un poco la consulta SQL generada en Rails 2.1 cuando intentamos guardar un objeto que a sufrido un pequeño cambio:</p>

<pre class="mac_classic">    article <span class="Keyword">=</span> <span class="LibraryObject">Article</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    article.<span class="FunctionName">title</span>  <span class="Comment"><span class="Comment">#</span>=&gt; &quot;Title&quot;</span>
    article.<span class="FunctionName">subject</span>  <span class="Comment"><span class="Comment">#</span>=&gt; &quot;Edge Rails&quot;</span>

<span class="Comment">    <span class="Comment">#</span> Cambiamos el título (title)</span>
    article.<span class="FunctionName">title</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>New Title<span class="String">&quot;</span></span>

<span class="Comment">    <span class="Comment">#</span> esto crea el siguiente SQL para persistir el objeto</span>
    article.<span class="FunctionName">save</span>
<span class="Comment">    <span class="Comment">#</span>=&gt;  &quot;UPDATE articles SET title = 'New Title' WHERE id = 1&quot;</span>
</pre>

<p>Note como sólo se actualizaron en la base de datos los campos que fueron cambiados en la aplicación. Si ningún campo ha sido actualizado en la aplicación, entonces <strong>ActiveRecord</strong> no ejecutará ninguna actualización.</p>

<p>Para habilitar/deshabilitar esta nueva característica debe cambiar la propiedad <strong>partial_updates</strong> de sus modelos.</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Para habilitarla</span>
    <span class="LibraryObject">MyClass</span>.<span class="FunctionName">partial_updates</span> <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
</pre>

<p>Si desea habilitar/deshabilitar esta característica para todos sus modelos debe editar el archivo <em>config/initializers/new_rails_defaults.rb</em>:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Habilitando para todos los modelos</span>
    <span class="LibraryObject">ActiveRecord</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">partial_updates</span> <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
</pre>

<p>No olvide informarle a Rails a través <em>config/initializers/new_rails_defaults.rb</em> que va a actualizar un atributo sin usar el método <strong>attr=</strong>, así:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Si usa **attr=**,</span>
<span class="Comment">    <span class="Comment">#</span> entocnes está bien no informar nada.</span>
    person.<span class="FunctionName">name</span> <span class="Keyword">=</span> <span class="String"><span class="String">'</span>bobby<span class="String">'</span></span>
    person.<span class="FunctionName">name_change</span>    <span class="Comment"><span class="Comment">#</span> =&gt; ['bob', 'bobby']</span>


<span class="Comment">    <span class="Comment">#</span> Pero debe informar que el campo se va actualizar</span>
<span class="Comment">    <span class="Comment">#</span> si no va a usar **attr=**</span>
    person.<span class="FunctionName">name_will_change!</span>
    person.<span class="FunctionName">name</span> <span class="Keyword">&lt;&lt;</span> <span class="String"><span class="String">'</span>by<span class="String">'</span></span>
    person.<span class="FunctionName">name_change</span>    <span class="Comment"><span class="Comment">#</span> =&gt; ['bob', 'bobby']</span>
</pre>

<p>Si ud. no informa cambios como estos, no se podrán rastrear los cambios de los atributos del modelo y la tabla no se actualizará correctamente.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> ¿Smallint, int o bigint en MySQL?</h2>

<p>El adapatador para <strong>MySQL</strong> de <strong>ActiveRecord</strong> es un poco más inteligente en el uso tipos de datos enteros a la hora de crear o alterar columnas en la base de datos. Con la opción <strong>:limit</strong>, podemos definir si la columna va a ser <strong>smallint</strong>, <strong>int</strong> or <strong>bigint</strong>. Veamos el código que hace este trabajo:</p>

<pre class="mac_classic">    <span class="Keyword">case</span> limit
    <span class="Keyword">when</span> <span class="Number">0</span>..<span class="Number">3</span>
      <span class="String"><span class="String">&quot;</span>smallint(<span class="StringInterpolation"><span class="StringInterpolation">#{</span>limit<span class="StringInterpolation">}</span></span>)<span class="String">&quot;</span></span>
    <span class="Keyword">when</span> <span class="Number">4</span>..<span class="Number">8</span>
      <span class="String"><span class="String">&quot;</span>int(<span class="StringInterpolation"><span class="StringInterpolation">#{</span>limit<span class="StringInterpolation">}</span></span>)<span class="String">&quot;</span></span>
    <span class="Keyword">when</span> <span class="Number">9</span>..<span class="Number">20</span>
      <span class="String"><span class="String">&quot;</span>bigint(<span class="StringInterpolation"><span class="StringInterpolation">#{</span>limit<span class="StringInterpolation">}</span></span>)<span class="String">&quot;</span></span>
    <span class="Keyword">else</span>
      <span class="String"><span class="String">'</span>int(11)<span class="String">'</span></span>
    <span class="Keyword">end</span>
</pre>

<p>Para dejar esto más claro vamos a mapear esto en un archivo de migración y ver que tipo de dato se usa para cada columna:</p>

<pre class="mac_classic">    create_table <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>table_name</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>force</span> =&gt; <span class="BuiltInConstant">true</span> <span class="Keyword">do </span>|<span class="Variable">t</span>|

<span class="Comment">      <span class="Comment">#</span> 0 - 3: smallint</span>
      t.<span class="FunctionName">integer</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>column_one</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>limit</span> =&gt; <span class="Number">2</span> <span class="Comment"><span class="Comment">#</span> smallint(2)</span>

<span class="Comment">      <span class="Comment">#</span> 4 - 8: int</span>
      t.<span class="FunctionName">integer</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>column_two</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>limit</span> =&gt; <span class="Number">6</span> <span class="Comment"><span class="Comment">#</span> int(6)</span>

<span class="Comment">      <span class="Comment">#</span> 9 - 20: bigint</span>
      t.<span class="FunctionName">integer</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>column_three</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>limit</span> =&gt; <span class="Number">15</span> <span class="Comment"><span class="Comment">#</span> bigint(15)</span>

<span class="Comment">      <span class="Comment">#</span> si no usamos :limit int(11)</span>
      t.<span class="FunctionName">integer</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>column_four</span> <span class="Comment"><span class="Comment">#</span> int(11)</span>
    <span class="Keyword">end</span>
</pre>

<p>El adaptador de <strong>PostgreSQL</strong> tenía esta caraterística y <strong>MySQL</strong> sólo siguió esta tendencia.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Opcional :select en has_one y belongs_to</h2>

<p>Los ya conocidos métodos <strong>has_one</strong> y <strong>belongs_to</strong> ahora tienen la opción: <strong>:select</strong>.</p>

<p>El valor por defecto es "<em>" (como en "SELECT </em> FROM table"), pero se puede editar para recuperar sólo las columnas que vamos a usar.</p>

<p>No olvide incluir las <strong>claves promarias</strong> y las <strong>claves foráneas</strong>, de lo contrario obtendrá un error.</p>

<p>El método <strong>belongs_to</strong> ya no tiene la opción <strong>:order</strong>. Pero no se preocupe por que realmente no
era muy útil.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Almacenando el nombre completo de una clase cuando usamos STI</h2>

<p>Siempre que usemos <strong>models</strong> con <strong>namespace</strong> y <strong>STI</strong>, <strong>ActiveRecord</strong> sólo almacena el nombre de la clase, sin el nombre del <strong>namespace</strong> (<em>demodulized</em>). Esto sólo funcionará si todas las clases en el <strong>STI</strong> estan en el mismo <strong>namespace</strong>. Veamos un ejemplo:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">CollectionItem<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>; <span class="Keyword">end</span>
    <span class="Keyword">class</span> <span class="TypeName">ComicCollection::Item<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> CollectionItem</span></span>; <span class="Keyword">end</span>

    item <span class="Keyword">=</span> <span class="LibraryObject">ComicCollection</span>::<span class="FunctionName">Item</span>.<span class="FunctionName">new</span>
    item.<span class="FunctionName">type</span> <span class="Comment"><span class="Comment">#</span> =&gt; 'Item'</span>

    item2 <span class="Keyword">=</span> <span class="LibraryObject">CollectionItem</span>.<span class="FunctionName">find</span>(item.<span class="FunctionName">id</span>)
<span class="Comment">    <span class="Comment">#</span> retorna un error, por que no puede encontrar</span>
<span class="Comment">    <span class="Comment">#</span> la clase Item</span>
</pre>

<p>Este cambio agrega una nueva opción que hace que <strong>ActiveRecord</strong> almacene el nombre completo de la clase.</p>

<p>Para habilitar/deshabilitar esta característica, ud. debe incluir o editar lo siguiente en su <strong>environment.rb</strong>.</p>

<pre class="mac_classic">    <span class="LibraryObject">ActiveRecord</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">store_full_sti_class</span> <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
</pre>

<p>El valor por defecto es true.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> El método table_exists?</h2>

<p>Se agregó un nuevo método para la clase <strong>AbstractAdapter</strong>: <strong>table_exists</strong>. Es muy simple de usar:</p>

<pre class="mac_classic">    <span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">ActiveRecord</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">connection</span>.<span class="FunctionName">table_exists?</span>(<span class="String"><span class="String">&quot;</span>users<span class="String">&quot;</span></span>)
    =&gt; <span class="BuiltInConstant">true</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Timestamped Migrations</h2>

<p>Cuando se está estudiando Rails o cuando estamos desarrolando algo sólos, las <strong>migraciones</strong> parecen ser la mejor solución a todos nuestros problemas. Pero cuando estamos trabajando en un proyecto con un equipo de desarrolladores de distintas partes del mundo, ud. descurbrirá (si aún no lo hizo) que las migrations no funcionan bien. Las nuevas migraciones (timestamped migrations) de Rails 2.1 vienen al rescate.</p>

<p>Antes de la llegada de <strong>timestamped migrations</strong>, cada nueva migración tenía un número antepuesto al nombre de la migración. Si dos migraciones eran generadas por distintos desarrolladores y no se comiteaba de inmediato, entonces podían terminar teniendo el mismo número de migración pero con diferente información. En este punto su esquema_info está desactualizado y ud. tiene un conflicto.</p>

<p>Hay varias formas de "intentar" resolver este problema. Se crearon muchos plugins con diferentes maneras de resolver esto. Más allá de los plugins disponibles, una cosa era clara: la antigua forma simplemente no funcionaba.</p>

<p>Si ud. estuviese usando Git, entonces se podría complicar mucho más, su equipo probablemente tenga algunas ramas (branches) con <strong>migraciones</strong> desactualizadas en tdoas ellas. Probablemente tenga serios conflictos a la ahora de hacer un merge de esas ramas (branches).</p>

<p>Para resolver este gran problema, el core team de Rails cambió el funcionanmiento de las migraciones. En vez de anteponer cada archivo de migración con un número, ahora se le antepone con un string basado en la hora <strong>UTC</strong> con el siguiente formato  YYYYMMDDHHMMSS.</p>

<p>Así mismo se creó una nueva tabla llamada <strong>schema_migrations</strong>, esta almacena las <strong>migraciones</strong> ejecutadas hasta el momento. De esta manera, si alguien crea una migración con un número bajo, rails hará un  <strong>rollback</strong> de las migraciones hasta la versión previa y luego se correrán todo de nuevo hasta la versión actual.</p>

<p>Esto aparentemente, resuelve el problema de las <strong>migraciones</strong>.</p>

<p>Hay una opción para deshabilitar esta caraterística, agregando esta línea en el archivo <strong>envronment.rb</strong>:</p>

<pre class="mac_classic">    config.<span class="FunctionName">active_record</span>.<span class="FunctionName">timestamped_migrations</span> <span class="Keyword">=</span> <span class="BuiltInConstant">false</span>
</pre>

<p>También hay algunas tareas de rake nuevas para "navegar" a través de las <strong>migraciones</strong>:</p>

<pre class="mac_classic">    rake db<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>migrate</span><span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>up</span>
    rake db<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>migrate</span><span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>down</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h1> ActiveSupport</h1>

<p>Active Support es una colección de varias clases y extensiones de bibliotecas que fueron consideradas muy útiles para las aplicaciones Ruby on Rails.
(wikipedia)</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> ActiveSupport::CoreExtensions::Date::Calculations</h2>

<h3> Time#end_of_day</h3>

<p>Retorna la fecha actual con la hora fijada en 11:59:59 PM.</p>

<h3> Time#end_of_week</h3>

<p>Retorna el fin de semana (Sunday 11:59:59 PM).</p>

<h3> Time#end_of_quarter</h3>

<p>Retorna un objeto date representando el fin del trimestre. En otras palabras, retorna el último día de algunos de los siguientes meses: marzo, junio, septiembre o diciembre, dependiendo de la fecha actual.</p>

<h3> Time#end_of_year</h3>

<p>Retorna 31 de Diciembre a las 11:59:59 PM.</p>

<h3> Time#in_time_zone</h3>

<p>Este método es similar a  <strong>Time#localtime</strong>, excepto por el hecho de que usa <strong>Time.zone</strong> en vez de basarse en el timezone del sistema operativo. Se le puede pasar como parámetro tanto un objeto <strong>TimeZone</strong> como un <strong>String</strong>. Veamos algunos ejemplos:</p>

<pre class="mac_classic">    <span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span> <span class="Keyword">=</span> <span class="String"><span class="String">'</span>Hawaii<span class="String">'</span></span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>).<span class="FunctionName">in_time_zone</span>
<span class="Comment">    <span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 14:00:00 HST -10:00</span>

    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>).<span class="FunctionName">in_time_zone</span>(<span class="String"><span class="String">'</span>Alaska<span class="String">'</span></span>)
<span class="Comment">    <span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 15:00:00 AKST -09:00</span>
</pre>

<h3> Time#days_in_month</h3>

<p>Se arregló un bug en el método <strong>days_in_month</strong>, el cual retornaba un número incorrecto de días en febrero cuando no se le especificaba el año.</p>

<p>El cambio consiste en usar el año actual como valor por defecto cuando no se le especifica el año en la llamada al método. Supongamos que estamos en un año bisiesto, veamos:</p>

<pre class="mac_classic">    <span class="Variable">Loading</span> development environment (<span class="Variable">Rails</span> <span class="Number">2.0</span>.<span class="Number">2</span>)
    <span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Time</span>.<span class="FunctionName">days_in_month</span>(<span class="Number">2</span>)
    =&gt; <span class="Number">28</span>

    <span class="Variable">Loading</span> development environment (<span class="Variable">Rails</span> <span class="Number">2.1</span>.<span class="Number">0</span>)
    <span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Time</span>.<span class="FunctionName">days_in_month</span>(<span class="Number">2</span>)
    =&gt; <span class="Number">29</span>
</pre>

<h3> DateTime#to_f</h3>

<p>La clase <strong>DateTime</strong> tiene un nuevo método llamado <strong>to_f</strong> que retorna la fecha como un flotante representando el número de segundos desde  el Unix epoch (época unix, número de segundos desde el 1 de Enero de 1970 a la medianoche).</p>

<h3> Date.current</h3>

<p>La clase <strong>Date</strong> tiene un nuevo método llamado <strong>current</strong> el cual se usa en vez de <strong>Date.today</strong>, por que este considera el timezone especificado en <strong>config.time_zone</strong>, que en caso de que estar especificado retorna  <strong>Time.zone.today</strong>, de no ser así, entonces retorna <strong>Date.today</strong>.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Fragment_exist?</h2>

<p>Se agregaron dos nuevos métodos a  <strong>cache_store</strong>: <strong>fragment_exist?</strong> y <strong>exist?</strong>.</p>

<p>El método <strong>fragment_exist?</strong> hace exactamente lo que ud. esperaría, verifica si un fragmento cacheado, informado a través de una clave existe. Básicamente sustituyendo al famoso:</p>

<pre class="mac_classic">    <span class="FunctionName">read_fragment</span>(path).<span class="FunctionName">nil?</span>
</pre>

<p>El método <strong>exist?</strong> se agregó a <strong>cache_store</strong>, mientras que <strong>fragment_exist?</strong> es un helper el cual ud. podría usar dentro de su controlador.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> ¿UTC o GMT?</h2>

<p>Una pregunta simple, pero interesante. Hasta ahora Rails estuvo usando mucho la sigla UTC, pero cuando se ejecuta el método <strong>to_s</strong> de <strong>TimeZone</strong>, este muestra GMT, no UTC. Esto es debido al hecho de que el acrónimo GMT es más común entre los usuarios finales.</p>

<p>Si ud. mira en el panel de control de Windows, dónde se puede seleccionar el timezone, verá el que el acrónimo utilizado es GMT. Google y Yahoo también están usando GMT dentro de sus productos.</p>

<pre class="mac_classic">    <span class="LibraryObject">TimeZone</span>[<span class="String"><span class="String">'</span>Moscow<span class="String">'</span></span>].<span class="FunctionName">to_s</span> <span class="Comment"><span class="Comment">#</span>=&gt; &quot;(GMT+03:00) Moscow&quot;</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> JSON escape</h2>

<p>El método <strong>json_escape</strong> funciona como <strong>html_escape</strong>. Es muy útil cuando necesitamos mostrar strings <strong>JSON</strong> en una página <strong>HTML</strong> , por ejemplo, en un proceso de documentación.</p>

<pre class="mac_classic">    puts <span class="FunctionName">json_escape</span>(<span class="String"><span class="String">&quot;</span>is a &gt; 0 &amp; a &lt; 10?<span class="String">&quot;</span></span>)
<span class="Comment">    <span class="Comment">#</span> =&gt; is a \u003E 0 \u0026 a \u003C 10?</span>
</pre>

<p>Podemos usar el atajo <strong>j</strong> en ERB:</p>

<pre class="mac_classic">    <span class="Keyword">&lt;</span><span class="Keyword">%=</span> j <span class="Variable"><span class="Variable">@</span>person</span>.<span class="FunctionName">to_json</span> <span class="String"><span class="String">%&gt;</span></span>
</pre>

<p>Si ud. desea escapar todo el código <strong>JSON</strong> por defecto, incluya la línea siguiente en su <em>environment.rb</em>:</p>

<pre class="mac_classic">    <span class="LibraryObject">ActiveSupport</span>.<span class="FunctionName">escape_html_entities_in_json</span> <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Mem_cache_store ahora acepta opciones</h2>

<p>La inclusión de <strong>Memcache-Client</strong> dentro de <strong>ActiveSupport::Cache</strong> facilitó mucho las cosas, pero también eliminó la flexibilidad permitiendo configurar nada más que el número de IP del servidor de <strong>memcached</strong>.</p>

<p><strong>Jonathan Weiss</strong> hizo un parche que fue incluido en Rails, que permite opciones extras como estas:</p>

<pre class="mac_classic">    <span class="LibraryObject">ActiveSupport</span>::<span class="FunctionName">Cache</span>.<span class="FunctionName">lookup_store</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>mem_cache_store</span>, <span class="String"><span class="String">&quot;</span>localhost<span class="String">&quot;</span></span>

    <span class="LibraryObject">ActiveSupport</span>::<span class="FunctionName">Cache</span>.<span class="FunctionName">lookup_store</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>mem_cache_store</span>, <span class="String"><span class="String">&quot;</span>localhost<span class="String">&quot;</span></span>, <span class="String"><span class="String">'</span>192.168.1.1<span class="String">'</span></span>,
            <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>namespace</span> =&gt; <span class="String"><span class="String">'</span>foo<span class="String">'</span></span>
</pre>

<p>o</p>

<pre class="mac_classic">    config.<span class="FunctionName">action_controller</span>.<span class="FunctionName">fragment_cache_store</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>mem_cache_store</span>, <span class="String"><span class="String">'</span>localhost<span class="String">'</span></span>,
            {<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>compression</span> =&gt; <span class="BuiltInConstant">true</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>debug</span> =&gt; <span class="BuiltInConstant">true</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>namespace</span> =&gt;<span class="String"><span class="String">'</span>foo<span class="String">'</span></span>}
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Time.current</h2>

<p>Un nuevo método para la clase <strong>Time</strong>. El método <strong>current</strong> retorna dependiendo de si fue especificado antes <strong>config.time_zone</strong>, <strong>Time.zone.now</strong>, de otra manera retorna <strong>Time.now</strong>.</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> retorna un valor que depende de config.time_zone</span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">current</span>
</pre>

<p>los métodos <strong>since</strong> y <strong>ago</strong> también cambiaron sus valores de retorno, retornando un <strong>TimeWithZone</strong> en caso de que se especifique <strong>config.time_zone</strong>.</p>

<p>Esto convierte al método <strong>Time.current</strong> en el nuevo método por defecto para obtener la hora actual, reemplazando a <strong>Time.now</strong> (el cual sigue existiendo, pero no tiene en cuenta el timezone especificado).</p>

<p>Los métodos <strong>datetime_select</strong>, <strong>select_datetime</strong> y <strong>select_time</strong> se actualizaron para que tengan como valor de retorno <strong>Time.current</strong>.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2>Eliminando los espacios en blanco con el método squish</h2>

<p>Se agregaron dos métodos al objeto <strong>String</strong>, <strong>squish</strong> y <strong>squish!</strong>.</p>

<p>Estos métodos hacen lo mismo que el método <strong>strip</strong>. Elimina los espacios en blanco del principio y del final de un texto. También elimina los espacios en blanco no utilizados (espacios en blanco consecutivos) en el medio de un texto.
Veamos un ejemplo:</p>

<pre class="mac_classic">    “    <span class="Variable">A</span>    text    full    of     spaces    “.<span class="FunctionName">strip</span>
<span class="Comment">    <span class="Comment">#</span>=&gt; “A    text    full    of     spaces”</span>

    “    <span class="Variable">A</span>    text    full    of     spaces    “.<span class="FunctionName">squish</span>
<span class="Comment">    <span class="Comment">#</span>=&gt; “A text full of spaces”</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h1> ActiveResource</h1>

<p>ActiveResource es la capa responsable de la implementación de sistemas RESTful del lado del cliente. A través de ActiveResource es posible consumir servicios RESTful mediante el uso de objetos que actúan como un proxy para los servicios remotos.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Usando el email como nombre de usuario.</h2>

<p>Algunos servicioes usan el e-mail como nombre de usuario, lo cual nos obliga a usar una URL como la siguiente:</p>

<pre class="mac_classic">    http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>ernesto.<span class="FunctionName">jimenez</span><span class="Variable"><span class="Variable">@</span>negonation</span>.<span class="FunctionName">com</span><span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>pass</span><span class="Variable"><span class="Variable">@</span>tractis</span>.<span class="FunctionName">com</span>
</pre>

<p>Pero nos genera un problema. Por que tenemos dos (@), el intérprete se pierde cuando lee algo como esto. Por este motivo, Se exntendió <strong>ActiveResource</strong> un poco más, con el fin de facilitar el uso de e-emails para la autenticación. Ahora ud. puede hacer lo siguiente:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Person<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveResource::Base</span></span>
      <span class="Variable">self</span>.<span class="FunctionName">site</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>http://tractis.com<span class="String">&quot;</span></span>
      <span class="Variable">self</span>.<span class="FunctionName">user</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>ernesto.jimenez@negonation.com<span class="String">&quot;</span></span>
      <span class="Variable">self</span>.<span class="FunctionName">password</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>pass<span class="String">&quot;</span></span>
    <span class="Keyword">end</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> El método clone</h2>

<p>Ahora podemos clonar un recurso existente:</p>

<pre class="mac_classic">    ryan <span class="Keyword">=</span> <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="Number">1</span>)
    not_ryan <span class="Keyword">=</span> ryan.<span class="FunctionName">clone</span>
    not_ryan.<span class="FunctionName">new?</span>  <span class="Comment"><span class="Comment">#</span> =&gt; true</span>
</pre>

<p>Note que el objeto copiado no ha clonado ningún atributo de la clase, apenas los atributos del recurso.</p>

<pre class="mac_classic">    ryan <span class="Keyword">=</span> <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="Number">1</span>)
    ryan.<span class="FunctionName">address</span> <span class="Keyword">=</span> <span class="LibraryObject">StreetAddress</span>.<span class="FunctionName">find</span>(<span class="Number">1</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>person_id</span> =&gt; ryan.<span class="FunctionName">id</span>)
    ryan.<span class="FunctionName">hash</span> <span class="Keyword">=</span> {<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>not</span> =&gt; <span class="String"><span class="String">&quot;</span>an ARes instance<span class="String">&quot;</span></span>}

    not_ryan <span class="Keyword">=</span> ryan.<span class="FunctionName">clone</span>
    not_ryan.<span class="FunctionName">new?</span>            <span class="Comment"><span class="Comment">#</span> =&gt; true</span>
    not_ryan.<span class="FunctionName">address</span>         <span class="Comment"><span class="Comment">#</span> =&gt; NoMethodError</span>
    not_ryan.<span class="FunctionName">hash</span>            <span class="Comment"><span class="Comment">#</span> =&gt; {:not =&gt; &quot;an ARes instance&quot;}</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Timeouts</h2>

<p>ActiveResource usa <strong>HTTP</strong> para acceder a la API de RESTful y por esto es suceptible a problemas con servidores lentos o servidores no alcanzables. En algunos casos, las llamadas a  ActiveResource pueden expirar (timeout). Ahora ud. puede controlar el tiempo de expiración con la propiedad timeout.</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Person<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveResource::Base</span></span>
      <span class="Variable">self</span>.<span class="FunctionName">site</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>http://api.people.com:3000/<span class="String">&quot;</span></span>
      <span class="Variable">self</span>.<span class="FunctionName">timeout</span> <span class="Keyword">=</span> <span class="Number">5</span> <span class="Comment"><span class="Comment">#</span> waits 5 seconds before expire</span>
    <span class="Keyword">end</span>
</pre>

<p>En el ejemplo de arriba configuramos un timeout de 5 segundos. Se recomienda un valor pequeño para permitirle a su sistema una falla rápida, previeniendo que una casacada de fallas deje su servidor fuera de servicio.</p>

<p>Internamente, ActiveResource se basa la biblioteca Net:HTTP para hacer las peticiones HTTP. Cuando ud. define un valor por defecto para la propiedad timeout, el mismo valor es definido para la propiedad <strong>read_timeout</strong> de la instancia del objeto Net:HTTP que está usando en ese momento.</p>

<p>El valor por defecto es 60 segundos.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h1> ActionPack</h1>

<p>Está compuesto por ActionView (generación de visualización para el usuario, por ej: HTML, XML, JavaScript, etc.) y ActionController (controla el flujo de la aplicación)
(wikipedia)</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> TimeZone</h2>

<h3>  Definiendo un timezone por defecto</h3>

<p>Se agregó una nueva opción al método <strong>time_zone_select</strong>, ahora ud. puede poner un valor por defecto en caso de el usuario no haya seleccionado ningún <strong>TimeZone</strong>, o cuando la columna en la base de datos es null. Para hacer esto, se creó la opción <strong>:default</strong> que se puede usar de la siguiente manera:</p>

<pre class="mac_classic">    <span class="FunctionName">time_zone_select</span>(<span class="String"><span class="String">&quot;</span>user<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>time_zone<span class="String">&quot;</span></span>, <span class="BuiltInConstant">nil</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include_blank</span> =&gt; <span class="BuiltInConstant">true</span>)

    <span class="FunctionName">time_zone_select</span>(<span class="String"><span class="String">&quot;</span>user<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>time_zone<span class="String">&quot;</span></span>, <span class="BuiltInConstant">nil</span>,
            <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>default</span> =&gt; <span class="String"><span class="String">&quot;</span>Pacific Time (US &amp; Canada)<span class="String">&quot;</span></span> )

    <span class="FunctionName">time_zone_select</span>( <span class="String"><span class="String">&quot;</span>user<span class="String">&quot;</span></span>, <span class="String"><span class="String">'</span>time_zone<span class="String">'</span></span>, <span class="LibraryObject">TimeZone</span>.<span class="FunctionName">us_zones</span>,
            <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>default</span> =&gt; <span class="String"><span class="String">&quot;</span>Pacific Time (US &amp; Canada)<span class="String">&quot;</span></span>)
</pre>

<p>En los casos dónde usemos la opción <strong>:default</strong>, debe aparecer con el <strong>TimeZone</strong> especificado ya selecionado.</p>

<h3> El método formatted_offset</h3>

<p>Se incluyó el método <strong>formatted_offset</strong> en las clases <strong>Time</strong> y <strong>DateTime</strong> para retornar con el formato <strong>+HH:MM</strong> la desviación de la hora UTC. Por ejemplo, en nuestro timezone (Hora Brasilia) el valor de desviación retornado por el método sería un string con el valor: <strong>"-03:00"</strong>.</p>

<p>Veamos algunos ejemplos:</p>

<p>Obteniendo la desviación desde un DateTime:</p>

<pre class="mac_classic">    datetime <span class="Keyword">=</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">6</span>, <span class="Number">24</span>))
    datetime.<span class="FunctionName">formatted_offset</span>         <span class="Comment"><span class="Comment">#</span> =&gt; &quot;-06:00&quot;</span>
    datetime.<span class="FunctionName">formatted_offset</span>(<span class="BuiltInConstant">false</span>)  <span class="Comment"><span class="Comment">#</span> =&gt; &quot;-0600&quot;</span>
</pre>

<p>Ahora desde Time:</p>

<pre class="mac_classic">    <span class="LibraryObject">Time</span>.<span class="FunctionName">local</span>(<span class="Number">2000</span>).<span class="FunctionName">formatted_offset</span>         <span class="Comment"><span class="Comment">#</span> =&gt; &quot;-06:00&quot;</span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">local</span>(<span class="Number">2000</span>).<span class="FunctionName">formatted_offset</span>(<span class="BuiltInConstant">false</span>)  <span class="Comment"><span class="Comment">#</span> =&gt; &quot;-0600&quot;</span>
</pre>

<p>Note que este método retorna un <strong>string</strong>, el cual puede ser formateado o no dependiendo del valor dado como parámetro.</p>

<h3> El método with_env_tz</h3>

<p>El método <strong>with_env_tz</strong> nos permite hacer tests con diferentes timezones de una manera muy simple:</p>

<pre class="mac_classic">    <span class="Keyword">def</span> <span class="FunctionName">test_local_offset</span>
      with_env_tz <span class="String"><span class="String">'</span>US/Eastern<span class="String">'</span></span> <span class="Keyword">do</span>
        assert_equal <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">5</span>, <span class="Number">24</span>), <span class="LibraryObject">DateTime</span>.<span class="FunctionName">local_offset</span>
      <span class="Keyword">end</span>
      with_env_tz <span class="String"><span class="String">'</span>US/Central<span class="String">'</span></span> <span class="Keyword">do</span>
        assert_equal <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">6</span>, <span class="Number">24</span>), <span class="LibraryObject">DateTime</span>.<span class="FunctionName">local_offset</span>
      <span class="Keyword">end</span>
    <span class="Keyword">end</span>
</pre>

<p>Este helper</p>

<p>This helper was supposed to call <strong>with_timezone</strong>, but it was renamed for <strong>with_env_tz</strong> to avoid confusion with the timezone informed by using <strong>ENV['TZ']</strong> and <strong>Time.zone</strong>.</p>

<h3> Time.zone_reset!</h3>

<p>Se eliminó por que ya no se usa más.</p>

<h3> Time#in_current_time_zone</h3>

<p>Se modificó para que retorne <strong>self</strong> cuando <strong>Time.zone</strong> es null.</p>

<h3> Time#change_time_zone_to_current</h3>

<p>Se modificó para que retorne <strong>self</strong> cuando <strong>Time.zone</strong> es null.</p>

<h3> TimeZone#now</h3>

<p>El método <strong>TimeZone#now</strong> se modificó para que retorne un objeto <strong>ActiveSupport::TimeWithZone</strong> represetando la hora actual en el timezone configurado en <strong>Time.zone</strong>. Por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span> <span class="Keyword">=</span> <span class="String"><span class="String">'</span>Hawaii<span class="String">'</span></span>  <span class="Comment"><span class="Comment">#</span> =&gt; &quot;Hawaii&quot;</span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span>.<span class="FunctionName">now</span>         <span class="Comment"><span class="Comment">#</span> =&gt; Wed, 23 Jan 2008 20:24:27 HST -10:00</span>
</pre>

<h3> Compare_with_coercion</h3>

<p>Se creó el método <strong>compare_with_coercion</strong> (con un alias para &lt;=>) en las clases <strong>Time</strong> y <strong>DateTime</strong>, posibilitando  la comparación cronológica entre las clases <strong>Time</strong>, <strong>DateTime</strong> y las instancias de <strong>ActiveSupport::TimeWithZone</strong>. Para una mejor comprensión, veamos los siguientes ejemplos:</p>

<pre class="mac_classic">    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">1999</span>, <span class="Number">12</span>, <span class="Number">31</span>, <span class="Number">23</span>, <span class="Number">59</span>, <span class="Number">59</span>, <span class="Number">999</span>) <span class="Comment"><span class="Comment">#</span> 1</span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">0</span>) <span class="Comment"><span class="Comment">#</span> 0</span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">001</span>)) <span class="Comment"><span class="Comment">#</span> -1</span>

    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">1999</span>, <span class="Number">12</span>, <span class="Number">31</span>, <span class="Number">23</span>, <span class="Number">59</span>, <span class="Number">59</span>) <span class="Comment"><span class="Comment">#</span> 1</span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">0</span>) <span class="Comment"><span class="Comment">#</span> 0</span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">1</span>)) <span class="Comment"><span class="Comment">#</span> -1</span>

    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">ActiveSupport</span>::<span class="FunctionName">TimeWithZone</span>.<span class="FunctionName">new</span>(<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">1999</span>, <span class="Number">12</span>, <span class="Number">31</span>, <span class="Number">23</span>, <span class="Number">59</span>, <span class="Number">59</span>) )
    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">ActiveSupport</span>::<span class="FunctionName">TimeWithZone</span>.<span class="FunctionName">new</span>(<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">0</span>) )
    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">ActiveSupport</span>::<span class="FunctionName">TimeWithZone</span>.<span class="FunctionName">new</span>(<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">1</span>) ))
</pre>

<h3> TimeWithZone#between?</h3>

<p>Se incluyó el método <strong>between?</strong>  en la clase <strong>TimeWithZone</strong> para verificar si una instancia está entre dos fechas. Por ejemplo:</p>

<pre class="mac_classic">    <span class="Variable"><span class="Variable">@</span>twz</span>.<span class="FunctionName">between?</span>(<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">1999</span>,<span class="Number">12</span>,<span class="Number">31</span>,<span class="Number">23</span>,<span class="Number">59</span>,<span class="Number">59</span>),
                  <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>,<span class="Number">1</span>,<span class="Number">1</span>,<span class="Number">0</span>,<span class="Number">0</span>,<span class="Number">1</span>))
</pre>

<h3> TimeZone#parse</h3>

<p>Este método crea una nueva instancia de <strong>ActiveSupport::TimeWithZone</strong> a partir de un string. Por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>Hawaii<span class="String">&quot;</span></span>
<span class="Comment">    <span class="Comment">#</span> =&gt; &quot;Hawaii&quot;</span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span>.<span class="FunctionName">parse</span>(<span class="String"><span class="String">'</span>1999-12-31 14:00:00<span class="String">'</span></span>)
<span class="Comment">    <span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 14:00:00 HST -10:00</span>


    <span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span>.<span class="FunctionName">now</span>
<span class="Comment">    <span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 14:00:00 HST -10:00</span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span>.<span class="FunctionName">parse</span>(<span class="String"><span class="String">'</span>22:30:00<span class="String">'</span></span>)
<span class="Comment">    <span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 22:30:00 HST -10:00</span>
</pre>

<h3> TimeZone#at</h3>

<p>Este método crea una nueva instancia de <strong>ActiveSupport::TimeWithZone</strong> a partir del número de segundos desde la fecha Unix epoch. Por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>Hawaii<span class="String">&quot;</span></span> <span class="Comment"><span class="Comment">#</span> =&gt; &quot;Hawaii&quot;</span>
    <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>).<span class="FunctionName">to_f</span>  <span class="Comment"><span class="Comment">#</span> =&gt; 946684800.0</span>

    <span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span>.<span class="FunctionName">at</span>(<span class="Number">946684800.0</span>)
<span class="Comment">    <span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 14:00:00 HST -10:00</span>
</pre>

<h3> Más métodos</h3>

<p>Los métodos <strong>to_a</strong>, <strong>to_f</strong>, <strong>to_i</strong>, <strong>httpdate</strong>, <strong>rfc2822</strong>, <strong>to_yaml</strong>, <strong>to_datetime</strong> y  <strong>eql?</strong> se agregaron a la clase <strong>TImeWithZone</strong>.  Para más información acerca de estos métodos por favor lea la documentación de Rails.</p>

<h3> Se preparó la clase TimeWithZone para Ruby 1.9</h3>

<p>En Ruby 1.9 tendremos algunos métodos nuevos en la clase <strong>Time</strong>, como por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Time</span>.<span class="FunctionName">now</span>
<span class="Comment">    <span class="Comment">#</span> =&gt; Thu Nov 03 18:58:25 CET 2005</span>

    <span class="LibraryObject">Time</span>.<span class="FunctionName">now</span>.<span class="FunctionName">sunday?</span>
<span class="Comment">    <span class="Comment">#</span> =&gt; false</span>
</pre>

<p>Este mismo método existe para cada día de la semana</p>

<p>Otras cosa interesante es que el método <strong>to_s</strong> del objeto <strong>Time</strong> tendrá un valor de retorno diferente. Hoy cuando ejecutamos  <strong>Time.new.to_s</strong>, obtenemos lo siguiente:</p>

<pre class="mac_classic">    <span class="LibraryObject">Time</span>.<span class="FunctionName">new</span>.<span class="FunctionName">to_s</span>
<span class="Comment">    <span class="Comment">#</span> =&gt; &quot;Thu Oct 12 10:39:27 +0200 2006&quot;</span>
</pre>

<p>En Ruby 1.9 vamos a tener:</p>

<pre class="mac_classic">    <span class="LibraryObject">Time</span>.<span class="FunctionName">new</span>.<span class="FunctionName">to_s</span>
<span class="Comment">    <span class="Comment">#</span> =&gt; &quot;2006-10-12 10:39:24 +0200&quot;</span>
</pre>

<p>¿Que tiene que ver todo esto con Rails 2.1? Todo. Rails se está preparando para proveer estas modificaciones. La clase <strong>TimeWithZone</strong>, por ejemplo, sólo tuvo algunas mejoras para funcionar con los métodos del primer ejemplo.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Auto Link</h2>

<p>El método  <strong>auto_link</strong> recibe cualquier texto como parámetro, y si el texto contiene alguna dirección de email o website, retorna el mismo texto, pero con hyperlinks.</p>

<p>Por ejemplo:</p>

<pre class="mac_classic">    <span class="FunctionName">auto_link</span>(<span class="String"><span class="String">&quot;</span>Go to this website now: http://www.rubyonrails.com<span class="String">&quot;</span></span>)
<span class="Comment">    <span class="Comment">#</span> =&gt; Go to this website now: http://www.rubyonrails.com</span>
</pre>

<p>Algunos sites, como Amazon, usan el símbolo "=" en sus URL. Este método no reconoce este símbolo. Veamos como se comporta este método en tal caso:</p>

<pre class="mac_classic">    <span class="FunctionName">auto_link</span>(<span class="String"><span class="String">&quot;</span>http://www.amazon.com/Testing/ref=pd_bbs_sr_1<span class="String">&quot;</span></span>)
<span class="Comment">    <span class="Comment">#</span> =&gt; http://www.amazon.com/Testing/ref</span>
</pre>

<p>Note que el método corta el hyperlink exactamente antes del símbolo "=", antes de Rails 2.1 este símbolo estaba soportado.</p>

<p>El mismo método se actualizó para permitir el uso de URL con paréntesis.</p>

<p>Un ejemplo de URL coc paréntesis:</p>

<pre class="mac_classic">    http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>en.<span class="FunctionName">wikipedia</span>.<span class="FunctionName">org</span><span class="Keyword">/</span>wiki<span class="Keyword">/</span><span class="Variable">Sprite_</span>(computer_graphics)
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Etiquetas</h2>

<p>Cuando creamos un nuevo formulario con <strong>scaffold</strong> será creado con el siguiente código:</p>

<pre class="mac_classic">    <span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="FunctionName">form_for</span>(<span class="Variable"><span class="Variable">@</span>post</span>) <span class="Keyword">do </span>|<span class="Variable">f</span>| <span class="String"><span class="String">%&gt;</span></span>
<span class="String">      &lt;p<span class="String">&gt;</span></span>
        <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">label</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span> <span class="String"><span class="String">%&gt;</span>&lt;br /<span class="String">&gt;</span></span>
        <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">text_field</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">      &lt;/p<span class="String">&gt;</span></span>
      <span class="Keyword">&lt;</span>p<span class="Keyword">&gt;</span>
        <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">label</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>body</span> <span class="String"><span class="String">%&gt;</span>&lt;br /<span class="String">&gt;</span></span>
        <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">text_area</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>body</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">      &lt;/p<span class="String">&gt;</span></span>
      <span class="Keyword">&lt;</span>p<span class="Keyword">&gt;</span>
        <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">submit</span> <span class="String"><span class="String">&quot;</span>Update<span class="String">&quot;</span></span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">      &lt;/p<span class="String">&gt;</span></span>
    <span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="Keyword">end</span> <span class="String"><span class="String">%&gt;</span></span>
</pre>

<p>Se incluyó el método <strong>label</strong>. Este método retorna un <em>string</em> con el título de la columna dentro de un tag HTML <strong>&lt;label></strong>.</p>

<pre class="mac_classic">    <span class="Keyword">&gt;&gt;</span> f.<span class="FunctionName">label</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span>
    =&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>post_title<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">Title</span><span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>

    <span class="Keyword">&gt;&gt;</span> f.<span class="FunctionName">label</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span>, <span class="String"><span class="String">&quot;</span>A short title<span class="String">&quot;</span></span>
    =&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>post_title<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">A</span> short title<span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>

    <span class="Keyword">&gt;&gt;</span> label <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span>, <span class="String"><span class="String">&quot;</span>A short title<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class</span> =&gt; <span class="String"><span class="String">&quot;</span>title_label<span class="String">&quot;</span></span>
    =&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>post_title<span class="String">&quot;</span></span> <span class="Keyword">class</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>title_label<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">A</span> short title<span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>
</pre>

<p>¿Se dió cuenta del parámetro <strong>for</strong> dentro del tag? "post_title" es el título que contiene nuetro título para el post. El tag <strong>&lt;label></strong> de hecho una etiqueta asociada al objeto <strong>post_title</strong>. Cuando alguien hace click sobre la etiqueta (que no es un link) el controlador HTML asociado recive el foco.</p>

<p>Robby Russell escribió un post interesante en su blog acerca de este tema. Ud. lo puede leer en: <a href="http://www.robbyonrails.com/articles/2007/12/02/that-checkbox-needs-a-label">http://www.robbyonrails.com/articles/2007/12/02/that-checkbox-needs-a-label</a></p>

<p>También se incluyó el método <strong>label_tag</strong> en <strong>FormTagHelper</strong>. Este método funciona como label, pero de una forma más simple:</p>

<pre class="mac_classic">    <span class="Keyword">&gt;&gt;</span> label_tag <span class="String"><span class="String">'</span>name<span class="String">'</span></span>
    =&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>name<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">Name</span><span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>

    <span class="Keyword">&gt;&gt;</span> label_tag <span class="String"><span class="String">'</span>name<span class="String">'</span></span>, <span class="String"><span class="String">'</span>Your name<span class="String">'</span></span>
    =&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>name<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">Your</span> name<span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>

    <span class="Keyword">&gt;&gt;</span> label_tag <span class="String"><span class="String">'</span>name<span class="String">'</span></span>, <span class="BuiltInConstant">nil</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class</span> =&gt; <span class="String"><span class="String">'</span>small_label<span class="String">'</span></span>
    =&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>name<span class="String">&quot;</span></span> <span class="Keyword">class</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>small_label<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">Name</span><span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>
</pre>

<p>El método acepta la opción <strong>:for</strong>, Veamos un ejemplo:</p>

<pre class="mac_classic">    <span class="FunctionName">label</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>post</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span>, <span class="BuiltInConstant">nil</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>for</span> =&gt; <span class="String"><span class="String">&quot;</span>my_for<span class="String">&quot;</span></span>)
</pre>

<p>Esto va retornar algo como lo siguiente:</p>

<pre class="mac_classic">    <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>my_for<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">Title</span><span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Una nueva forma de usar partials</h2>

<p>El uso de partials es algo muy común para eliminar la duplicación de código en el desarrollo de software con Rails. Aquí hay un ejemplo:</p>

<pre class="mac_classic">    <span class="Keyword">&lt;</span><span class="Keyword">%</span> form_for <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>user</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>url</span> =&gt; users_path <span class="Keyword">do </span><span class="String"><span class="String">%&gt;</span></span>
<span class="String">            &lt;%= render :partial =<span class="String">&gt;</span></span> <span class="String"><span class="String">'</span>form<span class="String">'</span></span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">            &lt;%= submit_tag 'Create' %<span class="String">&gt;</span></span>
    <span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="Keyword">end</span> <span class="String"><span class="String">%&gt;</span></span>
</pre>

<p>Un <strong>Partial</strong> es un fragmento de código (una plantilla). La ventaja de usar un <strong>partial</strong> es eliminar la duplicación innecesaria de código. Usar un <strong>partial</strong> es muy simple, puede comenzar con algo como esto: <strong>render :partial => "name"</strong>. Y debe crear un archivo con el mismo nombre que su <strong>partial</strong>, pero anteponiéndole un guión bajo</p>

<p>En el código de arriba vimos como podemos usar un patial, en Rails 2.1 ud. va a poder hacer lo mismo pero una forma un poco diferente:</p>

<pre class="mac_classic">    <span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="FunctionName">form_for</span>(<span class="Variable"><span class="Variable">@</span>user</span>) <span class="Keyword">do </span>|<span class="Variable">f</span>| <span class="String"><span class="String">%&gt;</span></span>
<span class="String">            &lt;%= render :partial =<span class="String">&gt;</span></span> f <span class="String"><span class="String">%&gt;</span></span>
<span class="String">            &lt;%= submit_tag 'Create' %<span class="String">&gt;</span></span>
    <span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="Keyword">end</span> <span class="String"><span class="String">%&gt;</span></span>
</pre>

<p>En este ejemplo vamos a renderizar el partial "users/_form", el cual va a recibir una variable llamada "form" con las referencias creadas por <strong>FormBuilder</strong>.</p>

<p>La vieja forma continúa funcionando en Rails 2.1</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Nuevos espacios de nombres en Atom Feed</h2>

<p>¿Conoce el método <strong>atom_feed</strong>? Es una de las nuevas características de Rails 2.0, que facilita la creación de Feeds de Atom. Veamos un ejemplo de como se usa:</p>

<p>En el archivo <em>index.atom.builder</em>:</p>

<pre class="mac_classic">    atom_feed <span class="Keyword">do </span>|<span class="Variable">feed</span>|
      feed.<span class="FunctionName">title</span>(<span class="String"><span class="String">&quot;</span>Nome do Jogo<span class="String">&quot;</span></span>)
      feed.<span class="FunctionName">updated</span>((<span class="Variable"><span class="Variable">@</span>posts</span>.<span class="FunctionName">first</span>.<span class="FunctionName">created_at</span>))

      <span class="Keyword">for</span> post <span class="Keyword">in</span> <span class="Variable"><span class="Variable">@</span>posts</span>
        feed.<span class="FunctionName">entry</span>(post) <span class="Keyword">do </span>|<span class="Variable">entry</span>|
          entry.<span class="FunctionName">title</span>(post.<span class="FunctionName">title</span>)
          entry.<span class="FunctionName">content</span>(post.<span class="FunctionName">body</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>type</span> =&gt; <span class="String"><span class="String">'</span>html<span class="String">'</span></span>)

          entry.<span class="FunctionName">author</span> <span class="Keyword">do </span>|<span class="Variable">author</span>|
            author.<span class="FunctionName">name</span>(<span class="String"><span class="String">&quot;</span>Carlos Brando<span class="String">&quot;</span></span>)
          <span class="Keyword">end</span>
        <span class="Keyword">end</span>
      <span class="Keyword">end</span>
    <span class="Keyword">end</span>
</pre>

<p>¿Qué es un Atom feed? Atom es el nombre de estilos y metadatos en formato XML. En otras palabras es un protocolo para publicar contenidos en Internet que son actualizados con frecuencia, como un blog por ejemplo. Los Feeds se publican siempre en XML y en Atom son identificados como tipo de medios application/atom+xml.</p>

<p>En las primeras versiones de Rails 2.0 este método aceptaba parámetros como: <strong>:language</strong>, <strong>:root_url</strong> and <strong>:url</strong>, puede obtener más información acerca de estos métodos en la documentación de Rails. pero con la nueva modificación, ahora podemos incluir nuevos espacios de nombre en el elemento raíz del feed. Por ejemplo:</p>

<pre class="mac_classic">    <span class="FunctionName">atom_feed</span>(<span class="String"><span class="String">'</span>xmlns:app<span class="String">'</span></span> =&gt; <span class="String"><span class="String">'</span>http://www.w3.org/2007/app<span class="String">'</span></span>) <span class="Keyword">do </span>|<span class="Variable">feed</span>|
</pre>

<p>Va a retornar:</p>

<pre class="mac_classic">    <span class="Keyword">&lt;</span>feed xml<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lang=</span><span class="String"><span class="String">&quot;</span>en-US<span class="String">&quot;</span></span> xmlns<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>http://www.w3.org/2005/Atom<span class="String">&quot;</span></span>
            xmlns<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>app=</span><span class="String"><span class="String">&quot;</span>http://www.w3.org/2007/app<span class="String">&quot;</span></span><span class="Keyword">&gt;</span>
</pre>

<p>Modificando el ejemplo usado antes, podríamos hacer esto:</p>

<pre class="mac_classic">    <span class="FunctionName">atom_feed</span>({<span class="String"><span class="String">'</span>xmlns:app<span class="String">'</span></span> =&gt; <span class="String"><span class="String">'</span>http://www.w3.org/2007/app<span class="String">'</span></span>,
            <span class="String"><span class="String">'</span>xmlns:openSearch<span class="String">'</span></span> =&gt; <span class="String"><span class="String">'</span>http://a9.com/-/spec/opensearch/1.1/<span class="String">'</span></span>}) <span class="Keyword">do </span>|<span class="Variable">feed</span>|

      feed.<span class="FunctionName">title</span>(<span class="String"><span class="String">&quot;</span>Nome do Jogo<span class="String">&quot;</span></span>)
      feed.<span class="FunctionName">updated</span>((<span class="Variable"><span class="Variable">@</span>posts</span>.<span class="FunctionName">first</span>.<span class="FunctionName">created_at</span>))
      feed.<span class="FunctionName">tag!</span>(openSearch<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>totalResults</span>, <span class="Number">10</span>)

      <span class="Keyword">for</span> post <span class="Keyword">in</span> <span class="Variable"><span class="Variable">@</span>posts</span>
        feed.<span class="FunctionName">entry</span>(post) <span class="Keyword">do </span>|<span class="Variable">entry</span>|
          entry.<span class="FunctionName">title</span>(post.<span class="FunctionName">title</span>)
          entry.<span class="FunctionName">content</span>(post.<span class="FunctionName">body</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>type</span> =&gt; <span class="String"><span class="String">'</span>html<span class="String">'</span></span>)
          entry.<span class="FunctionName">tag!</span>(<span class="String"><span class="String">'</span>app:edited<span class="String">'</span></span>, <span class="LibraryObject">Time</span>.<span class="FunctionName">now</span>)

          entry.<span class="FunctionName">author</span> <span class="Keyword">do </span>|<span class="Variable">author</span>|
            author.<span class="FunctionName">name</span>(<span class="String"><span class="String">&quot;</span>Carlos Brando<span class="String">&quot;</span></span>)
          <span class="Keyword">end</span>
        <span class="Keyword">end</span>
      <span class="Keyword">end</span>
    <span class="Keyword">end</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Cache</h2>

<p>Ahora todos los métodos de <strong>fragment_cache_key</strong> retornan por defecto el namespace 'view/' como prefijo.</p>

<p>Se eliminaron todos los caching store de <strong>ActionController::Caching::Fragments::</strong><em> y ahora están en <strong>ActiveSupport::Cache::</strong></em>. En este caso, si ud. a hecho una referencia a store, como por ejemplo: <strong>ActionController::Caching::Fragments::MemoryStore</strong>, va a tener que cambiarla por: <strong>ActiveSupport::Cache::MemoryStore</strong>.</p>

<p><strong>ActionController::Base.fragment_cache_store* no va más, y </strong>ActionController::Base.cache_store** toma su lugar.</p>

<p>Se incluyó en  <strong>ActiveRecord::Base</strong> el método <strong>cache_key</strong> que facilita el modo de almacenamiento de cache de Active Records mediante la nueva biblioteca <strong>ActiveSupport::Cache::</strong>*. Funciona así:</p>

<pre class="mac_classic">    <span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Product</span>.<span class="FunctionName">new</span>.<span class="FunctionName">cache_key</span>
    =&gt; <span class="String"><span class="String">&quot;</span>products/new<span class="String">&quot;</span></span>

    <span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Product</span>.<span class="FunctionName">find</span>(<span class="Number">5</span>).<span class="FunctionName">cache_key</span>
    =&gt; <span class="String"><span class="String">&quot;</span>products/5<span class="String">&quot;</span></span>

    <span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="Number">5</span>).<span class="FunctionName">cache_key</span>
    =&gt; <span class="String"><span class="String">&quot;</span>people/5-20071224150000<span class="String">&quot;</span></span>
</pre>

<p>Se incluyó <strong>ActiveSupport::Gzip.decompress/compress</strong> para facilitar el uso de como mapeo para <strong>Zlib</strong>.</p>

<p>Ahora ud. puede usar las opciones de ambiente (environment) <strong>config.cache_store</strong> para especificar el valor por defecto del tipo de almacenamiento de cache. Como hemos mencionado si existe el directorio <strong>tmp/cache</strong>, el valor por defecto es <strong>FileStore</strong>, en otro caso se usará <strong>MemoryStore</strong>, puede configurarlo de la siguiente manera:</p>

<pre class="mac_classic">    config.<span class="FunctionName">cache_store</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>memory_store</span>
    config.<span class="FunctionName">cache_store</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>file_store</span>, <span class="String"><span class="String">&quot;</span>/path/to/cache/directory<span class="String">&quot;</span></span>
    config.<span class="FunctionName">cache_store</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>drb_store</span>, <span class="String"><span class="String">&quot;</span>druby://localhost:9192<span class="String">&quot;</span></span>
    config.<span class="FunctionName">cache_store</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>mem_cache_store</span>, <span class="String"><span class="String">&quot;</span>localhost<span class="String">&quot;</span></span>
    config.<span class="FunctionName">cache_store</span> <span class="Keyword">=</span> <span class="LibraryObject">MyOwnStore</span>.<span class="FunctionName">new</span>(<span class="String"><span class="String">&quot;</span>parameter<span class="String">&quot;</span></span>)
</pre>

<p>Para hace las cosas más fáciles aún, el comentario de abajo se incluye en <em>environments/production.rb</em>, en favor de recordarle estas opciones.</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Use a different cache store in production</span>
<span class="Comment">    <span class="Comment">#</span> config.cache_store = :mem_cache_store</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Aplicando formato de título en strings.</h2>

<p>Había un bug cuando usábamos el método <strong>String#titleize</strong> en un string que contenía 's. El bug hacía que el método returne la 's en mayúsculas. Vea el ejemplo:</p>

<pre class="mac_classic">    <span class="Keyword">&gt;&gt;</span> <span class="String"><span class="String">&quot;</span>brando's blog<span class="String">&quot;</span></span>.<span class="FunctionName">titleize</span>
    =&gt; <span class="String"><span class="String">&quot;</span>Brando'S Blog<span class="String">&quot;</span></span>
</pre>

<p>Vea el ejemplo que con el bug corregido:</p>

<pre class="mac_classic">    <span class="Keyword">&gt;&gt;</span> <span class="String"><span class="String">&quot;</span>brando's blog<span class="String">&quot;</span></span>.<span class="FunctionName">titleize</span>
    =&gt; <span class="String"><span class="String">&quot;</span>Brando's Blog<span class="String">&quot;</span></span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> action_name</h2>

<p>Para saber cual vista fue invocada durante la ejecución de su vista, podemos usar  el método <strong>action_name</strong>:</p>

<pre class="mac_classic">    <span class="Keyword">&lt;</span><span class="Keyword">%=</span> action_name <span class="String"><span class="String">%&gt;</span></span>
</pre>

<p>El valor de retorno va a ser el mismo que usando <strong>params[:action]</strong>, pero de una forma más elegante.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> caches_action acepta condicionales</h2>

<p>El método <strong>caches_action</strong> ahora acepta la opción <strong>:if</strong>, permitiendo el uso de condicionales para especificar cuando una acción (<strong>action</strong>) puede ser cacheada (<strong>cached</strong>) Por ejemplo:</p>

<pre class="mac_classic">    caches_action <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>if</span> =&gt; <span class="LibraryObject">Proc</span>.<span class="FunctionName">new</span> { |<span class="Variable">c</span>| <span class="Keyword">!</span>c.<span class="FunctionName">request</span>.<span class="FunctionName">format</span>.<span class="FunctionName">json?</span> }
</pre>

<p>En el ejemplo de arriba, la <strong>acción index</strong> será cacheada únicamente si no es accedida por una petición JSON.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Conditional in the caches_page method</h2>

<p>The <strong>caches_page</strong> method now has the option to use conditionals (<strong>:if</strong>). See example:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> The Rails 2.0 way</span>
    caches_page <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span>

<span class="Comment">    <span class="Comment">#</span> In Rails 2.1 you can use :if option</span>
    caches_page <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>if</span> =&gt; <span class="LibraryObject">Proc</span>.<span class="FunctionName">new</span> { |<span class="Variable">c</span>| <span class="Keyword">!</span>c.<span class="FunctionName">request</span>.<span class="FunctionName">format</span>.<span class="FunctionName">json?</span> }
</pre>

<h2> flash.now now works in tests</h2>

<p>Who didn't have headaches because of this ? The problem was that during tests we could never confirm if a message was stored in flash, because it was cleared by Rails before going to your test script.</p>

<p>In rails 2.1 the problem was solved. Now you can include the following line in your tests:</p>

<pre class="mac_classic">assert_equal <span class="String"><span class="String">'</span>&gt;value_now&lt;<span class="String">'</span></span>, flash[<span class="String"><span class="String">'</span>test_now<span class="String">'</span></span>]
</pre>

<h2> Accessing Helpers outside Views</h2>

<p>How often have you created a <strong>helper</strong> and wished you could use it inside your <strong>controller</strong> ? To achieve this functionality you had to included the <strong>helper</strong> module inside the <strong>controller</strong>, which made your code look ugly.</p>

<p>In Rails 2.1 a proxy to access helpers outside views was developed. It works in a very simple way:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> To access simple_format method, for example</span>
<span class="LibraryObject">ApplicationController</span>.<span class="FunctionName">helpers</span>.<span class="FunctionName">simple_format</span>(text)
</pre>

<p>Simple and Clean!</p>

<h2> JSON</h2>

<p>Rails now accepts POST's requests of JSON content. For example, you can send a POST request this way:</p>

<pre class="mac_classic"><span class="Variable">POST</span> <span class="Keyword">/</span>posts
{<span class="String"><span class="String">&quot;</span>post<span class="String">&quot;</span></span>: {<span class="String"><span class="String">&quot;</span>title<span class="String">&quot;</span></span>: <span class="String"><span class="String">&quot;</span>Breaking News<span class="String">&quot;</span></span>}}
</pre>

<p>And everything goes to variable <strong>params</strong>. This works for example:</p>

<pre class="mac_classic"><span class="Keyword">def</span> <span class="FunctionName">create</span>
  <span class="Variable"><span class="Variable">@</span>post</span> <span class="Keyword">=</span> <span class="LibraryObject">Post</span>.<span class="FunctionName">create</span> params[<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>post</span>]
<span class="Comment">  <span class="Comment">#</span> …</span>
<span class="Keyword">end</span>
</pre>

<p>Some of you many not know JSON is a "competitor" for XML, and it is widely used for JavaScript data interchange because it's represented in this language. It takes its name from: <strong>JavaScript Object Notation</strong>.</p>

<h2> Path Names</h2>

<p>My blog readers (http://www.nomedojogo.com) should know about my <strong>Custom Resource Name</strong> plugin. I think it'll die very soon... :(</p>

<p>In rails you could already include the option <strong>:as</strong> in your routes (something I implemented in my plugin to keep compatibility). Now you will also have the <strong>:path_names</strong> option to change the name of your <strong>actions</strong>.</p>

<pre class="mac_classic">map.<span class="FunctionName">resource</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>schools</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>as</span> =&gt; <span class="String"><span class="String">'</span>escolas<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>path_names</span> =&gt; { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>new</span> =&gt; <span class="String"><span class="String">'</span>nova<span class="String">'</span></span> }
</pre>

<p>Of course, my plugin will remain being useful for users of earlier Rails versions.</p>

<h2> Defining the location of your routes file</h2>

<p>In Rails 2.1 you can define in which file your routes are stored, including the following line in your <em>enviroment.rb</em>:</p>

<pre class="mac_classic">config.<span class="FunctionName">routes_configuration_file</span>
</pre>

<p>This can be useful in a scenario where you have two separated front-ends that share the same modules, libraries and plugins.</p>

<p>For example, getsatisfaction.com and api.getsatisfaction.com share the same models, but not the controllers, helpers and views. getsatisfaction has its own routes file with optimizations to improve its SEO, while the API route's file doesn't know anything about SEO improvements.</p>

<h2> session(:on)</h2>

<p>Did you know it is possible to turn off sessions in rails? Here is how to do it:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">ApplicationController<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActionController::Base</span></span>
  session <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>off</span>
<span class="Keyword">end</span>
</pre>

<p>Note that in my example I'm turning off sessions for all controllers (<strong>ApplicationController</strong>), but I could also do it for a single controller.</p>

<p>If you want to have sessions on for a given controller in Rails 2.1 you can use the session method method passing the <strong>:on</strong> parameter:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">UsersController<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ApplicationController</span></span>
  session <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>on</span>
<span class="Keyword">end</span>
</pre>

<h2> Testing Helpers in a simple way</h2>

<p>One very boring thing to do in earlier versions of Rails is testing the <strong>helpers</strong>. I already suffered a lot to ensure 100% of coverage, creating tests for some <strong>helpers</strong>.</p>

<p>This became much simpler in Rails 2.1 with the <strong>ActionView::TestCase</strong> class. Look the example:</p>

<pre class="mac_classic"><span class="Keyword">module</span> <span class="TypeName">PeopleHelper</span>
  <span class="Keyword">def</span> <span class="FunctionName">title</span>(<span class="FunctionParameter">text</span>)
    <span class="FunctionName">content_tag</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>h1</span>, text)
  <span class="Keyword">end</span>

  <span class="Keyword">def</span> <span class="FunctionName">homepage_path</span>
    people_path
  <span class="Keyword">end</span>
<span class="Keyword">end</span>
</pre>

<p>Now look how we can do the same in Rails 2.1:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">PeopleHelperTest<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActionView::TestCase</span></span>
  <span class="Keyword">def</span> <span class="FunctionName">setup</span>
    <span class="LibraryObject">ActionController</span>::<span class="FunctionName">Routing</span>::<span class="FunctionName">Routes</span>.<span class="FunctionName">draw</span> <span class="Keyword">do </span>|<span class="Variable">map</span>|
      map.<span class="FunctionName">people</span> <span class="String"><span class="String">'</span>people<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>controller</span> =&gt; <span class="String"><span class="String">'</span>people<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>action</span> =&gt; <span class="String"><span class="String">'</span>index<span class="String">'</span></span>
      map.<span class="FunctionName">connect</span> <span class="String"><span class="String">'</span>:controller/:action/:id<span class="String">'</span></span>
    <span class="Keyword">end</span>
  <span class="Keyword">end</span>

  <span class="Keyword">def</span> <span class="FunctionName">test_title</span>
    assert_equal <span class="String"><span class="String">&quot;</span>&lt;h1&gt;Ruby on Rails&lt;/h1&gt;<span class="String">&quot;</span></span>, <span class="FunctionName">title</span>(<span class="String"><span class="String">&quot;</span>Ruby on Rails<span class="String">&quot;</span></span>)
  <span class="Keyword">end</span>

  <span class="Keyword">def</span> <span class="FunctionName">test_homepage_path</span>
    assert_equal <span class="String"><span class="String">&quot;</span>/people<span class="String">&quot;</span></span>, homepage_path
  <span class="Keyword">end</span>
<span class="Keyword">end</span>
</pre>

<h1> ActionController</h1>

<p>ActionController is the layer responsible by receiving web requests and taking decisions of what is going to be run and rendered or to redirect the request to another action.
An Action is defined as public methods within controllers which are automatically available through routes.</p>

<h2> ActionController::Routing</h2>

<h3> Map.root</h3>

<p>Now, when using <strong>map.root</strong> you can be much more <strong>DRY</strong> using an alias for that.</p>

<p>In the earlier versions of rails you used to do it like this:</p>

<pre class="mac_classic">map.<span class="FunctionName">new_session</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>controller</span> =&gt; <span class="String"><span class="String">'</span>sessions<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>action</span> =&gt; <span class="String"><span class="String">'</span>new<span class="String">'</span></span>
map.<span class="FunctionName">root</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>controller</span> =&gt; <span class="String"><span class="String">'</span>sessions<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>action</span> =&gt; <span class="String"><span class="String">'</span>new<span class="String">'</span></span>
</pre>

<p>Now you can do it this way:</p>

<pre class="mac_classic">map.<span class="FunctionName">new_session</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>controller</span> =&gt; <span class="String"><span class="String">'</span>sessions<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>action</span> =&gt; <span class="String"><span class="String">'</span>new<span class="String">'</span></span>
map.<span class="FunctionName">root</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>new_session</span>
</pre>

<h3> Routes recognition </h3>

<p>Routes recognition's old implementation used to sweep all routes, one by one, and often turned to be very time consuming. A new and smarter implementation was developed. It creates a tree for routes and the route recognition is made by prefixing, skipping similar routes. This approach lowers recognition time in approximately 2.7 times. </p>

<p>All the new implementations are in the file <strong>recognition_optimisation.rb</strong> and its working details are well explained in the comments. See the the documentation inside the source code itself for more information about its implementation.</p>

<h3> Assert_routing</h3>

<p>Now it's possible to test a route with an HTTP method. Look at the following example:</p>

<pre class="mac_classic"><span class="FunctionName">assert_routing</span>({ <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>method</span> =&gt; <span class="String"><span class="String">'</span>put<span class="String">'</span></span>,
                 <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>path</span> =&gt; <span class="String"><span class="String">'</span>/product/321<span class="String">'</span></span> },
               { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>controller</span> =&gt; <span class="String"><span class="String">&quot;</span>product<span class="String">&quot;</span></span>,
                 <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>action</span> =&gt; <span class="String"><span class="String">&quot;</span>update<span class="String">&quot;</span></span>,
                 <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>id</span> =&gt; <span class="String"><span class="String">&quot;</span>321<span class="String">&quot;</span></span> })
</pre>

<h3> Map.resources</h3>

<p>Imagine you have a site written in a language other than english, and you want to taylor your routes to use the same language. In other words, instead of having:</p>

<pre class="mac_classic">http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>www.<span class="FunctionName">mysite</span>.<span class="FunctionName">com</span>.<span class="FunctionName">br</span><span class="Keyword">/</span>products<span class="Keyword">/</span><span class="Number">1234</span><span class="Keyword">/</span>reviews
</pre>

<p>You wished to have something like this:</p>

<pre class="mac_classic">http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>www.<span class="FunctionName">mysite</span>.<span class="FunctionName">com</span>.<span class="FunctionName">br</span><span class="Keyword">/</span>produtos<span class="Keyword">/</span><span class="Number">1234</span><span class="Keyword">/</span>comentarios
</pre>

<p>This was already possible, but not in a simple way and without compromising some rails conventions.</p>

<p>Now we have the option <strong>:as</strong> within <strong>map.resources</strong> to personalize our routes. Look our example to get the URL above in portuguese:</p>

<pre class="mac_classic">map.<span class="FunctionName">resources</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>products</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>as</span> =&gt; <span class="String"><span class="String">'</span>produtos<span class="String">'</span></span> <span class="Keyword">do </span>|<span class="Variable">product</span>|
<span class="Comment">  <span class="Comment">#</span> product_reviews_path(product) ==</span>
<span class="Comment">  <span class="Comment">#</span> '/produtos/1234/comentarios’</span>
  product.<span class="FunctionName">resources</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>product_reviews</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>as</span> =&gt; <span class="String"><span class="String">'</span>comentarios<span class="String">'</span></span>
<span class="Keyword">end</span>
</pre>

<h2> ActionController::Caching::Sweeping</h2>

<p>In the earlier versions of rails, when we declared a <strong>sweeper</strong>, we had to inform the class using symbols:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">ListsController<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ApplicationController</span></span>
  caches_action <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>show</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>public</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>feed</span>
  cache_sweeper <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>list_sweeper</span>,
                <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>only</span> =&gt; [ <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>edit</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>destroy</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>share</span> ]
<span class="Keyword">end</span>
</pre>

<p>Now it's possible to explicitly declare a class instead of using a symbol. This is necessary if your <strong>sweeper</strong> is inside a module. Though you can still use symbols for other cases from now on you can also do it this way:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">ListsController<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ApplicationController</span></span>
  caches_action <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>show</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>public</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>feed</span>
  cache_sweeper <span class="LibraryObject">OpenBar</span>::<span class="FunctionName">Sweeper</span>,
                <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>only</span> =&gt; [ <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>edit</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>destroy</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>share</span> ]
<span class="Keyword">end</span>
</pre>

<h1>ActionView</h1>

<p>ActionView es la capa responsable de la generación de interfaces visibles al usuario a través de la conversión de plantillas ERB.</p>

<h2> ActionView::Helpers::FormHelper</h2>

<h3> fields_for form_for con la opción index.</h3>

<p>Los métodos <strong>#fields_for</strong> y <strong>form_for</strong> recibían la opción <strong>:index</strong>, eliminando la necesidad de utilizar <strong>:index => nil</strong> en cada objeto form. Mira los ejemplos:</p>

<p>Así es como solía ser el código antes:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%</span> fields_for <span class="String"><span class="String">&quot;</span>project[task_attributes][]<span class="String">&quot;</span></span>, task <span class="Keyword">do </span>|<span class="Variable">f</span>| <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;%= f.text_field :name, :index =<span class="String">&gt;</span></span> <span class="BuiltInConstant">nil</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;%= f.hidden_field :id, :index =<span class="String">&gt;</span></span> <span class="BuiltInConstant">nil</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;%= f.hidden_field :should_destroy, :index =<span class="String">&gt;</span></span> <span class="BuiltInConstant">nil</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">&lt;% end %<span class="String">&gt;</span></span>
</pre>

<p>Ahora luce de la siguiente forma:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%</span> fields_for <span class="String"><span class="String">&quot;</span>project[task_attributes][]<span class="String">&quot;</span></span>, task,
              <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span> =&gt; <span class="BuiltInConstant">nil</span> <span class="Keyword">do </span>|<span class="Variable">f</span>| <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;%= f.text_field :name %<span class="String">&gt;</span></span>
  <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">hidden_field</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>id</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;%= f.hidden_field :should_destroy %<span class="String">&gt;</span></span>
<span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="Keyword">end</span> <span class="String"><span class="String">%&gt;</span></span>
</pre>

<h2> ActionView::Helpers::DateHelper</h2>

<p>Ahora, todos estos métodos de módulo para trabajar con fechas (<strong>date_select</strong>, <strong>time_select</strong>, <strong>select_datetime</strong>, etc.) aceptan opciones  <strong>HTML</strong>. Mira un ejemplo usando <strong>date_select</strong></p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%=</span> date_select <span class="String"><span class="String">'</span>item<span class="String">'</span></span>,<span class="String"><span class="String">'</span>happening<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>order</span> =&gt; [<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>day</span>], <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class</span> =&gt; <span class="String"><span class="String">'</span>foobar<span class="String">'</span></span><span class="String"><span class="String">%&gt;</span></span>
</pre>

<h3> date_helper</h3>

<p>El método <strong>date_helper</strong> fue actualizado para que use <strong>Date.current</strong> en orden de definir su valor predeterminado.</p>

<h2> ActionView::Helpers::AssetTagHelper</h2>

<h3> register_javascript_expansion</h3>

<p>Este método registra uno o más archivos javascript para su inclusión cuando un símbolo, definido por el programador, es indicado como parámetro del método <strong>javascript_include_tag</strong>. La idea es llamar a este método dentro del archivo <strong>init.rb</strong> de tu plugin, en orden de registrar los archivos javascript que tu plugin ubica en la carpeta <strong>public/javascripts</strong>. Veamos como funciona: </p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> En el archivo init.rb</span>
<span class="LibraryObject">ActionView</span>::<span class="FunctionName">Helpers</span>::<span class="FunctionName">AssetTagHelper</span>.<span class="FunctionName">register_javascript_expansion</span> 
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>monkey</span> =&gt; [<span class="String"><span class="String">&quot;</span>head<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>body<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>tail<span class="String">&quot;</span></span>] 

<span class="Comment"><span class="Comment">#</span> En nuestar vista:</span>
javascript_include_tag <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>monkey</span>

<span class="Comment"><span class="Comment">#</span> Vamos a obtener:</span>
<span class="Keyword">&lt;</span>script type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span> src<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/javascripts/head.js<span class="String">&quot;</span></span>&gt;<span class="Keyword">&lt;</span><span class="Keyword">/</span>script<span class="Keyword">&gt;</span>
<span class="Keyword">&lt;</span>script type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span> src<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/javascripts/body.js<span class="String">&quot;</span></span>&gt;<span class="Keyword">&lt;</span><span class="Keyword">/</span>script<span class="Keyword">&gt;</span>
<span class="Keyword">&lt;</span>script type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span> src<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/javascripts/tail.js<span class="String">&quot;</span></span>&gt;<span class="Keyword">&lt;</span><span class="Keyword">/</span>script<span class="Keyword">&gt;</span>
</pre>

<h3> register_stylesheet_expansion</h3>

<p>Este método hace exactamente lo mismo que que el método <strong>ActionView::Helpers::AssetTagHelper#register_javascript_expansion</strong>, pero crea un símbolo para ser usado luego cuando se realicen llamadas al método <strong>stylesheet_link_tag</strong>. Veamos un ejemplo: </p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> En el archivo init.rb</span>
<span class="LibraryObject">ActionView</span>::<span class="FunctionName">Helpers</span>::<span class="FunctionName">AssetTagHelper</span>.<span class="FunctionName">register_stylesheet_expansion</span> 
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>monkey</span> =&gt; [<span class="String"><span class="String">&quot;</span>head<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>body<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>tail<span class="String">&quot;</span></span>] 

<span class="Comment"><span class="Comment">#</span> En nuestar vista:</span>
stylesheet_link_tag <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>monkey</span>

<span class="Comment"><span class="Comment">#</span> Vamos a obtener:</span>
<span class="Keyword">&lt;</span>link href<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/stylesheets/head.css<span class="String">&quot;</span></span>  media<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>screen<span class="String">&quot;</span></span> rel<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>stylesheet<span class="String">&quot;</span></span> 
    type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/css<span class="String">&quot;</span></span> <span class="Keyword">/</span><span class="Keyword">&gt;</span>
<span class="Keyword">&lt;</span>link href<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/stylesheets/body.css<span class="String">&quot;</span></span>  media<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>screen<span class="String">&quot;</span></span> rel<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>stylesheet<span class="String">&quot;</span></span> 
    type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/css<span class="String">&quot;</span></span> <span class="Keyword">/</span><span class="Keyword">&gt;</span>
<span class="Keyword">&lt;</span>link href<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/stylesheets/tail.css<span class="String">&quot;</span></span>  media<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>screen<span class="String">&quot;</span></span> rel<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>stylesheet<span class="String">&quot;</span></span> 
    type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/css<span class="String">&quot;</span></span> <span class="Keyword">/</span><span class="Keyword">&gt;</span>
</pre>

<h2> ActionView::Helpers::FormTagHelper</h2>

<h3> submit_tag</h3>

<p>Se agregó la opción <strong>:confirm</strong> a los parámetros del método <strong>#submit_tag</strong>. Esta opción funciona de la misma forma que el método <strong>link_to</strong>. Veamos un ejemplo: </p>

<pre class="mac_classic"><span class="FunctionName">submit_tag</span>(<span class="String"><span class="String">'</span>Save changes<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>confirm</span> =&gt; <span class="String"><span class="String">&quot;</span>Are you sure?<span class="String">&quot;</span></span>)
</pre>

<h2> ActionView::Helpers::NumberHelper</h2>

<h3> number_to_currency</h3>

<p>El método <strong>number_to_currency</strong> ahora acepta la opción <strong>:format</strong> como parámetro, permitiéndonos dar formato al valor retornado. En versiones anteriores, cuando teníamos que dar formato a monedas locales, debíamos incluir un espacio antes de la opción <strong>:unit</strong> para que el formato retornado sea el correcto. Veamos un ejemplo: </p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> R$ es el símbolo de la moneda de Brasil.</span>
<span class="FunctionName">number_to_currency</span>(<span class="Number">9.99</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>separator</span> =&gt; <span class="String"><span class="String">&quot;</span>,<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>delimiter</span> =&gt; <span class="String"><span class="String">&quot;</span>.<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unit</span> =&gt; <span class="String"><span class="String">&quot;</span>R$<span class="String">&quot;</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;R$9,99″</span>

<span class="FunctionName">number_to_currency</span>(<span class="Number">9.99</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>format</span> =&gt; <span class="String"><span class="String">&quot;</span>%u %n<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>separator</span> =&gt; <span class="String"><span class="String">&quot;</span>,<span class="String">&quot;</span></span>, 
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>delimiter</span> =&gt; <span class="String"><span class="String">&quot;</span>.<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unit</span> =&gt; <span class="String"><span class="String">&quot;</span>R$<span class="String">&quot;</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;R$ 9,99″</span>
</pre>

<p>Por otro lado, podemos personalizar de otras formas, por ejemplo: <br/>
</p>

<pre class="mac_classic"><span class="FunctionName">number_to_currency</span>(<span class="Number">9.99</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>format</span> =&gt; <span class="String"><span class="String">&quot;</span>%n en reales brasileros<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>separator</span> =&gt; <span class="String"><span class="String">&quot;</span>,<span class="String">&quot;</span></span>,
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>delimiter</span> =&gt; <span class="String"><span class="String">&quot;</span>.<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unit</span> =&gt; <span class="String"><span class="String">&quot;</span>R$<span class="String">&quot;</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;9,99 em reais&quot;</span>
</pre>

<p>Cuando creas tu cadena de formateo, se puedes especificar el siguiente parámetro: </p>

<pre class="mac_classic"><span class="Keyword">%</span>u <span class="Variable">Para</span> la moneda
<span class="Keyword">%</span>n <span class="Variable">Para</span> el número
</pre>

<h2> ActionView::Helpers::TextHelper</h2>

<h3> excerpt</h3>

<p>El método <strong>excerpt</strong> nos ayuda a encontrar una palabra dentro de una frase y nos devuelve la abreviatura de esa frase con el número de caracteres que se hayan especificado como parámetro antes y después de la palabra agregando "…" cuando sea necesario. Veamos un ejemplo:</p>

<pre class="mac_classic"><span class="FunctionName">excerpt</span>(<span class="String"><span class="String">'</span>This is an example<span class="String">'</span></span>, <span class="String"><span class="String">'</span>an<span class="String">'</span></span>, <span class="Number">5</span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;…s is an examp…&quot;</span>
</pre>

<p>Pero había un problema. Si cuentas, vas a notar que el método retorna 6 caracteres y no 5. Esto era un bug y fue corregido. Mira el ejemplo de la salida correcta de este método:</p>

<pre class="mac_classic"><span class="FunctionName">excerpt</span>(<span class="String"><span class="String">'</span>This is an example<span class="String">'</span></span>, <span class="String"><span class="String">'</span>an<span class="String">'</span></span>, <span class="Number">5</span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;…s is an exam…&quot;</span>
</pre>

<h3>simple_format</h3>

<p>El método <strong>simple_format</strong> básicamente recibe como parámetro cualquier texto y le da formato de una manera muy simple a <strong>HTML</strong>. Toma el texto y reemplaza los saltos de línea (\n) por el tag <strong>HTML</strong> "&lt; br />". Y cuando tenemos dos saltos de línea, uno atrás del otro, separa el texto con tags "&lt; p>".</p>

<p>En Rails 2.1 este método recibe un parámetros adicional. Además del texto, podemos informarle que atributo <strong>HTML</strong> nos gustaria que el tag "&lt; p>" incluyera. Veamos el ejemplo: </p>

<pre class="mac_classic"><span class="FunctionName">simple_format</span>(<span class="String"><span class="String">&quot;</span>Hello Mom!<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class</span> =&gt; <span class="String"><span class="String">'</span>description<span class="String">'</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;&lt;p class=’description’&gt;Hello Mom!&lt;/p&gt;&quot;</span>
</pre>

<p>Los atributos <strong>HTML</strong> serán agregados a todos los tags  "&lt; p>" creados por este método.</p>

<h1> Railties</h1>

<h2> config.gem</h2>

<p>Ahora es posible configurar todas las gemas necesarias para obtener un proyecto listo para su ejecución usando una nueva característica llamada <strong>config.gem</strong>. En el archivo <strong>environment.rb</strong> puedes especificar de qué gemas depende tu proyecto para ejecutarse correctamente. Veamos un ejemplo: </p>

<pre class="mac_classic">config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>bj<span class="String">&quot;</span></span>

config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>hpricot<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">'</span>0.6<span class="String">'</span></span>,
                      <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source</span> =&gt; <span class="String"><span class="String">&quot;</span>http://code.whytheluckystiff.net<span class="String">&quot;</span></span> 

config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>aws-s3<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>aws/s3<span class="String">&quot;</span></span>
</pre>

<p>Para instalar todas las dependencias de una sola vez, utilizamos una tarea Rake: </p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> Instala todas las gemas especificadas</span>
rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>install</span>
</pre>

<p>También es posible listar cuales gemas están siendo usadas en el proyecto ejecutando: </p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> Listando todas las dependencias</span>
rake gems
</pre>

<p>Si una de las gemas tiene un archivo <strong>rails/init.rb</strong> y vos querés llevar la gema con tu aplicación, podés hacer: </p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> Copia la gema especificada a vendor/gems/nome_do_gem-x.x.x</span>
rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unpack</span> <span class="Variable">GEM</span><span class="Keyword">=</span>gem_name
</pre>

<p>Entonces, la gema será copiada al directorio <strong>vendor/gems/gem_name-x.x.x</strong>. En caso de no especificas el nombre de la gema, Rails copiará todas las gemas al directorio <strong>vendor/gem</strong></p>

<h2> config.gem en plugins</h2>

<p>El comando <strong>config.gem</strong> está también disponible para ser utilizado con plugins.</p>

<p>Hasta Rails 2.0, el archivo <strong>init.rb</strong> de un plugin solía lucir de la siguiente forma: </p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> init.rb del plugin open_id_authentication</span>
<span class="Keyword">require</span> <span class="String"><span class="String">'</span>yadis<span class="String">'</span></span> 
<span class="Keyword">require</span> <span class="String"><span class="String">'</span>openid<span class="String">'</span></span> 
<span class="LibraryObject">ActionController</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">send</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include</span>, <span class="Variable">OpenIdAuthentication</span> 
</pre>

<p>Pero en Rails 2.1 el archivo <strong>init.rb</strong> sería:</p>

<pre class="mac_classic">config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>ruby-openid<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>openid<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">&quot;</span>1.1.4<span class="String">&quot;</span></span>
config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>ruby-yadis<span class="String">&quot;</span></span>,  <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>yadis<span class="String">&quot;</span></span>,  <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">&quot;</span>0.3.4<span class="String">&quot;</span></span> 

config.<span class="FunctionName">after_initialize</span> <span class="Keyword">do</span>
  <span class="LibraryObject">ActionController</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">send</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include</span>, <span class="Variable">OpenIdAuthentication</span>
<span class="Keyword">end</span>
</pre>

<p>Así que, cuando ejecutes la tarea para instalar todas las gemas necesarias, éstas estarán entre ellas.</p>

<h2> gems:build</h2>

<p>La tarea <strong>gems:build</strong> compila todas las extensiones de las gemas que fueron instaladas a través de <strong>gems:unpack</strong>. La sintaxis es la siguiente:</p>

<pre class="mac_classic">rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>build</span> <span class="Comment"><span class="Comment">#</span> Para todas las gemas</span>
rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>build</span> <span class="Variable">GEM</span><span class="Keyword">=</span>mygem <span class="Comment"><span class="Comment">#</span> Estoy especificando una gema</span>
</pre>

<h2> Nuevo mensaje cuando se inicializa el servidor</h2>

<p>Hubo una pequeña mejora en el inicio del servidor de Rails. Ahora se muestra cual versión está siendo cargada: </p>

<pre class="mac_classic"><span class="Variable">Rails</span> <span class="Number">2.1</span> application starting on http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span><span class="Number">0.0</span>.<span class="Number">0.0</span>:<span class="Number">3000</span>
</pre>

<h2> Rails.public_path</h2>

<p>Se agregó un acceso directo para recuperar el path del directorio <strong>"public"</strong> de un proyecto.</p>

<pre class="mac_classic"><span class="LibraryObject">Rails</span>.<span class="FunctionName">public_path</span>
</pre>

<h2> Rails.logger, Rails.root, Rails.env y Rails.cache</h2>

<p>En Rails 2.1 en vez de usar las constantes: <strong>RAILS_DEFAULT_LOGGER</strong>, <strong>RAILS_ROOT</strong>, <strong>RAILS_ENV</strong> and <strong>RAILS_CACHE</strong>. Ahora usaremos:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> RAILS_DEFAULT_LOGGER</span>
<span class="LibraryObject">Rails</span>.<span class="FunctionName">logger</span>

<span class="Comment"><span class="Comment">#</span> RAILS_ROOT</span>
<span class="LibraryObject">Rails</span>.<span class="FunctionName">root</span>

<span class="Comment"><span class="Comment">#</span> RAILS_ENV</span>
<span class="LibraryObject">Rails</span>.<span class="FunctionName">env</span>

<span class="Comment"><span class="Comment">#</span> RAILS_CACHE</span>
<span class="LibraryObject">Rails</span>.<span class="FunctionName">cache</span>
</pre>

<h2> Rails.version</h2>

<p>En versiones anteriores para descubrir, en tiempo de ejecución, cual es la versión de Rails en uso usabamos:</p>

<pre class="mac_classic"><span class="LibraryObject">Rails</span>::<span class="FunctionName">VERSION</span>::<span class="FunctionName">STRING</span>
</pre>

<p>En Rails 2.1 cambió a:</p>

<pre class="mac_classic"><span class="LibraryObject">Rails</span>.<span class="FunctionName">version</span>
</pre>

<h2>Obteniendo información acerca de un plugin</h2>

<p>Esta es una de las nuevas características de Rails 2.1 que probablemente nunca uses. Digo "probablemente", porque en algunos casos específicos puede ser útil, por ejemplo, para saber la versión de un plugin. </p>

<p>Para probarlo, necesitamos crear un archivo que se llame <em>about.yml</em> en el directorio del plugin, con algo como lo siguiente:</p>

<pre class="mac_classic">author: <span class="Variable">Carlos</span> <span class="Variable">Brando</span>
version: <span class="Number">1.2</span>.<span class="Number">0</span>
description: <span class="Variable">Una</span> descripción acerca del plugin
url: http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>www.<span class="FunctionName">nomedojogo</span>.<span class="FunctionName">com</span>
</pre>

<p>Podemos obtener esta información luego de esta manera:</p>

<pre class="mac_classic">plugin <span class="Keyword">=</span> <span class="LibraryObject">Rails</span>::<span class="FunctionName">Plugin</span>.<span class="FunctionName">new</span>(plugin_directory)
plugin.<span class="FunctionName">about</span>[<span class="String"><span class="String">&quot;</span>author<span class="String">&quot;</span></span>] <span class="Comment"><span class="Comment">#</span> =&gt; “Carlos Brando”</span>
plugin.<span class="FunctionName">about</span>[<span class="String"><span class="String">&quot;</span>url<span class="String">&quot;</span></span>] <span class="Comment"><span class="Comment">#</span> =&gt; “http://www.nomedojogo.com”</span>
</pre>

<p>Si encontrás algún buen uso de esta carácterística y la querés compartir conmigo, tal vez cambie mi opinión acerca de su real necesidad. </p>

<h1> Rake Tasks, Plugins y Scripts</h1>

<h2> Tareas</h2>

<h3> rails:update</h3>

<p>De ahora en más, cada vez que ejecutes la tarea <strong>rake rails:freeze:edge</strong>, esta también ejecutará  <strong>rails:update</strong>, actualizando los archivos de configuración y los <em>JavaScripts</em>.</p>

<h3> Base de datos en 127.0.0.1</h3>

<p>Un cambio fue realizado en el archivo database.rake que solía buscar unicamente en localhost bases de datos locales. Ahora considerará <strong>127.0.0.1</strong>. Esto funciona para las tareas <strong>create</strong> y <strong>drop</strong>. El archivo database.rake también fue refactorizado para hacer el codigo menos repetitivo. </p>

<h3> Congelando a una versión de Rails específica.</h3>

<p>Hasta Rails 2.1 no era posible congelar a una versión de Rails específica dentro de un proyecto. Solo podías utilizar la Revisión como parámetro. En Rails 2.1, podemos congelar a una versión específica con el siguiente comando: </p>

<pre class="mac_classic">rake rails<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>freeze</span><span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>edge</span> <span class="Variable">RELEASE</span><span class="Keyword">=</span><span class="Number">1.2</span>.<span class="Number">0</span>
</pre>

<h2> TimeZone</h2>

<h4> rake time:zones:all</h4>

<p>Devuelve todas las zonas horarias conocidas para Rails, agrupadas por uso horario. También podés filtar los valores retornados usando el parámetro óptico OFFSET, por ejemplo: OFFSET=-6.</p>

<h4> rake time:zones:us</h4>

<p>Muestra lista con todas las zonas horarias de Estados Unidos. La opción OFFSET también es valida en este contexto.</p>

<h4> rake time:zones:local</h4>

<p>Retorna todas las zonas horarias conocidas por Rails que están en el mismo uso horario que tu sistema operativo. </p>

<h2> Scripts</h2>

<h3> plugin</h3>

<p>El comando script/plugin install ahora provee la opción -e/--export que emite un svn export.<br/>
Se agregó soporte para plugins alojados en repositorios GIT.</p>

<h3> dbconsole</h3>

<p>Este script hace lo mismo que script/console, solo que para la base de datos. En otras palabras, te conecta con el cliente por línea de comando de tu base de datos.</p>

<p>Mirando al código, este funcionaría solamente con mysql, postgresql y sqlite(3). Cuando sea especificada otra base de datos en el archivo database.yml, el script mostrará: "not supported for this database type".</p>

<h2> Plugins</h2>

<h3> Gemas ahora pueden ser plugins</h3>

<p>Ahora, cualqioer gema que tenga un archivo <strong>rails/init.rb</strong> puede ser instalado dentro del directorio <strong>vendor</strong> de tu proyecto Rails igual que un <strong>plugin</strong>.</p>

<h3> Usando generadores en plugins</h3>

<p>Es posible configurar <strong>Rails</strong> para buscar <strong>plugins</strong> en directorios diferentes a <strong>vendor/plugins</strong>, solo incluyendo esta línea de código en el archivo <strong>environment.rb</strong>.</p>

<pre class="mac_classic">config.<span class="FunctionName">plugin_paths</span> <span class="Keyword">=</span> [<span class="String"><span class="String">'</span>lib/plugins<span class="String">'</span></span>, <span class="String"><span class="String">'</span>vendor/plugins<span class="String">'</span></span>]
</pre>

<p>Rails 2.0 tenía un bug en esta configuración que muestraba cuando un plugin tenía generadores. Por ese bug, Rails solo encuentra generadores en plugins que estén dentro de <strong>vendor/plugins</strong>. En Rails 2.1 ese bug fue corregido.   <br/>
</p>

<h1> Prototype y script.aculo.us</h1>

<h2> Prototype</h2>

<p>Rails 2.1 ahora usa Prototype versión 1.6.0.1. Este sirve como base de la versión 1.8.1 de script.aculo.us.</p>

<h1> Ruby 1.9</h1>

<h2> Details</h2>

<p>El foco principal de los cambios de Rails fue Ruby 1.9, aún detalles menores fueon analizados para incrementar la compatibilidad de Rails con la nueva versión de Ruby. Detalles como cambiar <strong>File.exists?</strong> por <strong>File.exist?</strong> no fueron dejados de lado.</p>

<p>Además, en Ruby 1.9, el modulo <strong>Base64</strong> (base64.rb) fue eliminado, por esa razón, todas las referencias fueron remplazadas por  <strong>ActiveSupport::Base64</strong>.</p>

<h2>Nuevos métodos para la clase DateTime</h2>

<p>Con el objetivo de mantener compatibilidad (duck-typing) con la clase <strong>Time</strong>, tres nuevos métodos fueron agregado a la clase <strong>DateTime</strong>. Los métodos son <strong>#utc</strong>, <strong>#utc?</strong> y <strong>#utc_offset</strong>. veamos un ejemplo de cada uno:</p>

<pre class="mac_classic"><span class="Keyword">&gt;&gt;</span> date <span class="Keyword">=</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2005</span>, <span class="Number">2</span>, <span class="Number">21</span>, <span class="Number">10</span>, <span class="Number">11</span>, <span class="Number">12</span>, <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">6</span>, <span class="Number">24</span>))
<span class="Comment"><span class="Comment">#</span>=&gt; Mon, 21 Feb 2005 10:11:12 -0600</span>

<span class="Keyword">&gt;&gt;</span> date.<span class="FunctionName">utc</span>
<span class="Comment"><span class="Comment">#</span>=&gt; Mon, 21 Feb 2005 16:11:12 +0000</span>

<span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2005</span>, <span class="Number">2</span>, <span class="Number">21</span>, <span class="Number">10</span>, <span class="Number">11</span>, <span class="Number">12</span>, <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">6</span>, <span class="Number">24</span>)).<span class="FunctionName">utc?</span>
<span class="Comment"><span class="Comment">#</span>=&gt; false</span>

<span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2005</span>, <span class="Number">2</span>, <span class="Number">21</span>, <span class="Number">10</span>, <span class="Number">11</span>, <span class="Number">12</span>, <span class="Number">0</span>).<span class="FunctionName">utc?</span>
<span class="Comment"><span class="Comment">#</span>=&gt; true</span>

<span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2005</span>, <span class="Number">2</span>, <span class="Number">21</span>, <span class="Number">10</span>, <span class="Number">11</span>, <span class="Number">12</span>, <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">6</span>, <span class="Number">24</span>)).<span class="FunctionName">utc_offset</span>
<span class="Comment"><span class="Comment">#</span>=&gt; -21600</span>
</pre>

<h1> Debug</h1>

<h2>Ruby-debug Nativo</h2>

<p>Fue habilitado nuevamente la opción para utilizar <strong>ruby-debug</strong> en pruebas con Rails. Ahora, teniendo en cueta que tenés la gema instalada, solo se necesita el método <strong>debugger</strong>.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h1> Bugs y arreglos</h1>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Aregar columnas en PostgreSQL</h2>

<p>Había un bug usando  <strong>PostgreSQL</strong>. El bug ocurría cuando creabamos una migración para agregar una columna en una tabla existente. Por ejemplo:</p>

<p>Archivo: <em>db/migrate/002_add_cost.rb</em></p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">AddCost<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Migration</span></span>
      <span class="Keyword">def</span> <span class="FunctionName">self.up</span>
        add_column <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>items</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>cost</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>decimal</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>precision</span> =&gt; <span class="Number">6</span>,
       <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>scale</span> =&gt; <span class="Number">2</span>
      <span class="Keyword">end</span>

      <span class="Keyword">def</span> <span class="FunctionName">self.down</span>
        remove_column <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>items</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>cost</span>
      <span class="Keyword">end</span>
    <span class="Keyword">end</span>
</pre>

<p>Note que estamos creadno una columna con <strong>:precision => 6</strong> y  <strong>:scale => 2</strong>. Ahora ejecutamos <strong>rake db:migrate</strong> y vemos como se ve nuestra tabla en la base de datos:</p>

<table border="1" cellspacing="0" cellpadding="5">
        <tr>
                <td><strong>Column</strong></td>
                <td><strong>Type</strong></td>
                <td><strong>Modifiers</strong></td>
        </tr>
        <tr>
                <td>id</td>
                <td>integer</td>
                <td>not null</td>
        </tr>
        <tr>
                <td>descr</td>
                <td>character varying(255)</td>
                <td></td>
        </tr>
        <tr>
                <td>price</td>
                <td>numeric(5,2)</td>
                <td></td>
        </tr>
        <tr>
                <td>cost</td>
                <td>numeric</td>
                <td></td>
        </tr>
</table>


<p>Vea la columna "cost" que acabamos de crear. Es un <strong>numeric</strong> común, pero debería ser como la columna "price" de arriba, más precisamente un <strong>numeric(6,2)</strong>. En Rails 2.1 este error no sucede más y la columan se crea correctamente.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2>Mime Types</h2>

<p>Se arregló un bug que no permitía definir el atributo para <strong>request.format</strong> usando un símbolo. Ahora podemos usar el siguiente código:</p>

<pre class="mac_classic">    request.<span class="FunctionName">format</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>iphone</span>
    assert_equal <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>iphone</span>, request.<span class="FunctionName">format</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2>Bug fixes en change_column</h2>

<p>Se arregló un bug en el uso del método <strong>change_column</strong> con <strong>:null => true</strong> en una columna creada usando <strong>:null => false</strong>. Debido a este bug no se realizó ningún cambio al usar este método.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h1> Información adicional</h1>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Protección contra Cross Site Scripting</h2>

<p>En Rails 2.0 el archivo <em>application.rb</em> era así:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">ApplicationController<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActionController::Base</span></span>
      helper <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>

      protect_from_forgery
    <span class="Keyword">end</span>
</pre>

<p>Vea la llamada al método  <strong>protect_from_forgery</strong>.</p>

<p>¿Escuchó hablar sobre Cross Site Scripting? Este es el nombre de una fallo de seguridad que se puede encontrar en la mayoría de los sitios y aplicaciones web que permiten a gente mala (estoy hablando de adolescentes que no tienen nada que hacer y tampoco tienen vida social) alterar el contenido de las páginas web, para llevar acabo 'fishing attacks', tomando el control del navegador a través de código javascript y en la mayoría de las veces forzando el usuario a ejecutar un el comando que ellos quieran. Este último tipo de ataque se llama 'cross-site request forgery'.</p>

<p>Cross Site Request Forgery es un tipo de ataque fuerza al usuario a ejecutar comandos si que este lo sepa. Y con el incremento del uso de ajax, las cosas empeoran.</p>

<p>Actualmente, este método es útil para asegurar que todos los formularios de tu aplicación están recibiendo datos que vienen de la misma aplicación, y no desde un link perdido en otro sitio. Esto se hace inlcuyendo un token basado en la sesión en todos los formularios y peticiones ajax generadas por Rails, y luego verificando la autenticidad de este token en el controlador.</p>

<p>Recuerder que las peticiones GET no están protegidas. Pero esto no es un problema si usamos sólamente para obtener datos, y nunca para alterar o guardar nada en nuestra base de datos.</p>

<p>Si ud. quiere aprender más acerca de CSRF (Cross-Site Request Forgery) vaya a la siguiente dirección:</p>

<ul>
<li><p><a href="http://www.nomedojogo.com/2008/01/14/como-um-garoto-chamado-samy-pode-derrubar-seu-site/isc.sans.org/diary.html?storyid=1750">http://www.nomedojogo.com/2008/01/14/como-um-garoto-chamado-samy-pode-derrubar-seu-site/isc.sans.org/diary.html?storyid=1750</a></p></li>
<li><p><a href="http://www.nomedojogo.com/2008/01/14/como-um-garoto-chamado-samy-pode-derrubar-seu-site/isc.sans.org/diary.html?storyid=1750">http://www.nomedojogo.com/2008/01/14/como-um-garoto-chamado-samy-pode-derrubar-seu-site/isc.sans.org/diary.html?storyid=1750</a></p></li>
</ul>


<p>Pero recuerde que esta no es una solución definitiva al problema, o como decimos comunmente, noes una bala de plata.</p>

<h2> Used method_missing, then don't leave loose ends</h2>

<p>Due to Ruby's dynamic nature, the method <strong>respond_to?</strong> is crucial. How many times we had to check if a method exists in the object we're dealing with, or even check if the object is the same that we are expecting (<strong>is_a?</strong>)?</p>

<p>However there's something really important that many people forget. Look at this class that uses the method <strong>method_missing</strong>:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">Dog</span>
  <span class="Keyword">def</span> <span class="FunctionName">method_missing</span>(<span class="FunctionParameter">method<span class="FunctionParameter">,</span> <span class="Keyword">*</span>args<span class="FunctionParameter">,</span> <span class="Keyword">&amp;</span>block</span>)
    <span class="Keyword">if</span> method.<span class="FunctionName">to_s</span> <span class="Keyword">=~</span> <span class="String"><span class="String">/</span></span><span class="String">^bark</span><span class="String"><span class="String">/</span></span>
      puts <span class="String"><span class="String">&quot;</span>woofwoof!<span class="String">&quot;</span></span>
    <span class="Keyword">else</span>
      <span class="Keyword">super</span>
    <span class="Keyword">end</span>
  <span class="Keyword">end</span>
<span class="Keyword">end</span>

rex <span class="Keyword">=</span> <span class="LibraryObject">Dog</span>.<span class="FunctionName">new</span>
rex.<span class="FunctionName">bark</span> <span class="Comment"><span class="Comment">#</span>=&gt; woofwof!</span>
rex.<span class="FunctionName">bark!</span> <span class="Comment"><span class="Comment">#</span>=&gt; woofwoof!</span>
rex.<span class="FunctionName">bark_and_run</span> <span class="Comment"><span class="Comment">#</span>=&gt; woofwoof!</span>
</pre>

<p>I think you already know <strong>method_missing</strong>, don't you? In the example above I'm creating an instance of the class <strong>Dog</strong> and calling the methods <strong>bark</strong>, <strong>bark!</strong> e <strong>bark_and_run</strong> that don't exist. Then the method <strong>method_missing</strong> is called, where I use a simple regular expression to return "woofwoof!", whenever the name of the method begins with bark.</p>

<p>But look what happens when I try to use the method <strong>respond_to?</strong>:</p>

<pre class="mac_classic">rex.<span class="FunctionName">respond_to?</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>bark</span> <span class="Comment"><span class="Comment">#</span>=&gt; false</span>
rex.<span class="FunctionName">bark</span> <span class="Comment"><span class="Comment">#</span>=&gt; woofwoof!</span>
</pre>

<p>It returns false, and that makes all sense since the method doesn't really exist. Then it's my responsibility to change the method <strong>respond_to?</strong> to work properly using my special rule. I'll change my class to this:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">Dog</span>
  <span class="Variable">METHOD_BARK</span> <span class="Keyword">=</span> <span class="String"><span class="String">/</span></span><span class="String">^bark</span><span class="String"><span class="String">/</span></span>

  <span class="Keyword">def</span> <span class="FunctionName">respond_to?</span>(<span class="FunctionParameter">method</span>)
    <span class="Keyword">return</span> <span class="BuiltInConstant">true</span> <span class="Keyword">if</span> method.<span class="FunctionName">to_s</span> <span class="Keyword">=~</span> <span class="Variable">METHOD_BARK</span>
    <span class="Keyword">super</span>
  <span class="Keyword">end</span>

  <span class="Keyword">def</span> <span class="FunctionName">method_missing</span>(<span class="FunctionParameter">method<span class="FunctionParameter">,</span> <span class="Keyword">*</span>args<span class="FunctionParameter">,</span> <span class="Keyword">&amp;</span>block</span>)
    <span class="Keyword">if</span> method.<span class="FunctionName">to_s</span> <span class="Keyword">=~</span> <span class="Variable">METHOD_BARK</span>
      puts <span class="String"><span class="String">&quot;</span>woofwoof!<span class="String">&quot;</span></span>
    <span class="Keyword">else</span>
      <span class="Keyword">super</span>
    <span class="Keyword">end</span>
  <span class="Keyword">end</span>
<span class="Keyword">end</span>

rex <span class="Keyword">=</span> <span class="LibraryObject">Dog</span>.<span class="FunctionName">new</span>
rex.<span class="FunctionName">respond_to?</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>bark</span>) <span class="Comment"><span class="Comment">#</span>=&gt; true</span>
rex.<span class="FunctionName">bark</span> <span class="Comment"><span class="Comment">#</span>=&gt; woofwoof!</span>
</pre>

<p>Now we're talking! This is a common mistake that I've seen in some codes, Rails itself included. Try to execute a  <strong>respond_to?</strong> to check the existence of methods like <strong>find_by_name</strong>, for example.</p>

<p>Ruby is an amazing and highly flexible language, but if we don't watch it we can leave loose ends like this.</p>

<p>Of course that in Rails 2.1 this problem was fixed, we can use <strong>respond_to?</strong> to check the existence of methods like <strong>find_by_something</strong>.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> PostgreSQL</h2>

<p>En Rails 2.0, el adaptador para <strong>PostgreSQL</strong> tenía soporte solamente para las versiones 8.1 hasta 8.3. Se agregó soporte para las versiones 7.4 hasta la 8.3</p>

<h1> CHANGELOG</h1>

<h2> ActionMailer</h2>

<p>* Fixed that a return-path header would be ignored #7572 [joost]</p>

<p>* Less verbose mail logging: just recipients for :info log level; the whole email for :debug only.  #8000 [iaddict, Tarmo Tänav]</p>

<p>* Updated TMail to version 1.2.1 [raasdnil]</p>

<p>* Fixed that you don't have to call super in ActionMailer::TestCase#setup #10406 [jamesgolick]</p>

<h2> ActionPack</h2>

<p>* InstanceTag#default_time_from_options overflows to DateTime [Geoff Buesing]</p>

<p>* Fixed that forgery protection can be used without session tracking (Peter Jones) [#139]</p>

<p>* Added session(:on) to turn session management back on in a controller subclass if the superclass turned it off (Peter Jones) [#136]</p>

<p>* Change the request forgery protection to go by Content-Type instead of request.format so that you can't bypass it by POSTing to "#{request.uri}.xml" [rick]
* InstanceTag#default_time_from_options with hash args uses Time.current as default; respects hash settings when time falls in system local spring DST gap [Geoff Buesing]</p>

<p>* select_date defaults to Time.zone.today when config.time_zone is set [Geoff Buesing]</p>

<p>* Fixed that TextHelper#text_field would corrypt when raw HTML was used as the value (mchenryc, Kevin Glowacz) [#80]</p>

<p>* Added ActionController::TestCase#rescue_action_in_public! to control whether the action under test should use the regular rescue_action path instead of simply raising the exception inline (great for error testing) [DHH]</p>

<p>* Reduce number of instance variables being copied from controller to view. [Pratik]</p>

<p>* select_datetime and select_time default to Time.zone.now when config.time_zone is set [Geoff Buesing]</p>

<p>* datetime_select defaults to Time.zone.now when config.time_zone is set [Geoff Buesing]</p>

<p>* Remove ActionController::Base#view_controller_internals flag. [Pratik]</p>

<p>* Add conditional options to caches_page method. [Paul Horsfall]</p>

<p>* Move missing template logic to ActionView. [Pratik]</p>

<p>* Introduce ActionView::InlineTemplate class. [Pratik]</p>

<p>* Automatically parse posted JSON content for Mime::JSON requests.  [rick]</p>

<pre class="mac_classic"><span class="Variable">POST</span> <span class="Keyword">/</span>posts
    {<span class="String"><span class="String">&quot;</span>post<span class="String">&quot;</span></span>: {<span class="String"><span class="String">&quot;</span>title<span class="String">&quot;</span></span>: <span class="String"><span class="String">&quot;</span>Breaking News<span class="String">&quot;</span></span>}}

<span class="Keyword">def</span> <span class="FunctionName">create</span>
    <span class="Variable"><span class="Variable">@</span>post</span> <span class="Keyword">=</span> <span class="LibraryObject">Post</span>.<span class="FunctionName">create</span> params[<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>post</span>]
<span class="Comment">    <span class="Comment">#</span> ...</span>
<span class="Keyword">end</span>
</pre>

<p>* add json_escape ERB util to escape html entities in json strings that are output in HTML pages. [rick]</p>

<p>* Provide a helper proxy to access helper methods from outside views. Closes #10839 [Josh Peek]
  e.g. ApplicationController.helpers.simple_format(text)</p>

<p>* Improve documentation. [Xavier Noria, leethal, jerome]</p>

<p>* Ensure RJS redirect_to doesn't html-escapes string argument. Closes #8546 [josh, eventualbuddha, Pratik]</p>

<p>* Support render :partial => collection of heterogeneous elements.  #11491 [Zach Dennis]</p>

<p>* Avoid remote_ip spoofing.  [Brian Candler]</p>

<p>* Added support for regexp flags like ignoring case in the :requirements part of routes declarations #11421 [NeilW]</p>

<p>* Fixed that ActionController::Base#read_multipart would fail if boundary was exactly 10240 bytes #10886 [ariejan]</p>

<p>* Fixed HTML::Tokenizer (used in sanitize helper) didn't handle unclosed CDATA tags #10071 [esad, packagethief]</p>

<p>* Improve documentation. [Radar, Jan De Poorter, chuyeow, xaviershay, danger, miloops, Xavier Noria,  Sunny Ripert]</p>

<p>* Fixed that FormHelper#radio_button would produce invalid ids #11298 [harlancrystal]</p>

<p>* Added :confirm option to submit_tag #11415 [miloops]</p>

<p>* Fixed NumberHelper#number_with_precision to properly round in a way that works equally on Mac, Windows, Linux (closes #11409, #8275, #10090, #8027) [zhangyuanyi]</p>

<p>* Allow the #simple_format text_helper to take an html_options hash for each paragraph.  #2448 [Francois Beausoleil, thechrisoshow]</p>

<p>* Fix regression from filter refactoring where re-adding a skipped filter resulted in it being called twice.  [rick]</p>

<p>* Refactor filters to use Active Support callbacks.  #11235 [Josh Peek]</p>

<p>* Fixed that polymorphic routes would modify the input array #11363 [thomas.lee]</p>

<p>* Added :format option to NumberHelper#number_to_currency to enable better localization support #11149 [lylo]</p>

<p>* Fixed that TextHelper#excerpt would include one character too many #11268 [Irfy]</p>

<p>* Fix more obscure nested parameter hash parsing bug.  #10797 [thomas.lee]</p>

<p>* Added ActionView::Helpers::register_javascript/stylesheet_expansion to make it easier for plugin developers to inject multiple assets.  #10350 [lotswholetime]</p>

<p>* Fix nested parameter hash parsing bug.  #10797 [thomas.lee]</p>

<p>* Allow using named routes in ActionController::TestCase before any request has been made. Closes #11273 [alloy]</p>

<p>* Fixed that sweepers defined by cache_sweeper will be added regardless of the perform_caching setting. Instead, control whether the sweeper should be run with the perform_caching setting. This makes testing easier when you want to turn perform_caching on/off [DHH]</p>

<p>* Make MimeResponds::Responder#any work without explicit types. Closes #11140 [jaw6]</p>

<p>* Better error message for type conflicts when parsing params.  Closes #7962 [spicycode, matt]</p>

<p>* Remove unused ActionController::Base.template_class. Closes #10787 [Pratik]</p>

<p>* Moved template handlers related code from ActionView::Base to ActionView::Template. [Pratik]</p>

<p>* Tests for div_for and content_tag_for helpers. Closes #11223 [thechrisoshow]</p>

<p>* Allow file uploads in Integration Tests.  Closes #11091 [RubyRedRick]</p>

<p>* Refactor partial rendering into a PartialTemplate class. [Pratik]</p>

<p>* Added that requests with JavaScript as the priority mime type in the accept header and no format extension in the parameters will be treated as though their format was :js when it comes to determining which template to render. This makes it possible for JS requests to automatically render action.js.rjs files without an explicit respond_to block  [DHH]</p>

<p>* Tests for distance_of_time_in_words with TimeWithZone instances. Closes #10914 [ernesto.jimenez]</p>

<p>* Remove support for multivalued (e.g., '&amp;'-delimited) cookies. [Jamis Buck]</p>

<p>* Fix problem with render :partial collections, records, and locals. #11057 [lotswholetime] </p>

<p>* Added support for naming concrete classes in sweeper declarations [DHH]</p>

<p>* Remove ERB trim variables from trace template in case ActionView::Base.erb_trim_mode is changed in the application.  #10098 [tpope, kampers]</p>

<p>* Fix typo in form_helper documentation.  #10650 [xaviershay, kampers]</p>

<p>* Fix bug with setting Request#format= after the getter has cached the value.  #10889 [cch1]</p>

<p>* Correct inconsistencies in RequestForgeryProtection docs.  #11032 [mislav]</p>

<p>* Introduce a Template class to ActionView.  #11024 [lifofifo]</p>

<p>* Introduce the :index option for form_for and fields_for to simplify multi-model forms (see http://railscasts.com/episodes/75).  #9883 [rmm5t]</p>

<p>* Introduce map.resources :cards, :as => 'tarjetas' to use a custom resource name in the URL: cards_path == '/tarjetas'.  #10578 [blj]</p>

<p>* TestSession supports indifferent access.  #7372 [tamc, Arsen7, mhackett, julik, jean.helou]</p>

<p>* Make assert_routing aware of the HTTP method used.  #8039 [mpalmer]
  e.g. assert_routing({ :method => 'put', :path => '/product/321' }, { :controller => "product", :action => "update", :id => "321" })</p>

<p>* Make map.root accept a single symbol as an argument to declare an alias.  #10818 [bscofield] </p>

<p>  e.g.  map.dashboard '/dashboard', :controller=>'dashboard'</p>

<pre class="mac_classic">    map.<span class="FunctionName">root</span>      <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>dashboard</span>
</pre>

<p>* Handle corner case with image_tag when passed 'messed up' image names. #9018 [duncanbeevers, mpalmer]</p>

<p>* Add label_tag helper for generating elements. #10802 [DefV]</p>

<p>* Introduce TemplateFinder to handle view paths and lookups.  #10800 [Pratik Naik] </p>

<p>* Performance: optimize route recognition. Large speedup for apps with many resource routes.  #10835 [oleganza]</p>

<p>* Make render :partial recognise form builders and use the _form partial.  #10814 [djanowski]</p>

<p>* Allow users to declare other namespaces when using the atom feed helpers. #10304 [david.calavera]</p>

<p>* Introduce send_file :x_sendfile => true to send an X-Sendfile response header.  [Jeremy Kemper]</p>

<p>* Fixed ActionView::Helpers::ActiveRecordHelper::form for when protect_from_forgery is used #10739 [jeremyevans]</p>

<p>* Provide nicer access to HTTP Headers.  Instead of request.env["HTTP_REFERRER"] you can now use request.headers["Referrer"]. [Koz]</p>

<p>* UrlWriter respects relative_url_root.  #10748 [Cheah Chu Yeow]</p>

<p>* The asset_host block takes the controller request as an optional second argument. Example: use a single asset host for SSL requests.  #10549 [Cheah Chu Yeow, Peter B, Tom Taylor]</p>

<p>* Support render :text => nil.  #6684 [tjennings, PotatoSalad, Cheah Chu Yeow]</p>

<p>* assert_response failures include the exception message.  #10688 [Seth Rasmussen]</p>

<p>* All fragment cache keys are now by default prefixed with the "views/" namespace [DHH]</p>

<p>* Moved the caching stores from ActionController::Caching::Fragments::* to ActiveSupport::Cache::*. If you're explicitly referring to a store, like ActionController::Caching::Fragments::MemoryStore, you need to update that reference with ActiveSupport::Cache::MemoryStore [DHH]</p>

<p>* Deprecated ActionController::Base.fragment_cache_store for ActionController::Base.cache_store [DHH]</p>

<p>* Made fragment caching in views work for rjs and builder as well #6642 [zsombor]</p>

<p>* Fixed rendering of partials with layout when done from site layout #9209 [antramm]</p>

<p>* Fix atom_feed_helper to comply with the atom spec.  Closes #10672 [xaviershay]</p>

<pre class="mac_classic"><span class="Variable">The</span> tags created <span class="Keyword">do </span><span class="Keyword">not</span> contain a date (http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>feedvalidator.<span class="FunctionName">org</span><span class="Keyword">/</span>docs<span class="Keyword">/</span>error<span class="Keyword">/</span><span class="LibraryObject">InvalidTAG</span>.<span class="FunctionName">html</span>)
<span class="Variable">IDs</span> are <span class="Keyword">not</span> guaranteed unique
<span class="Variable">A</span> default <span class="Variable">self</span> link was <span class="Keyword">not</span> provided, contrary to the documentation
<span class="Variable">NOTE</span>:  <span class="Variable">This</span> changes tags <span class="Keyword">for</span> existing atom entries, but at least they validate now.
</pre>

<p>* Correct indentation in tests.  Closes #10671 [l.guidi]</p>

<p>* Fix that auto_link looks for ='s in url paths (Amazon urls have them).  Closes #10640 [bgreenlee]</p>

<p>* Ensure that test case setup is run even if overridden.  #10382 [Josh Peek]</p>

<p>* Fix HTML Sanitizer to allow trailing spaces in CSS style attributes.  Closes #10566 [wesley.moxam]</p>

<p>* Add :default option to time_zone_select.  #10590 [Matt Aimonetti]</p>

<h2> ActiveRecord</h2>

<p>* Add ActiveRecord::Base.sti_name that checks ActiveRecord::Base#store_full_sti_class? and returns either the full or demodulized name. [rick]</p>

<p>* Add first/last methods to associations/named_scope. Resolved #226. [Ryan Bates]</p>

<p>* Added SQL escaping for :limit and :offset #288 [Aaron Bedra, Steven Bristol, Jonathan Wiess] </p>

<p>* Added first/last methods to associations/named_scope. Resolved #226. [Ryan Bates]</p>

<p>* Ensure hm:t preloading honours reflection options. Resolves #137. [Frederick Cheung]</p>

<p>* Added protection against duplicate migration names (Aslak Hellesøy) [#112]</p>

<p>* Base#instantiate_time_object: eliminate check for Time.zone, since we can assume this is set if time_zone_aware_attributes is set to true [Geoff Buesing]</p>

<p>* Time zone aware attribute methods use Time.zone.parse instead of #to_time for String arguments, so that offset information in String is respected. Resolves #105. [Scott Fleckenstein, Geoff Buesing]</p>

<p>* Added change_table for migrations (Jeff Dean) [#71]. Example:</p>

<pre class="mac_classic">change_table <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>videos</span> <span class="Keyword">do </span>|<span class="Variable">t</span>|
  t.<span class="FunctionName">timestamps</span>                          <span class="Comment"><span class="Comment">#</span> adds created_at, updated_at</span>
  t.<span class="FunctionName">belongs_to</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>goat</span>                    <span class="Comment"><span class="Comment">#</span> adds goat_id integer</span>
  t.<span class="FunctionName">string</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>name</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>email</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>limit</span> =&gt; <span class="Number">20</span>  <span class="Comment"><span class="Comment">#</span> adds name and email both with a 20 char limit</span>
  t.<span class="FunctionName">remove</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>name</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>email</span>                <span class="Comment"><span class="Comment">#</span> removes the name and email columns</span>
<span class="Keyword">end</span>
</pre>

<p>* Fixed has_many :through .create with no parameters caused a "can't dup NilClass" error (Steven Soroka) [#85]</p>

<p>* Added block-setting of attributes for Base.create like Base.new already has (Adam Meehan) [#39]</p>

<p>* Fixed that pessimistic locking you reference the quoted table name (Josh Susser) [#67]</p>

<p>* Fixed that change_column should be able to use :null => true on a field that formerly had false [Nate Wiger] [#26]</p>

<p>* Added that the MySQL adapter should map integer to either smallint, int, or bigint depending on the :limit just like PostgreSQL [DHH]</p>

<p>* Change validates_uniqueness_of :case_sensitive option default back to true (from [9160]).  Love your database columns, don't LOWER them.  [rick]</p>

<p>* Add support for interleaving migrations by storing which migrations have run in the new schema_migrations table. Closes #11493 [jordi]</p>

<p>* ActiveRecord::Base#sum defaults to 0 if no rows are returned.  Closes #11550 [kamal]</p>

<p>* Ensure that respond_to? considers dynamic finder methods. Closes #11538. [floehopper]</p>

<p>* Ensure that save on parent object fails for invalid has_one association. Closes #10518. [Pratik]</p>

<p>* Remove duplicate code from associations. [Pratik]</p>

<p>* Refactor HasManyThroughAssociation to inherit from HasManyAssociation. Association callbacks and <association>_ids= now work with hm:t. #11516 [rubyruy]</p>

<p>* Ensure HABTM#create and HABTM#build do not load entire association. [Pratik]</p>

<p>* Improve documentation. [Xavier Noria, Jack Danger Canty, leethal]</p>

<p>* Tweak ActiveRecord::Base#to_json to include a root value in the returned hash: {"post": {"title": ...}} [rick]</p>

<pre class="mac_classic"><span class="LibraryObject">Post</span>.<span class="FunctionName">find</span>(<span class="Number">1</span>).<span class="FunctionName">to_json</span> <span class="Comment"><span class="Comment">#</span> =&gt; {&quot;title&quot;: ...}</span>
config.<span class="FunctionName">active_record</span>.<span class="FunctionName">include_root_in_json</span> <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
<span class="LibraryObject">Post</span>.<span class="FunctionName">find</span>(<span class="Number">1</span>).<span class="FunctionName">to_json</span> <span class="Comment"><span class="Comment">#</span> =&gt; {&quot;post&quot;: {&quot;title&quot;: ...}}</span>
</pre>

<p>* Add efficient #include? to AssociationCollection (for has_many/has_many :through/habtm).  [stopdropandrew]</p>

<p>* PostgreSQL: create_ and drop_database support.  #9042 [ez, pedz, nicksieger]</p>

<p>* Ensure that validates_uniqueness_of works with with_scope. Closes #9235. [nik.wakelin, cavalle]</p>

<p>* Partial updates include only unsaved attributes. Off by default; set YourClass.partial_updates = true to enable.  [Jeremy Kemper]</p>

<p>* Removing unnecessary uses_tzinfo helper from tests, given that TZInfo is now bundled [Geoff Buesing]</p>

<p>* Fixed that validates_size_of :within works in associations #11295, #10019 [cavalle]</p>

<p>* Track changes to unsaved attributes.  [Jeremy Kemper]</p>

<p>* Switched to UTC-timebased version numbers for migrations and the schema. This will as good as eliminate the problem of multiple migrations getting the same version assigned in different branches. Also added rake db:migrate:up/down to apply individual migrations that may need to be run when you merge branches #11458 [jbarnette]</p>

<p>* Fixed that has_many :through would ignore the hash conditions #11447 [miloops]</p>

<p>* Fix issue where the :uniq option of a has_many :through association is ignored when find(:all) is called.  Closes #9407 [cavalle]</p>

<p>* Fix duplicate table alias error when including an association with a has_many :through association on the same join table.  Closes #7310 [cavalle]</p>

<p>* More efficient association preloading code that compacts a through_records array in a central location.  Closes #11427 [danger]</p>

<p>* Improve documentation. [Radar, Jan De Poorter, chuyeow, xaviershay, danger, miloops, Xavier Noria,  Sunny Ripert]</p>

<p>* Fixed that ActiveRecord#Base.find_or_create/initialize would not honor attr_protected/accessible when used with a hash #11422 [miloops]</p>

<p>* Added ActiveRecord#Base.all/first/last as aliases for find(:all/:first/:last) #11413 [nkallen, thechrisoshow]</p>

<p>* Merge the has_finder gem, renamed as 'named_scope'.  #11404 [nkallen]</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">Article<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>published</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; {<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>published</span> =&gt; <span class="BuiltInConstant">true</span>}
    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>popular</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; ...
<span class="Keyword">end</span>

<span class="LibraryObject">Article</span>.<span class="FunctionName">published</span>.<span class="FunctionName">paginate</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>page</span> =&gt; <span class="Number">1</span>)
<span class="LibraryObject">Article</span>.<span class="FunctionName">published</span>.<span class="FunctionName">popular</span>.<span class="FunctionName">count</span>
<span class="LibraryObject">Article</span>.<span class="FunctionName">popular</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
<span class="LibraryObject">Article</span>.<span class="FunctionName">popular</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; {...})
</pre>

<p>See http://pivots.pivotallabs.com/users/nick/blog/articles/284-hasfinder-it-s-now-easier-than-ever-to-create-complex-re-usable-sql-queries</p>

<p>* Add has_one :through support.  #4756 [thechrisoshow]</p>

<p>* Migrations: create_table supports primary_key_prefix_type.  #10314 [student, thechrisoshow]</p>

<p>* Added logging for dependency load errors with fixtures #11056 [stuthulhu]</p>

<p>* Time zone aware attributes use Time#in_time_zone [Geoff Buesing]</p>

<p>* Fixed that scoped joins would not always be respected #6821 [Theory/Danger]</p>

<p>* Ensure that ActiveRecord::Calculations disambiguates field names with the table name.  #11027 [cavalle]</p>

<p>* Added add/remove_timestamps to the schema statements for adding the created_at/updated_at columns on existing tables #11129 [jramirez]</p>

<p>* Added ActiveRecord::Base.find(:last) #11338 [miloops]</p>

<p>* test_native_types expects DateTime.local_offset instead of DateTime.now.offset; fixes test breakage due to dst transition [Geoff Buesing]</p>

<p>* Add :readonly option to HasManyThrough associations. #11156 [miloops]</p>

<p>* Improve performance on :include/:conditions/:limit queries by selectively joining in the pre-query.  #9560 [dasil003]</p>

<p>* Perf fix: Avoid the use of named block arguments.  Closes #11109 [adymo]</p>

<p>* PostgreSQL: support server versions 7.4 through 8.0 and the ruby-pg driver.  #11127 [jdavis]</p>

<p>* Ensure association preloading doesn't break when an association returns nil. ##11145 [GMFlash]</p>

<p>* Make dynamic finders respect the :include on HasManyThrough associations.  #10998. [cpytel]</p>

<p>* Base#instantiate_time_object only uses Time.zone when Base.time_zone_aware_attributes is true; leverages Time#time_with_datetime_fallback for readability [Geoff Buesing]</p>

<p>* Refactor ConnectionAdapters::Column.new_time: leverage DateTime failover behavior of Time#time_with_datetime_fallback [Geoff Buesing]</p>

<p>* Improve associations performance by using symbol callbacks instead of string callbacks. #11108 [adymo]</p>

<p>* Optimise the BigDecimal conversion code.  #11110 [adymo]</p>

<p>* Introduce the :readonly option to all associations. Records from the association cannot be saved.  #11084 [miloops]</p>

<p>* Multiparameter attributes for time columns fail over to DateTime when out of range of Time [Geoff Buesing]</p>

<p>* Base#instantiate_time_object uses Time.zone.local() [Geoff Buesing]</p>

<p>* Add timezone-aware attribute readers and writers. #10982 [Geoff Buesing]</p>

<p>* Instantiating time objects in multiparameter attributes uses Time.zone if available.  #10982 [rick]</p>

<p>* Add note about how ActiveRecord::Observer classes are initialized in a Rails app. #10980 [fxn]</p>

<p>* MySQL: omit text/blob defaults from the schema instead of using an empty string.  #10963 [mdeiters]</p>

<p>* belongs_to supports :dependent => :destroy and :delete.  #10592 [Jonathan Viney]</p>

<p>* Introduce preload query strategy for eager :includes.  #9640 [Frederick Cheung, Aleksey Kondratenko, codafoo]</p>

<p>* Support aggregations in finder conditions.  #10572 [Ryan Kinderman]</p>

<p>* Organize and clean up the Active Record test suite.  #10742 [John Barnette]</p>

<p>* Ensure that modifying has_and_belongs_to_many actions clear the query cache.  Closes #10840 [john.andrews]</p>

<p>* Fix issue where Table#references doesn't pass a :null option to a *_type attribute for polymorphic associations.  Closes #10753 [railsjitsu]</p>

<p>* Fixtures: removed support for the ancient pre-YAML file format.  #10736 [John Barnette]</p>

<p>* More thoroughly quote table names.  #10698 [dimdenis, lotswholetime, Jeremy Kemper]</p>

<p>* update_all ignores scoped :order and :limit, so post.comments.update_all doesn't try to include the comment order in the update statement.  #10686 [Brendan Ribera]</p>

<p>* Added ActiveRecord::Base.cache_key to make it easier to cache Active Records in combination with the new ActiveSupport::Cache::* libraries [DHH]</p>

<p>* Make sure CSV fixtures are compatible with ruby 1.9's new csv implementation. [JEG2]</p>

<p>* Added by parameter to increment, decrement, and their bang varieties so you can do player1.increment!(:points, 5) #10542 [Sam]</p>

<p>* Optimize ActiveRecord::Base#exists? to use #select_all instead of #find.  Closes #10605 [jamesh, fcheung, protocool]</p>

<p>* Don't unnecessarily load has_many associations in after_update callbacks.  Closes #6822 [stopdropandrew, canadaduane]</p>

<p>* Eager belongs_to :include infers the foreign key from the association name rather than the class name.  #10517 [Jonathan Viney]</p>

<p>* SQLite: fix rename_ and remove_column for columns with unique indexes.  #10576 [Brandon Keepers]</p>

<p>* Ruby 1.9 compatibility.  #10655 [Jeremy Kemper, Dirkjan Bussink]</p>

<h2> ActiveResource</h2>

<p>2.1.0 (May 31st, 2008)*</p>

<p>* Fixed response logging to use length instead of the entire thing (seangeo) [#27]</p>

<p>* Fixed that to_param should be used and honored instead of hardcoding the id #11406 [gspiers]</p>

<p>* Improve documentation. [Radar, Jan De Poorter, chuyeow, xaviershay, danger, miloops, Xavier Noria,  Sunny Ripert]</p>

<p>* Use HEAD instead of GET in exists? [bscofield]</p>

<p>* Fix small documentation typo.  Closes #10670 [l.guidi]</p>

<p>* find_or_create_resource_for handles module nesting.  #10646 [xavier]</p>

<p>* Allow setting ActiveResource::Base#format before #site.  [rick]</p>

<p>* Support agnostic formats when calling custom methods.  Closes #10635 [joerichsen]</p>

<p>* Document custom methods.  #10589 [Cheah Chu Yeow]</p>

<p>* Ruby 1.9 compatibility.  [Jeremy Kemper]</p>

<h2>ActiveSupport</h2>

<p>* TimeZone#to_s shows offset as GMT instead of UTC, because GMT will be more familiar to end users (see time zone selects used by Windows OS, google.com and yahoo.com.) Reverts [8370] [Geoff Buesing]</p>

<p>* Hash.from_xml: datetime xml types overflow to Ruby DateTime class when out of range of Time. Adding tests for utc offsets [Geoff Buesing]</p>

<p>* TimeWithZone #+ and #- : ensure overflow to DateTime with Numeric arg [Geoff Buesing]</p>

<p>* Time#to_json: don't convert to utc before encoding. References #175 [Geoff Buesing]</p>

<p>* Remove unused JSON::RESERVED_WORDS, JSON.valid_identifier? and JSON.reserved_word? methods. Resolves #164. [Cheah Chu Yeow]</p>

<p>* Adding Date.current, which returns Time.zone.today if config.time_zone is set; otherwise returns Date.today [Geoff Buesing]</p>

<p>* TimeWithZone: date part getter methods (#year #mon #day etc) are defined on class; no longer relying on method_missing [Geoff Buesing]</p>

<p>* Time.zone.parse return nil for strings with no date information [Geoff Buesing]</p>

<p>* Time.zone.parse respects offset information in string. Resolves #105. [Scott Fleckenstein, Geoff Buesing]</p>

<p>* Added Ruby 1.8 implementation of Process.daemon</p>

<p>* Duration #since and #ago with no argument (e.g., 5.days.ago) return TimeWithZone when config.time_zone is set. Introducing Time.current, which returns Time.zone.now if config.time_zone is set, otherwise just returns Time.now [Geoff Buesing]</p>

<p>* Time#since behaves correctly when passed a Duration. Closes #11527 [kemiller]</p>

<p>* Add #getutc alias for DateTime#utc [Geoff Buesing]</p>

<p>* Refactor TimeWithZone: don't send #since, #ago, #+, #-, #advance through method_missing [Geoff Buesing]</p>

<p>* TimeWithZone respects config.active_support.use_standard_json_time_format [Geoff Buesing]</p>

<p>* Add config.active_support.escape_html_entities_in_json to allow disabling of html entity escaping.  [rick]</p>

<p>* Improve documentation. [Xavier Noria]</p>

<p>* Modified ActiveSupport::Callbacks::Callback#call to accept multiple arguments.</p>

<p>* Time #yesterday and #tomorrow behave correctly crossing DST boundary. Closes #7399 [sblackstone]</p>

<p>* TimeWithZone: Adding tests for dst and leap day edge cases when advancing time [Geoff Buesing]</p>

<p>* TimeWithZone#method_missing: send to utc to advance with dst correctness, otherwise send to time. Adding tests for time calculations methods [Geoff Buesing]</p>

<p>* Add config.active_support.use_standard_json_time_format setting so that Times and Dates export to ISO 8601 dates.  [rick]</p>

<p>* TZInfo: Removing unneeded TimezoneProxy class [Geoff Buesing]</p>

<p>* TZInfo: Removing unneeded TimezoneIndexDefinition, since we're not including Indexes::Timezones [Geoff Buesing] </p>

<p>* Removing unnecessary uses_tzinfo helper from tests, given that TZInfo is now bundled [Geoff Buesing]</p>

<p>* Bundling abbreviated version of TZInfo gem 0.3.8: only the classes and zone definitions required to support Rails time zone features are included. If a recent version of the full TZInfo gem is installed, this will take precedence over the bundled version [Geoff Buesing]</p>

<p>* TimeWithZone#marshal_load does zone lookup via Time.get_zone, so that tzinfo/Olson identifiers are handled [Geoff Buesing]</p>

<p>* Time.zone= accepts TZInfo::Timezone instances and Olson identifiers; wraps result in TimeZone instance [Geoff Buesing] </p>

<p>* TimeWithZone time conversions don't need to be wrapped in TimeOrDateTime, because TZInfo does this internally [Geoff Buesing]</p>

<p>* TimeWithZone#usec returns 0 instead of error when DateTime is wrapped [Geoff Buesing]</p>

<p>* Improve documentation. [Radar, Jan De Poorter, chuyeow, xaviershay, danger, miloops, Xavier Noria,  Sunny Ripert]</p>

<p>* Ensure that TimeWithZone#to_yaml works when passed a YAML::Emitter.  [rick]</p>

<p>* Ensure correct TimeWithZone#to_date [Geoff Buesing]</p>

<p>* Make TimeWithZone work with tzinfo 0.2.x: use TZInfo::Timezone#zone_identifier alias for #abbreviation, silence warnings on tests. Raise LoadError when TZInfo version is &lt; 0.2 by sniffing for TZInfo::TimeOrDateTime constant. Move all tzinfo-dependent TimeZone tests into uses_tzinfo block [Geoff Buesing]</p>

<p>* Time, DateTime and TimeWithZone #in_time_zone defaults to Time.zone. Removing now unneeded #in_current_time_zone [Geoff Buesing]</p>

<p>* TZInfo caches Timezone instances in its own internal hash cache, so TimeZone::MAPPING doesn't need to cache them as well [Geoff Buesing]</p>

<p>* Adding TimeZone#parse [Geoff Buesing]</p>

<p>* Adding TimeZone#at and DateTime#to_f [Geoff Buesing]</p>

<p>* TimeWithZone responds to Ruby 1.9 weekday-named query methods [Geoff Buesing]</p>

<p>* TimeWithZone caches TZInfo::TimezonePeriod used for time conversion so that it can be reused, and enforces DST rules correctly when instance is created from a local time [Geoff Buesing]</p>

<p>* Fixed that BufferedLogger should create its own directory if one doesn't already exist #11285 [lotswholetime]</p>

<p>* Fix Numeric time tests broken by DST change by anchoring them to fixed times instead of Time.now. Anchor TimeZone#now DST test to time specified with Time.at instead of Time.local to work around platform differences with Time.local and DST representation [Geoff Buesing]</p>

<p>* Removing unneeded #change_time_zone method from Time, DateTime and TimeWithZone [Geoff Buesing]</p>

<p>* TimeZone #local and #now correctly enforce DST rules [Geoff Buesing]</p>

<p>* TimeWithZone instances correctly enforce DST rules. Adding TimeZone#period_for_utc [Geoff Buesing]</p>

<p>* test_time_with_datetime_fallback expects DateTime.local_offset instead of DateTime.now.offset [Geoff Buesing]</p>

<p>* Adding TimeWithZone #marshal_dump and #marshal_load [Geoff Buesing]</p>

<p>* Add OrderedHash#to_hash [josh]</p>

<p>* Adding Time#end_of_day, _quarter, _week, and _year.  #9312 [Juanjo Bazan, Tarmo Tänav, BigTitus]</p>

<p>* Adding TimeWithZone#between? [Geoff Buesing]</p>

<p>* Time.=== returns true for TimeWithZone instances [Geoff Buesing]</p>

<p>* TimeWithZone #+ and #- behave consistently with numeric arguments regardless of whether wrapped time is a Time or DateTime; consistenty answers false to #acts_like?(:date) [Geoff Buesing]</p>

<p>* Add String#squish and String#squish! to remove consecutive chunks of whitespace.  #11123 [jordi, Henrik N]</p>

<p>* Serialize BigDecimals as Floats when using to_yaml. #8746 [ernesto.jimenez]</p>

<p>* Adding TimeWithZone #to_yaml, #to_datetime, #eql? and method aliases for duck-typing compatibility with Time [Geoff Buesing]</p>

<p>* TimeWithZone #in_time_zone returns +self+ if zone argument is the same as #time_zone [Geoff Buesing]</p>

<p>* Adding TimeWithZone #to_a, #to_f, #to_i, #httpdate, #rfc2822 [Geoff Buesing]</p>

<p>* Pruning unneeded TimeWithZone#change_time_zone_to_current [Geoff Buesing]</p>

<p>* Time#zone=, #in_time_zone and #change_time_zone accept a Duration [Geoff Buesing]</p>

<p>* Time#in_time_zone handles Time.local instances correctly [Geoff Buesing]</p>

<p>* Pruning unneeded Time#change_time_zone_to_current. Enhanced docs to #change_time_zone to explain the difference between this method and #in_time_zone [Geoff Buesing]</p>

<p>* TimeZone#new method renamed #local; when used with Time.zone, constructor now reads: Time.zone.local() [Geoff Buesing]</p>

<p>* Added Base64.encode64s to encode values in base64 without the newlines. This makes the values immediately usable as URL parameters or memcache keys without further processing [DHH]</p>

<p>* Remove :nodoc: entries around the ActiveSupport test/unit assertions.  #10946 [dancroak, jamesh]</p>

<p>* Add Time.zone_default accessor for setting the default time zone.  Rails::Configuration.time_zone sets this.  #10982 [Geoff Buesing]</p>

<p>* cache.fetch(key, :force => true) to force a cache miss.  [Jeremy Kemper]</p>

<p>* Support retrieving TimeZones with a Duration.  TimeZone[-28800] == TimeZone[-480.minutes].  [rick]</p>

<p>* TimeWithZone#- added, so that #- can handle a Time or TimeWithZone argument correctly [Geoff Buesing]</p>

<p>* with_timezone test helper renamed with_env_tz, to distinguish between setting ENV['TZ'] and setting Time.zone in tests [Geoff Buesing]</p>

<p>* Time#- coerces TimeWithZone argument to a Time instance so that difference in seconds can be calculated. Closes #10914 [Geoff Buesing, yyyc514]</p>

<p>* Adding UTC zone to TimeZone; TimeWithZone no longer has to fake UTC zone with nil [Geoff Buesing]</p>

<p>* Time.get_zone refactored to private method, given that the encapsulated logic is only useful internally [Geoff Buesing]</p>

<p>* Time.zone uses thread-local variable for thread safety. Adding Time.use_zone, for overriding Time.zone locally inside a block. Removing unneeded Time.zone_reset! [Geoff Buesing]</p>

<p>* TimeZone#to_s uses UTC rather than GMT; reapplying change that was undone in [8679]. #1689 [Cheah Chu Yeow]</p>

<p>* Time.days_in_month defaults to current year if no year is supplied as argument #10799 [Radar], uses Date.gregorian_leap? to determine leap year, and uses constant lookup to determine days in month [Geoff Buesing]<br/>
</p>

<p>* Adding Time and DateTime #compare_with_coercion, which layers behavior on #&lt;=> so that any combination of Time, DateTime and ActiveSupport::TimeWithZone instances can be chronologically compared [Geoff Buesing]</p>

<p>* TimeZone#now returns an ActiveSupport::TimeWithZone [Geoff Buesing]</p>

<p>* Time #in_current_time_zone and #change_time_zone_to_current return self when Time.zone is nil [Geoff Buesing]</p>

<p>* Remove unneeded #to_datetime_default_s alias for DateTime#to_s, given that we inherit a #to_default_s from Date that does exactly the same thing [Geoff Buesing]</p>

<p>* Refactor Time and DateTime #to_formatted_s: use ternary instead of nested if/else [Geoff Buesing]</p>

<p>* Adding Time and DateTime #formatted_offset, for outputting +HH:MM utc offset strings with cross-platform consistency [Geoff Buesing]</p>

<p>* Adding alternate_utc_string option to TimeZone#formatted_offset. Removing unneeded TimeZone#offset. [Geoff Buesing]</p>

<p>* Introduce ActiveSupport::TimeWithZone, for wrapping Time instances with a TimeZone. Introduce instance methods to Time for creating TimeWithZone instances, and class methods for managing a global time zone. [Geoff Buesing]</p>

<p>* Replace non-dst-aware TimeZone class with dst-aware class from tzinfo_timezone plugin. TimeZone#adjust and #unadjust are no longer available; tzinfo gem must now be present in order to perform time zone calculations, via #local_to_utc and #utc_to_local methods. [Geoff Buesing]</p>

<p>* Extract ActiveSupport::Callbacks from Active Record, test case setup and teardown, and ActionController::Dispatcher.  #10727 [Josh Peek]</p>

<p>* Introducing DateTime #utc, #utc? and #utc_offset, for duck-typing compatibility with Time. Closes #10002 [Geoff Buesing]</p>

<p>* Time#to_json uses Numeric#to_utc_offset_s to output a cross-platform-consistent representation without having to convert to DateTime. References #9750 [Geoff Buesing]</p>

<p>* Refactor number-to-HH:MM-string conversion logic from TimeZone#formatted_offset to a reusable Numeric#to_utc_offset_s method. [Geoff Buesing]</p>

<p>* Continue evolution toward ActiveSupport::TestCase.  #10679 [Josh Peek]</p>

<p>* TestCase: introduce declared setup and teardown callbacks. Pass a list of methods and an optional block to call before setup or after teardown. Setup callbacks are run in the order declared; teardown callbacks are run in reverse.  [Jeremy Kemper]</p>

<p>* Added ActiveSupport::Gzip.decompress/compress(source) as an easy wrapper for Zlib [Tobias Luetke]</p>

<p>* Included MemCache-Client to make the improved ActiveSupport::Cache::MemCacheStore work out of the box [Bob Cottrell, Eric Hodel]</p>

<p>* Added ActiveSupport::Cache::* framework as an extraction from ActionController::Caching::Fragments::* [DHH]</p>

<p>* Fixed String#titleize to work for strings with 's too #10571 [trek]</p>

<p>* Changed the implementation of Enumerable#group_by to use a double array approach instead of a hash such that the insert order is honored [DHH/Marcel]</p>

<p>* remove multiple enumerations from ActiveSupport::JSON#convert_json_to_yaml when dealing with date/time values.  [rick]</p>

<p>* Hash#symbolize_keys skips keys that can't be symbolized.  #10500 [Brad Greenlee]</p>

<p>* Ruby 1.9 compatibility.  #1689, #10466, #10468, #10554, #10594, #10632 [Cheah Chu Yeow, Pratik Naik, Jeremy Kemper, Dirkjan Bussink, fxn]</p>

<p>* TimeZone#to_s uses UTC rather than GMT.  #1689 [Cheah Chu Yeow]</p>

<p>* Refactor of Hash#symbolize_keys! to use Hash#replace.  Closes #10420 [ReinH]</p>

<p>* Fix HashWithIndifferentAccess#to_options! so it doesn't clear the options hash.  Closes #10419 [ReinH]</p>

<h2>Railties</h2>

<p>* script/dbconsole fires up the command-line database client.  #102 [Steve Purcell]</p>

<p>* Fix bug where plugin init.rb files from frozen gem specs weren't being run.  (pjb3) [#122 state:resolved]</p>

<p>* Made the location of the routes file configurable with config.routes_configuration_file (Scott Fleckenstein) [#88]</p>

<p>* Rails Edge info returns the latest git commit hash [Francesc Esplugas]</p>

<p>* Added Rails.public_path to control where HTML and assets are expected to be loaded from (defaults to Rails.root + "/public") #11581 [nicksieger]</p>

<p>* rake time:zones:local finds correct base utc offset for zones in the Southern Hemisphere [Geoff Buesing]</p>

<p>* Don't require rails/gem_builder during rails initialization, it's only needed for the gems:build task. [rick]</p>

<p>* script/performance/profiler compatibility with the ruby-prof >= 0.5.0. Closes #9176. [Catfish]</p>

<p>* Flesh out rake gems:unpack to unpack all gems, and add rake gems:build for native extensions. #11513 [ddollar]</p>

<pre class="mac_classic">rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unpack</span>             <span class="Comment"><span class="Comment">#</span> unpacks all gems</span>
rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unpack</span> <span class="Variable">GEM</span><span class="Keyword">=</span>mygem   <span class="Comment"><span class="Comment">#</span> unpacks only the gem 'mygem'</span>

rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>build</span>              <span class="Comment"><span class="Comment">#</span> builds all unpacked gems</span>
rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>build</span> <span class="Variable">GEM</span><span class="Keyword">=</span>mygem    <span class="Comment"><span class="Comment">#</span> builds only the gem 'mygem'</span>
</pre>

<p>* Add config.active_support for future configuration options.  Also, add more new Rails 3 config settings to new_rails_defaults.rb [rick]</p>

<p>* Add Rails.logger, Rails.root, Rails.env and Rails.cache shortcuts for RAILS_* constants [pratik]</p>

<p>* Allow files in plugins to be reloaded like the rest of the application.  [rick]</p>

<p>Enables or disables plugin reloading.</p>

<pre class="mac_classic">config.<span class="FunctionName">reload</span>\_plugins <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
</pre>

<p>You can get around this setting per plugin.</p>

<p>If #reload_plugins? == false (DEFAULT), add this to your plugin's init.rb to make it reloadable:</p>

<pre class="mac_classic"><span class="LibraryObject">Dependencies</span>.<span class="FunctionName">load_once_paths</span>.<span class="FunctionName">delete</span> lib\_path
</pre>

<p>If #reload_plugins? == true, add this to your plugin's init.rb to only load it once:</p>

<pre class="mac_classic"><span class="LibraryObject">Dependencies</span>.<span class="FunctionName">load_once_paths</span> <span class="Keyword">&lt;&lt;</span> lib_path
</pre>

<p>* Small tweak to allow plugins to specify gem dependencies.  [rick]</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> OLD open\_id\_authentication plugin init.rb</span>
<span class="Keyword">require</span> <span class="String"><span class="String">'</span>yadis<span class="String">'</span></span>
<span class="Keyword">require</span> <span class="String"><span class="String">'</span>openid<span class="String">'</span></span>
<span class="LibraryObject">ActionController</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">send</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include</span>, <span class="Variable">OpenIdAuthentication</span>

<span class="Comment"><span class="Comment">#</span> NEW</span>
config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>ruby-openid<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>openid<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">&quot;</span>1.1.4<span class="String">&quot;</span></span>
config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>ruby-yadis<span class="String">&quot;</span></span>,  <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>yadis<span class="String">&quot;</span></span>,  <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">&quot;</span>0.3.4<span class="String">&quot;</span></span>

config.<span class="FunctionName">after_initialize</span> <span class="Keyword">do</span>
    <span class="LibraryObject">ActionController</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">send</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include</span>, <span class="Variable">OpenIdAuthentication</span>
<span class="Keyword">end</span>
</pre>

<p>* Added config.gem for specifying which gems are required by the application, as well as rake tasks for installing and freezing gems. [rick]</p>

<pre class="mac_classic"><span class="LibraryObject">Rails</span>::<span class="FunctionName">Initializer</span>.<span class="FunctionName">run</span> <span class="Keyword">do </span>|<span class="Variable">config</span>|
    config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>bj<span class="String">&quot;</span></span>
    config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>hpricot<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">'</span>0.6<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source</span> =&gt; <span class="String"><span class="String">&quot;</span>http://code.whytheluckystiff.net<span class="String">&quot;</span></span>
    config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>aws-s3<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>aws/s3<span class="String">&quot;</span></span>
<span class="Keyword">end</span>

<span class="Comment"><span class="Comment">#</span> List required gems.</span>
    rake gems

<span class="Comment"><span class="Comment">#</span> Install all required gems:</span>
    rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>install</span>

<span class="Comment"><span class="Comment">#</span> Unpack specified gem to vendor/gems/gem\_name-x.x.x</span>
    rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unpack</span> <span class="Variable">GEM</span><span class="Keyword">=</span>bj
</pre>

<p>* Removed the default .htaccess configuration as there are so many good deployment options now (kept it as an example in README) [DHH]</p>

<p>* config.time_zone accepts TZInfo::Timezone identifiers as well as Rails TimeZone identifiers [Geoff Buesing]</p>

<p>* Rails::Initializer#initialize_time_zone raises an error if value assigned to config.time_zone is not recognized. Rake time zone tasks only require ActiveSupport instead of entire environment [Geoff Buesing]</p>

<p>* Stop adding the antiquated test/mocks/* directories and only add them to the path if they're still there for legacy reasons [DHH]</p>

<p>* Added that gems can now be plugins if they include rails/init.rb #11444 [jbarnette]</p>

<p>* Added Plugin#about method to programmatically access the about.yml in a plugin #10979 [lazyatom]</p>

<pre class="mac_classic">plugin <span class="Keyword">=</span> <span class="LibraryObject">Rails</span>::<span class="FunctionName">Plugin</span>.<span class="FunctionName">new</span>(path\_to\_my\_plugin)
plugin.<span class="FunctionName">about</span>[<span class="String"><span class="String">&quot;</span>author<span class="String">&quot;</span></span>] <span class="Comment"><span class="Comment">#</span> =&gt; &quot;James Adam&quot;</span>
plugin.<span class="FunctionName">about</span>[<span class="String"><span class="String">&quot;</span>url<span class="String">&quot;</span></span>] <span class="Comment"><span class="Comment">#</span> =&gt; &quot;http://interblah.net&quot;</span>
</pre>

<p>* Improve documentation. [Radar, Jan De Poorter, chuyeow, xaviershay, danger, miloops, Xavier Noria,  Sunny Ripert]</p>

<p>* Added config.time_zone = 'UTC' in the default environment.rb [Geoff Buesing]</p>

<p>* Added rake tasks time:zones:all, time:zones:us and time:zones:local for finding time zone names for config.time_zone option [Geoff Buesing]</p>

<p>* Add config.time_zone for configuring the default Time.zone value.  #10982 [Geoff Buesing]</p>

<p>* Added support for installing plugins hosted at git repositories #11294 [danger]</p>

<p>* Fixed that script/generate would not look for plugin generators in plugin_paths #11000 [glv]</p>

<p>* Fixed database rake tasks to work with charset/collation and show proper error messages on failure. Closes #11301 [matt]</p>

<p>* Added a -e/--export to script/plugin install, uses svn export. #10847 [jon@blankpad.net)]</p>

<p>* Reshuffle load order so that routes and observers are initialized after plugins and app initializers.  Closes #10980 [rick]</p>

<p>* Git support for script/generate.  #10690 [ssoroka]</p>

<p>* Update scaffold to use labels instead of bold tags.  Closes #10757 [zach-inglis-lt3]</p>

<p>* Resurrect WordNet synonym lookups.  #10710 [tom./, matt]</p>

<p>* Added config.cache_store to environment options to control the default cache store (default is FileStore if tmp/cache is present, otherwise MemoryStore is used) [DHH]</p>

<p>* Added that rails:update is run when you do rails:freeze:edge to ensure you also get the latest JS and config files #10565 [jeff]</p>

<p>* SQLite: db:drop:all doesn't fail silently if the database is already open.  #10577 [Cheah Chu Yeow, mrichman]</p>

<p>* Introduce native mongrel handler and push mutex into dispatcher.  [Jeremy Kemper]</p>

<p>* Ruby 1.9 compatibility.  #1689, #10546 [Cheah Chu Yeow, frederico]</p>

        </div>

        <div class="white_page"></div>
        <div class="white_page"></div>

        <div class="backcover"></div>
</body>
</html>
