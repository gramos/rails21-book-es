<!-- -*- coding: utf-8; -*- -->

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <link rel="stylesheet" type="text/css" href="../layout/second.css"/>
        <link rel="stylesheet" type="text/css" href="../layout/mac_classic.css"/>
</head>
<body>
        <div class="frontcover"></div>

        <div class="halftitlepage">
                <h1 class="no-toc">Ruby on Rails 2.1</h1>
                <h2 class="no-toc">¿Qué Hay de Nuevo?</h2>
                <h3 class="no-toc">Primer Edición</h3>
        </div>

        <div class="titlepage">
        <h1 class="no-toc">Ruby on Rails 2.1</h1>

        <h2 class="no-toc">¿Qué Hay de Nuevo?</h2>
        <h3 class="no-toc">Primer Edición</h3>

        <p class="no-toc">Carlos Brando<br/>Marcos Tapajós</p>
        <!-- also, the publisher's name would typically be printed here -->
        </div>

        <div class="imprint">
                <p>&copy; Copyright 2008 Carlos Brando. All Rights Reserved.</p>
                <br/>
                <p>Primer Edición: Junio 2008</p>
                <br/>
                <p>Carlos Brando<br/>Website: www.nomedojogo.com</p>
                <p>Marcos Tapajós<br/>Website: www.improveit.com.br/en/company/tapajos</p>
        </div>

        <!-- <div class="toc">
                <h1>Sumário</h1>
                #toc
        </div> -->

        <div class="chapter">
                <!-- -*- mode: markdown; coding: utf-8; -*- -->


<h1>Introducción</h1>

<p>Alrededor de julio de 2004 David Heinemeier Hansson lanzó la versión pública del framework Ruby on Rails, el cual surgió como consecuencia del desarrollo de una aplicación llamada Basecamp. Después de tres años, el 7 de Diciembre de 2007 se publicó Ruby on Rails 2.0 con una cantidad importante de cambios.</p>

<p>Seis meses después, y durante todo este tiempo han contribuido más de <strong>1400 desarrolladores</strong> alrededor de todo el mundo con <strong>1600 parches</strong> para el framework. Hoy, 1ero. Junio de 2008, se ha publicado la versión 2.1 del framework Ruby on Rails.</p>

<p>Según David las principales novedades de esta versión son:</p>

<ul>
<li>Timezones</li>
<li>Dirty tracking</li>
<li>Gem Dependencies</li>
<li>Named scope</li>
<li>UTC-based migrations</li>
<li>Better caching</li>
</ul>


<p>Como siempre, para actualizar o instalar la nueva versión:</p>

<pre class="mac_classic">    gem install rails
</pre>

<h2>Agradecimientos</h2>

<p>A Marcos Tapajós, co-autor de este libro. De no ser por él, no podrías estar leyendo este libro.</p>

<p>A Daniel Lopes quien hizo la hermosa tapa de esta edición.</p>

<p>A toda la comunidad Brazilera de Ruby on Rails que nos ayudó directa o indirectamente con este libro, comentando los artículos del blog o aconsejándonos. Como me gusta decir siempre, lo mejor de Rails es su comunidad! se mantiene creando, inventando, y especialmente compartiendo.</p>

<h2> Traductores</h2>

<p>Este libro fue orgullosamente traducido al inglés por estos chicos Brazileros:</p>

<p><strong>Pedro Pimentel</strong> - <a href="http://www.pedropimentel.com">http://www.pedropimentel.com</a></p>

<p>Capítulos 3-8 y 10-13</p>

<p><strong>Rafael Barbosa</strong> - <a href="http://www.act-as-newbie.com/">http://www.act-as-newbie.com</a></p>

<p>Introducción y capítulo 1</p>

<p><strong>Ricardo S Yasuda</strong> - <a href="http://blog.shadowmaru.org/">http://blog.shadowmaru.org</a></p>

<p>Capítulo 14</p>

<p><strong>Caike Souza</strong> - <a href="http://tech-death.blogspot.com/">http://tech-death.blogspot.com</a></p>

<p>Capítulo 2</p>

<p><strong>AbraÃ£o Coelho</strong> - <a href="http://abrcoelho.net/">http://abrcoelho.net</a></p>

<p>Capítulo 9
<!-- -*- coding: utf-8; -*- --></p>

<h1> ActiveRecord</h1>

<p>ActiveRecord es una capa de mapeo objeto-relacional (object-relational mapping layer) responsable tanto de la interoperabiliadad entre la aplicación y la base de datos como de la abstracción de los datos. (wikipedia)</p>

<!-- -*- coding: utf-8; -*- -->


<h2> El método <strong>sum</strong></h2>

<h3> Expresiones en el método <strong>sum</strong></h3>

<p>Ahora podemos usar expresiones en los métodos de cálculo de <strong>ActiveRecord</strong>, <strong>sum</strong>, por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Person</span>.<span class="FunctionName">sum</span>(<span class="String"><span class="String">&quot;</span>2 * age<span class="String">&quot;</span></span>)
</pre>

<h3> Cambiando el valor de retorno por defecto del método sum</h3>

<p>En las versiones previas, cuando usábamos el método <strong>sum</strong> de <strong>ActiveRecord</strong> para calcular la suma de una determinada columna para todos los registros de una tabla, si ningún registro correspondía con las condiciones expresadas en el método de invocación, entonces el valor de retorno por defecto era <strong>nil</strong>.</p>

<p>En Rails 2.1 el valor de retorno por defecto (cuando no se encuentra ningún registro) es 0. Vea el ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Account</span>.<span class="FunctionName">sum</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>balance</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; <span class="String"><span class="String">'</span>1 = 2<span class="String">'</span></span>) <span class="Comment"><span class="Comment">#</span>=&gt; 0</span>
</pre>

<!-- -*- coding: utf-8; -*- -->


<h2> Has_one</h2>

<h3> Soporte para la opción through</h3>

<p>El método <strong>has_one</strong> ahora tiene la opción <strong>through</strong>. Esta funciona como <strong>has_many :through</strong>, pero en este caso representa la asociación a un objeto simple <strong>ActiveRecord</strong>. Ejemplo:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Magazine<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>subscriptions</span>
    <span class="Keyword">end</span>

    <span class="Keyword">class</span> <span class="TypeName">Subscription<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>magazine</span>
      belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>user</span>
    <span class="Keyword">end</span>

    <span class="Keyword">class</span> <span class="TypeName">User<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>subscriptions</span>
      has_one <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>magazine</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>through</span> =&gt; : subscriptions,
                    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; [<span class="String"><span class="String">'</span>subscriptions.active = ?<span class="String">'</span></span>, <span class="BuiltInConstant">true</span>]
    <span class="Keyword">end</span>
</pre>

<h3> Has_one con :source_type</h3>

<p>El método <strong>has_one :through</strong> que acabamos de ver, puede también tomar <strong>:source_type</strong> como argumento. Voy a intentar explicar esto a través de algunos ejemplos. Vamos comenzar con estas dos clases:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Client<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>

      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contacts</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>through</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>
    <span class="Keyword">end</span>
</pre>

<p>Lo que estamos viendo hasta aquí es una clase <strong>Client</strong> la cual tiene muchos (<strong>has_many</strong>) tipos de contactos (<strong>contacts</strong>), ya que la clase <strong>ContactCard</strong> tiene una relación polimórfica.</p>

<p>Para seguir con nuestro ejemplo, vamos a crear dos clases que van a representar a <strong>ContactCard</strong>:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Person<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>as</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact</span>
    <span class="Keyword">end</span>

    <span class="Keyword">class</span> <span class="TypeName">Business<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>as</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact</span>
    <span class="Keyword">end</span>
</pre>

<p><strong>Person</strong> y <strong>Business</strong> están relacionadas con mi clase  <strong>Client</strong> a través de la tabla  <strong>ContactCard</strong>. En otras palabras, tengo dos tipos de contactos, personal y de negocios.</p>

<p>Por otro cuando intente recuperar un contacto esto no va a funcionar, veamos:</p>

<pre class="mac_classic">    <span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Client</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>).<span class="FunctionName">contacts</span>
<span class="Comment">    <span class="Comment">#</span> ArgumentError: /.../active_support/core_ext/hash/keys.rb:48:</span>
<span class="Comment">    <span class="Comment">#</span> in `assert_valid_keys': Unknown key(s): polymorphic</span>
</pre>

<p>Para que esto funcione tenemos que usar <strong>:source_type</strong>. Vamos cambiar nuestra clase  <strong>Client</strong>:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Client<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>people_contacts</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>through</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contacts</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source_type</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>person</span>

      has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>business_contacts</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>through</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contact_cards</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>contacts</span>,
               <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source_type</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>business</span>
    <span class="Keyword">end</span>
</pre>

<p>Note que ahora tenemos dos maneras diferentes de recuperar nuestros contactos y podemos indicar que tipo de contacto <strong>:source_type</strong> esperamos.</p>

<pre class="mac_classic">    <span class="LibraryObject">Client</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>).<span class="FunctionName">people_contacts</span>
    <span class="LibraryObject">Client</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>).<span class="FunctionName">business_contacts</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Named_scope</h2>

<p>La gema  <em>has_finder</em>  ha sido incluida en Rails pero con un nombre diferente: <strong>named_scope</strong>.</p>

<p>Para entender lo que significa este agregado en Rails vamos a ver los siguientes ejemplos:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Article<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>published</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; {<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>published</span> =&gt; <span class="BuiltInConstant">true</span>}
      named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>containing_the_letter_a</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; <span class="String"><span class="String">&quot;</span>body LIKE '%a%â€™<span class="String">&quot;</span></span>
    <span class="Keyword">end</span>

    <span class="LibraryObject">Article</span>.<span class="FunctionName">published</span>.<span class="FunctionName">paginate</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>page</span> =&gt; <span class="Number">1</span>)
    <span class="LibraryObject">Article</span>.<span class="FunctionName">published</span>.<span class="FunctionName">containing_the_letter_a</span>.<span class="FunctionName">count</span>
    <span class="LibraryObject">Article</span>.<span class="FunctionName">containing_the_letter_a</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    <span class="LibraryObject">Article</span>.<span class="FunctionName">containing_the_letter_a</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; {â€¦})
</pre>

<p>En vez de crear un método nuevo llamado <strong>published</strong> para retornar todos los posts publicados, estoy usando un <strong>named_scope</strong> para que lo haga por mí. Pero puedo ir más allá que esto. Vamos a ver otro ejemplo para ver como se puede usar esto:</p>

<pre class="mac_classic">    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>written_before</span>, lambda { |<span class="Variable">time</span>|
      { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; [<span class="String"><span class="String">'</span>written_on &lt; ?<span class="String">'</span></span>, time] }
    }

    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>anonymous_extension</span> <span class="Keyword">do</span>
      <span class="Keyword">def</span> <span class="FunctionName">one</span>
        <span class="Number">1</span>
      <span class="Keyword">end</span>
    <span class="Keyword">end</span>

    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>named_extension</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>extend</span> =&gt; <span class="Variable">NamedExtension</span>

    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>multiple_extensions</span>,
            <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>extend</span> =&gt; [<span class="Variable">MultipleExtensionTwo</span>, <span class="Variable">MultipleExtensionOne</span>]
</pre>

<h2> Testeando named_scope con proxy_options</h2>

<p><strong>Named scopes</strong> es una nueva e interesante caraterística de Rails 2.1, pero después de usarlo durante un tiempo quizás sea díficil testear estas estructuras más complejas.</p>

<p>Veamos un ejemplo:</p>

<pre class="mac_classic">            <span class="Keyword">class</span> <span class="TypeName">Shirt<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
              named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>colored</span>, lambda { |<span class="Variable">color</span>|
                { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>color</span> =&gt; color } }
              }
            <span class="Keyword">end</span>
</pre>

<p>¿Como creamos un test que valide la generación de este scope ?</p>

<p>Para solucionar esto, se creó el método <strong>proxy_options</strong>. El cual nos permite examinar las opciones usadas en <strong>named_scope</strong>. Para testear el código de arriba podríamos escribir esto:</p>

<pre class="mac_classic">            <span class="Keyword">class</span> <span class="TypeName">ShirtTest<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> Test::Unit</span></span>
              <span class="Keyword">def</span> <span class="FunctionName">test_colored_scope</span>
                red_scope <span class="Keyword">=</span> { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>colored</span> =&gt; <span class="String"><span class="String">'</span>red<span class="String">'</span></span> } }
                blue_scope <span class="Keyword">=</span> { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>colored</span> =&gt; <span class="String"><span class="String">'</span>blue<span class="String">'</span></span> } }
                assert_equal red_scope, <span class="LibraryObject">Shirt</span>.<span class="FunctionName">colored</span>(<span class="String"><span class="String">'</span>red<span class="String">'</span></span>).<span class="FunctionName">scope_options</span>
                assert_equal blue_scope, <span class="LibraryObject">Shirt</span>.<span class="FunctionName">colored</span>(<span class="String"><span class="String">'</span>blue<span class="String">'</span></span>).<span class="FunctionName">scope_options</span>
              <span class="Keyword">end</span>
            <span class="Keyword">end</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Incremento y decremento</h2>

<p>Los métodos de <strong>ActiveRecord</strong> <strong>increment</strong>, <strong>increment!</strong>, <strong>decrement</strong> y <strong>decrement!</strong> ahora toman un nuevo parámetro opcional. En las versiones previas de Rails se podían usar estos métodos para restar 1 a una columna dada.  En rails 2.1 podemos decir que valor restar o sumar. Así:</p>

<pre class="mac_classic">    player1.<span class="FunctionName">increment!</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>points</span>, <span class="Number">5</span>)
    player2.<span class="FunctionName">decrement!</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>points</span>, <span class="Number">2</span>)
</pre>

<p>En el ejemplo estoy sumando 5 puntos al jugador 1 y restando 2 puntos al jugador 2. Cómo este es un parámetro opcional, el código viejo no se ve afectado.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Find</h2>

<h3> Conditions</h3>

<p>A partir de ahora, se va a poder pasar un objeto como parámetro al método  <strong>find</strong> de  <strong>ActiveRecord</strong>, Vea este caso como ejemplo:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">Account<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
      composed_of <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>balance</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class_name</span> =&gt; <span class="String"><span class="String">&quot;</span>Money<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>mapping</span> =&gt; <span class="String"><span class="String">%w(</span>balance amount<span class="String">)</span></span>
    <span class="Keyword">end</span>
</pre>

<p>En este caso, ud. puede pasar una instancia de <strong>Money</strong> cómo parámetro al método <strong>find</strong> de la clase  <strong>Account</strong>, de la siguiente manera:</p>

<pre class="mac_classic">    amount <span class="Keyword">=</span> <span class="Number">500</span>
    currency <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>USD<span class="String">&quot;</span></span>
    <span class="LibraryObject">Account</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>balance</span> =&gt; <span class="LibraryObject">Money</span>.<span class="FunctionName">new</span>(amount, currency) })
</pre>

<h3> Last</h3>

<p>Hasta ahora sólo podíamos usar tres operadores para buscar datos usando el método <strong>find</strong> de <strong>ActiveRecord</strong>: <strong>:first</strong>, <strong>:all</strong> o el propio id del objeto (en este caso no pasamos ningún operador específico más que el id en sí mismo)</p>

<p>En Rails 2.1 hay un cuarto operador llamado  <strong>:last</strong>. Vea algunos ejemplos:</p>

<pre class="mac_classic">    <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>last</span>)
    <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>last</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; [ <span class="String"><span class="String">&quot;</span>user_name = ?<span class="String">&quot;</span></span>, user_name])
    <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>last</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>order</span> =&gt; <span class="String"><span class="String">&quot;</span>created_on DESC<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>offset</span> =&gt; <span class="Number">5</span>)
</pre>

<p>Para entender como funciona este nuevo operador, veamos el siguiente test:</p>

<pre class="mac_classic">    <span class="Keyword">def</span> <span class="FunctionName">test_find_last</span>
      last  <span class="Keyword">=</span> <span class="LibraryObject">Developer</span>.<span class="FunctionName">find</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>last</span>
      assert_equal last, <span class="LibraryObject">Developer</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>order</span> =&gt; <span class="String"><span class="String">'</span>id desc<span class="String">'</span></span>)
    <span class="Keyword">end</span>
</pre>

<h3> All</h3>

<p>El método estático <strong>all</strong> es un alias al método estático <strong>find(:all)</strong>. Por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Topic</span>.<span class="FunctionName">all</span> es lo mismo que <span class="LibraryObject">Topic</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>)
</pre>

<h3> First</h3>

<p>El método estático <strong>first</strong> es un alias al método estático <strong>find(:first)</strong>. Por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Topic</span>.<span class="FunctionName">first</span> es lo mismo que <span class="LibraryObject">Topic</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
</pre>

<h3> Last</h3>

<p>El método estático <strong>last</strong> es un alias al método estático <strong>find(:last)</strong>. Por ejemplo:</p>

<pre class="mac_classic">    <span class="LibraryObject">Topic</span>.<span class="FunctionName">last</span> es lo mismo que <span class="LibraryObject">Topic</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>last</span>)
</pre>

<h2> Usando <strong>first</strong> y <strong>last</strong> con named_scope</h2>

<p>Todo los métodos mencionados anteriormente funcionan con <strong>named_scope</strong>. Supongamos que creamos un <strong>named_scope</strong> llamado <strong>recent</strong>. Entonces podríamos hacer esto:</p>

<pre class="mac_classic">            post.<span class="FunctionName">comments</span>.<span class="FunctionName">recent</span>.<span class="FunctionName">last</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2>Eager Loading</h2>

<p>Para explicar esta nueva funcionalidad, veamos el siguiente código:</p>

<pre class="mac_classic">    <span class="LibraryObject">Author</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include</span> =&gt; [<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>posts</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>comments</span>])
</pre>

<p>Estoy haciendo una búsqueda en la tabla <strong>authors</strong>  y también incluyendo las tablas <strong>posts</strong> y <strong>comments</strong> en mi consulta a través de la columna <strong>author_id</strong>, el cual es el nombre de columna por defecto de acuerdo a la conveción que rails utiliza para las claves foráneas.
Esta búsqueda genera una consulta como la siguiente:</p>

<pre class="mac_classic">    <span class="Variable">SELECT</span>
      authors.<span class="String"><span class="String">&quot;</span>id<span class="String">&quot;</span></span>          <span class="Variable">AS</span> t0_r0,
      authors.<span class="String"><span class="String">&quot;</span>created_at<span class="String">&quot;</span></span>  <span class="Variable">AS</span> t0_r1,
      authors.<span class="String"><span class="String">&quot;</span>updated_at<span class="String">&quot;</span></span>  <span class="Variable">AS</span> t0_r2,
      posts.<span class="String"><span class="String">&quot;</span>id<span class="String">&quot;</span></span>            <span class="Variable">AS</span> t1_r0,
      posts.<span class="String"><span class="String">&quot;</span>author_id<span class="String">&quot;</span></span>     <span class="Variable">AS</span> t1_r1,
      posts.<span class="String"><span class="String">&quot;</span>created_at<span class="String">&quot;</span></span>    <span class="Variable">AS</span> t1_r2,
      posts.<span class="String"><span class="String">&quot;</span>updated_at<span class="String">&quot;</span></span>    <span class="Variable">AS</span> t1_r3,
      comments.<span class="String"><span class="String">&quot;</span>id<span class="String">&quot;</span></span>         <span class="Variable">AS</span> t2_r0,
      comments.<span class="String"><span class="String">&quot;</span>author_id<span class="String">&quot;</span></span>  <span class="Variable">AS</span> t2_r1,
      comments.<span class="String"><span class="String">&quot;</span>created_at<span class="String">&quot;</span></span> <span class="Variable">AS</span> t2_r2,
      comments.<span class="String"><span class="String">&quot;</span>updated_at<span class="String">&quot;</span></span> <span class="Variable">AS</span> t2_r3
    <span class="Variable">FROM</span>
      authors
      <span class="Variable">LEFT</span> <span class="Variable">OUTER</span> <span class="Variable">JOIN</span> posts <span class="Variable">ON</span> posts.<span class="FunctionName">author_id</span> <span class="Keyword">=</span> authors.<span class="FunctionName">id</span>
      <span class="Variable">LEFT</span> <span class="Variable">OUTER</span> <span class="Variable">JOIN</span> comments <span class="Variable">ON</span> comments.<span class="FunctionName">author_id</span> <span class="Keyword">=</span> authors.<span class="FunctionName">id</span>
</pre>

<p>Un única consulta SQL con <strong>joins</strong> entre las tablas  <strong>authors</strong>, <strong>posts</strong> y <strong>comments</strong>. A esto lo llamamos <strong>producto cartesiano</strong>.</p>

<p>Este tipo de consultas no siempre tiene una buena performance, entonces esto se cambió en Rails 2.1. La misma consulta para la clase <strong>Author</strong> ahora se hace de una forma diferente para traer la información de las tres tablas. En vez de usar una única consulta SQL con las tres tablas, Rails ahora usa tres consultas diferentes - una por cada tabla - las cuales son más cortas que la anterior. El resultado se puede ver en los logs despues de ejecutar el codigo ruby on rails previo:</p>

<pre class="mac_classic">    <span class="Variable">SELECT</span> <span class="Keyword">*</span> <span class="Variable">FROM</span> <span class="String"><span class="String">&quot;</span>authors<span class="String">&quot;</span></span>
    <span class="Variable">SELECT</span> posts.<span class="Keyword">*</span> <span class="Variable">FROM</span> <span class="String"><span class="String">&quot;</span>posts<span class="String">&quot;</span></span> <span class="Variable">WHERE</span> (posts.<span class="FunctionName">author_id</span> <span class="Variable">IN</span> (<span class="Number">1</span>))
    <span class="Variable">SELECT</span> comments.<span class="Keyword">*</span> <span class="Variable">FROM</span> <span class="String"><span class="String">&quot;</span>comments<span class="String">&quot;</span></span> <span class="Variable">WHERE</span> (comments.<span class="FunctionName">author_id</span> <span class="Variable">IN</span> (<span class="Number">1</span>))
</pre>

<p>En la <strong>mayoría de los casos</strong> estas tres simples consultas se ejecutan más rápido que la consulta larga y compleja.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Belongs_to</h2>

<p>El método <strong>belongs_to</strong> se cambió en pro de permitir el uso de <strong>:dependent => :destroy</strong> y <strong>:delete</strong>
en las asociaciones.</p>

<p>Por ejemplo:</p>

<pre class="mac_classic">    belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>author_address</span>
    belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>author_address</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>dependent</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>destroy</span>
    belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>author_address_extra</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>dependent</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>delete</span>,
            <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class_name</span> =&gt; <span class="String"><span class="String">&quot;</span>AuthorAddress<span class="String">&quot;</span></span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Polymorphic url</h2>

<p>Los métodos helper para las URL polimórficas son usados para resolver de una forma más elegante una ruta nombrada cuando cuando tenemos un modelo de  <strong>ActiveRecord</strong>.</p>

<p>Estos métodos son útiles cuando queremos generar la URL para un recurso <strong>RESTful</strong> sin especificar el tipo de registro en cuestión.</p>

<p>Es muy fácil de usar. Veamos algunos ejemplos (los comentarios explican las llamdas equivalentes para las versiones anteriores a Rails 2.1)</p>

<pre class="mac_classic">    record <span class="Keyword">=</span> <span class="LibraryObject">Article</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    <span class="FunctionName">polymorphic_url</span>(record) <span class="Comment"><span class="Comment">#</span>-&gt; article_url(record)</span>

    record <span class="Keyword">=</span> <span class="LibraryObject">Comment</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    <span class="FunctionName">polymorphic_url</span>(record)  <span class="Comment"><span class="Comment">#</span>-&gt;  comment_url(record)</span>

<span class="Comment">    <span class="Comment">#</span> it can also identify recently created elements</span>
    record <span class="Keyword">=</span> <span class="LibraryObject">Comment</span>.<span class="FunctionName">new</span>
    <span class="FunctionName">polymorphic_url</span>(record)  <span class="Comment"><span class="Comment">#</span>-&gt;  comments_url()</span>
</pre>

<p>Note como el método <strong>polymorphic_url</strong> es capáz de indetificar el tipo del objeto dado y generar la ruta correcta. También soporta <strong>Recursos anidados</strong> y <strong>espacios de nombres</strong>:</p>

<pre class="mac_classic">    <span class="FunctionName">polymorphic_url</span>([<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>admin</span>, <span class="Variable"><span class="Variable">@</span>article</span>, <span class="Variable"><span class="Variable">@</span>comment</span>])
<span class="Comment">    <span class="Comment">#</span>-&gt; this will return:</span>
    <span class="FunctionName">admin_article_comment_url</span>(<span class="Variable"><span class="Variable">@</span>article</span>, <span class="Variable"><span class="Variable">@</span>comment</span>)
</pre>

<p>También se puede usar <strong>new</strong>, <strong>edit</strong> y <strong>formatted</strong> como prefijos:</p>

<pre class="mac_classic">    <span class="FunctionName">edit_polymorphic_path</span>(<span class="Variable"><span class="Variable">@</span>post</span>)
<span class="Comment">    <span class="Comment">#</span>=&gt; /posts/1/edit</span>

    <span class="FunctionName">formatted_polymorphic_path</span>([<span class="Variable"><span class="Variable">@</span>post</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>pdf</span>])
<span class="Comment">    <span class="Comment">#</span>=&gt; /posts/1.pdf</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Relaciones de sólo lectura</h2>

<p>Se agregó una nueva caraterística a las relaciones entre modelos. Con el fin de impedir alterar los modelos ahora podemos usar <strong>:readonly</strong> para asociar modelos. Veamos algunos ejemplos:</p>

<pre class="mac_classic">    has_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>reports</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>readonly</span> =&gt; <span class="BuiltInConstant">true</span>

    has_one <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>boss</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>readonly</span> =&gt; <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>true</span>

    belongs_to <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>project</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>readonly</span> =&gt; <span class="BuiltInConstant">true</span>

    has_and_belongs_to_many <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>categories</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>readonly</span> =&gt; <span class="BuiltInConstant">true</span>
</pre>

<p>De esta manera los registros protegidos no podrán ser alterados desde este modelo. Si intentamos editar algunos de los registros de este modelos entonces obtendríamos la siguiente excepción: <strong>ActiveRecord::ReadOnlyRecord</strong></p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Métodos add_timestamps y remove_timestamps</h2>

<p>Ahora tenemos 2 métodos nuevos: <strong>add_timestamps</strong> y <strong>remove_timestamps</strong>. Los cuales agregan y eliminan, respectivamente, las columnas de <strong>timestamp</strong>. Veamos un ejemplo:</p>

<pre class="mac_classic">    <span class="Keyword">def</span> <span class="FunctionName">self.up</span>
      add_timestamps <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>feeds</span>
      add_timestamps <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>urls</span>
    <span class="Keyword">end</span>

    <span class="Keyword">def</span> <span class="FunctionName">self.down</span>
      remove_timestamps <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>urls</span>
      remove_timestamps <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>feeds</span>
    <span class="Keyword">end</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Cálculos</h2>

<p><strong>ActiveRecord::Calculations</strong> ha cambiado un poco para aceptar no sólo el nombre de la columna sino también el nombre de la tabla. Esto es muy útil cuando tenemos una relación entre dos tablas que tienen una columna con el mismo nombre. Los métodos afectados son: <strong>sum</strong> o <strong>maximum</strong> de <strong>ActiveRecord</strong> (entre otros). Para resumir ahora podemos hacer esto de estas dos formas:</p>

<pre class="mac_classic">    authors.<span class="FunctionName">categories</span>.<span class="FunctionName">maximum</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>id</span>)
    authors.<span class="FunctionName">categories</span>.<span class="FunctionName">maximum</span>(<span class="String"><span class="String">&quot;</span>categories.id<span class="String">&quot;</span></span>)
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> ActiveRecord::Base.create acepta bloques</h2>

<p>Estamos acostumbrados al método <strong>ActiveRecord::Base.new</strong> que acepta el uso de bloques. Ahora podemos hacer lo mismo con el método  <strong>create</strong>:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Creación de un nuevo objeto pasándole un bloque con la descripción de sus atributos</span>
    <span class="LibraryObject">User</span>.<span class="FunctionName">create</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first_name</span> =&gt; <span class="String"><span class="String">'</span>Jamie<span class="String">'</span></span>) <span class="Keyword">do </span>|<span class="Variable">u</span>|
      u.<span class="FunctionName">is_admin</span> <span class="Keyword">=</span> <span class="BuiltInConstant">false</span>
    <span class="Keyword">end</span>
</pre>

<p>Podemos usar este mismo método para crear muchos objetos de una sola vez:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Creación de un array de objetos nuevos usando un bloque.</span>
<span class="Comment">    <span class="Comment">#</span> El bloque se ejecuta una vez por cada nuevo objeto creado.</span>
    <span class="LibraryObject">User</span>.<span class="FunctionName">create</span>([{<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first_name</span> =&gt; <span class="String"><span class="String">'</span>Jamie<span class="String">'</span></span>}, {<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first_name</span> =&gt; <span class="String"><span class="String">'</span>Jeremy<span class="String">'</span></span>}]) <span class="Keyword">do </span>|<span class="Variable">u</span>|
      u.<span class="FunctionName">is_admin</span> <span class="Keyword">=</span> <span class="BuiltInConstant">false</span>
    <span class="Keyword">end</span>
</pre>

<p>Esto también funciona para las asociaciones:</p>

<pre class="mac_classic">    author.<span class="FunctionName">posts</span>.<span class="FunctionName">create!</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span> =&gt; <span class="String"><span class="String">&quot;</span>New on Edge<span class="String">&quot;</span></span>) {|<span class="Variable">p</span>| p.<span class="FunctionName">body</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>More cool stuff!<span class="String">&quot;</span></span>}

<span class="Comment">    <span class="Comment">#</span> o</span>

    author.<span class="FunctionName">posts</span>.<span class="FunctionName">create!</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span> =&gt; <span class="String"><span class="String">&quot;</span>New on Edge<span class="String">&quot;</span></span>) <span class="Keyword">do </span>|<span class="Variable">p</span>|
      p.<span class="FunctionName">body</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>More cool stuff!<span class="String">&quot;</span></span>
    <span class="Keyword">end</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> change_table</h2>

<p>La creación de migraciones (<strong>migrations</strong>) en Rails 2.0 se hizo mucho más sexy que en las versiones previas, pero alterar una tabla usando <strong>migrations</strong> continuaba siendo como antes, nada sexy.</p>

<p>En Rails 2.1, ahora también es sexy alterar una tabla, con el nuevo método <strong>change_table</strong>. Veamos el ejemplo:</p>

<pre class="mac_classic">    change_table <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>videos</span> <span class="Keyword">do </span>|<span class="Variable">t</span>|
      t.<span class="FunctionName">timestamps</span> <span class="Comment"><span class="Comment">#</span> esto agrega las columnas created_at y updated_at</span>
      t.<span class="FunctionName">belongs_to</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>goat</span> <span class="Comment"><span class="Comment">#</span> esto agrega la columna goat_id (integer)</span>
      t.<span class="FunctionName">string</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>name</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>email</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>limit</span> =&gt; <span class="Number">20</span> <span class="Comment"><span class="Comment">#</span> esto agrega las columnas name y email</span>
      t.<span class="FunctionName">remove</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>name</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>email</span> <span class="Comment"><span class="Comment">#</span> esto elimina las columnas name y email</span>
    <span class="Keyword">end</span>
</pre>

<p>El nuevo método <strong>change_table</strong> funciona como <strong>create_table</strong> pero en vez de crear un tabla modifica una ya existente agregando o eliminando columnas e índices.</p>

<pre class="mac_classic">    change_table <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>table</span> <span class="Keyword">do </span>|<span class="Variable">t</span>|
      t.<span class="FunctionName">column</span> <span class="Comment"><span class="Comment">#</span> agrega una columna normal. Ej: t.column(:name, :string)</span>
      t.<span class="FunctionName">index</span> <span class="Comment"><span class="Comment">#</span> agrega un nuevo índice.</span>
      t.<span class="FunctionName">timestamps</span>
      t.<span class="FunctionName">change</span> <span class="Comment"><span class="Comment">#</span> cambia la definición de una columna. Ej: t.change(:name, :string, :limit =&gt; 80)</span>
      t.<span class="FunctionName">change_default</span> <span class="Comment"><span class="Comment">#</span> cambia el valor por defecto de una columna.</span>
      t.<span class="FunctionName">rename</span> <span class="Comment"><span class="Comment">#</span> cambia el nombre de una columna.</span>
      t.<span class="FunctionName">references</span>
      t.<span class="FunctionName">belongs_to</span>
      t.<span class="FunctionName">string</span>
      t.<span class="FunctionName">text</span>
      t.<span class="FunctionName">integer</span>
      t.<span class="FunctionName">float</span>
      t.<span class="FunctionName">decimal</span>
      t.<span class="FunctionName">datetime</span>
      t.<span class="FunctionName">timestamp</span>
      t.<span class="FunctionName">time</span>
      t.<span class="FunctionName">date</span>
      t.<span class="FunctionName">binary</span>
      t.<span class="FunctionName">boolean</span>
      t.<span class="FunctionName">remove</span>
      t.<span class="FunctionName">remove_references</span>
      t.<span class="FunctionName">remove_belongs_to</span>
      t.<span class="FunctionName">remove_index</span>
      t.<span class="FunctionName">remove_timestamps</span>
    <span class="Keyword">end</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Dirty Objects</h2>

<p>Ahora en Rails podemos rastrear los cambios hechos por <strong>ActiveRecord</strong>. Se puede saber si un objeto ha sido modificado o no. En caso de que haya cambiado, podemos ver que fue lo que cambió exactamente como así también comparar su estado anterior con el actual. Veamos algunos ejemplos:</p>

<pre class="mac_classic">    article <span class="Keyword">=</span> <span class="LibraryObject">Article</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    article.<span class="FunctionName">changed?</span>  <span class="Comment"><span class="Comment">#</span>=&gt; false</span>

    article.<span class="FunctionName">title</span>  <span class="Comment"><span class="Comment">#</span>=&gt; &quot;Title&quot;</span>
    article.<span class="FunctionName">title</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>New Title<span class="String">&quot;</span></span>
    article.<span class="FunctionName">title_changed?</span> <span class="Comment"><span class="Comment">#</span>=&gt; true</span>

<span class="Comment">    <span class="Comment">#</span> muestra title antes del cambio</span>
    article.<span class="FunctionName">title_was</span>  <span class="Comment"><span class="Comment">#</span>=&gt; &quot;Title&quot;</span>

<span class="Comment">    <span class="Comment">#</span> antes y despues del cambio</span>
    article.<span class="FunctionName">title_change</span>  <span class="Comment"><span class="Comment">#</span>=&gt; [&quot;Title&quot;, &quot;New Title&quot;]</span>
</pre>

<p>Como ud. puede ver es muy simple. Puede listar todos los cambios hechos al objeto de una esta dos formas:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> retorna una lista con todos los atributos que cambiaron</span>
    article.<span class="FunctionName">changed</span>  <span class="Comment"><span class="Comment">#</span>=&gt; ['title']</span>

<span class="Comment">    <span class="Comment">#</span> retorna un hash con los atributos que cambiaron</span>
<span class="Comment">    <span class="Comment">#</span> con sus valores antes y después</span>
    article.<span class="FunctionName">changes</span>  <span class="Comment"><span class="Comment">#</span>=&gt; { 'title' =&gt; [&quot;Title&quot;, &quot;New Title&quot;] }</span>
</pre>

<p>Note que cuando el objeto se guarda su estado de alterado cambia:</p>

<pre class="mac_classic">    article.<span class="FunctionName">changed?</span>  <span class="Comment"><span class="Comment">#</span>=&gt; true</span>
    article.<span class="FunctionName">save</span>  <span class="Comment"><span class="Comment">#</span>=&gt; true</span>
    article.<span class="FunctionName">changed?</span>  <span class="Comment"><span class="Comment">#</span>=&gt; false</span>
</pre>

<p>En caso de ud. quiera cambiar el estado de un objeto sin usar <strong>attr=</strong>, va a necesitar informar explícitamente que se ha modificado el atributo mediante el método <strong>attr_name_will_change!</strong> (reemplace <strong>attr</strong> con el nombre real del atributo del objeto). Veamos un ejemplo más:</p>

<pre class="mac_classic">    article <span class="Keyword">=</span> <span class="LibraryObject">Article</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    article.<span class="FunctionName">title_will_change!</span>
    article.<span class="FunctionName">title</span>.<span class="FunctionName">upcase!</span>
    article.<span class="FunctionName">title_change</span>  <span class="Comment"><span class="Comment">#</span>=&gt; ['Title', 'TITLE']</span>
</pre>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Partial Updates</h2>

<p>La implementación de <strong>Dirty Objects</strong> dió punto de partida a otra característica muy interesante.</p>

<p>Dado que ahora podemos rastrear los cambios de los atributos de un objeto, ¿por qué no usar esto para evitar actualizaciones innecesarias en la base de datos?</p>

<p>En las versiones previas de Rails cuando ejecutábamos el método <strong>save</strong> de un objeto <strong>ActiveRecord</strong>, se actualizaban todos los campos en la base de datos. Por más que los mismos no hayan sufrido ningún cambio.</p>

<p>Con <strong>Dirty Objects</strong> esta acción podría mejorarse, y esto es exactamente lo que pasó. Miremos un poco la consulta SQL generada en Rails 2.1 cuando intentamos guardar un objeto que a sufrido un pequeño cambio:</p>

<pre class="mac_classic">    article <span class="Keyword">=</span> <span class="LibraryObject">Article</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
    article.<span class="FunctionName">title</span>  <span class="Comment"><span class="Comment">#</span>=&gt; &quot;Title&quot;</span>
    article.<span class="FunctionName">subject</span>  <span class="Comment"><span class="Comment">#</span>=&gt; &quot;Edge Rails&quot;</span>

<span class="Comment">    <span class="Comment">#</span> Cambiamos el título (title)</span>
    article.<span class="FunctionName">title</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>New Title<span class="String">&quot;</span></span>

<span class="Comment">    <span class="Comment">#</span> esto crea el siguiente SQL para persistir el objeto</span>
    article.<span class="FunctionName">save</span>
<span class="Comment">    <span class="Comment">#</span>=&gt;  &quot;UPDATE articles SET title = 'New Title' WHERE id = 1&quot;</span>
</pre>

<p>Note como sólo se actualizaron en la base de datos los campos que fueron cambiados en la aplicación. Si ningún campo ha sido actualizado en la aplicación, entonces <strong>ActiveRecord</strong> no ejecutará ninguna actualización.</p>

<p>Para habilitar/deshabilitar esta nueva característica debe cambiar la propiedad <strong>partial_updates</strong> de sus modelos.</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Para habilitarla</span>
    <span class="LibraryObject">MyClass</span>.<span class="FunctionName">partial_updates</span> <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
</pre>

<p>Si desea habilitar/deshabilitar esta característica para todos sus modelos debe editar el archivo <em>config/initializers/new_rails_defaults.rb</em>:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Habilitando para todos los modelos</span>
    <span class="LibraryObject">ActiveRecord</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">partial_updates</span> <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
</pre>

<p>No olvide informarle a Rails a través <em>config/initializers/new_rails_defaults.rb</em> que va a actualizar un atributo sin usar el método <strong>attr=</strong>, así:</p>

<pre class="mac_classic"><span class="Comment">    <span class="Comment">#</span> Si usa **attr=**,</span>
<span class="Comment">    <span class="Comment">#</span> entocnes está bien no informar nada.</span>
    person.<span class="FunctionName">name</span> <span class="Keyword">=</span> <span class="String"><span class="String">'</span>bobby<span class="String">'</span></span>
    person.<span class="FunctionName">name_change</span>    <span class="Comment"><span class="Comment">#</span> =&gt; ['bob', 'bobby']</span>


<span class="Comment">    <span class="Comment">#</span> Pero debe informar que el campo se va actualizar</span>
<span class="Comment">    <span class="Comment">#</span> si no va a usar **attr=**</span>
    person.<span class="FunctionName">name_will_change!</span>
    person.<span class="FunctionName">name</span> <span class="Keyword">&lt;&lt;</span> <span class="String"><span class="String">'</span>by<span class="String">'</span></span>
    person.<span class="FunctionName">name_change</span>    <span class="Comment"><span class="Comment">#</span> =&gt; ['bob', 'bobby']</span>
</pre>

<p>Si ud. no informa cambios como estos, no se podrán rastrear los cambios de los atributos del modelo y la tabla no se actualizará correctamente.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> ¿Smallint, int o bigint en MySQL?</h2>

<p>El adapatador para <strong>MySQL</strong> de <strong>ActiveRecord</strong> es un poco más inteligente en el uso tipos de datos enteros a la hora de crear o alterar columnas en la base de datos. Con la opción <strong>:limit</strong>, podemos definir si la columna va a ser <strong>smallint</strong>, <strong>int</strong> or <strong>bigint</strong>. Veamos el código que hace este trabajo:</p>

<pre class="mac_classic">    <span class="Keyword">case</span> limit
    <span class="Keyword">when</span> <span class="Number">0</span>..<span class="Number">3</span>
      <span class="String"><span class="String">&quot;</span>smallint(<span class="StringInterpolation"><span class="StringInterpolation">#{</span>limit<span class="StringInterpolation">}</span></span>)<span class="String">&quot;</span></span>
    <span class="Keyword">when</span> <span class="Number">4</span>..<span class="Number">8</span>
      <span class="String"><span class="String">&quot;</span>int(<span class="StringInterpolation"><span class="StringInterpolation">#{</span>limit<span class="StringInterpolation">}</span></span>)<span class="String">&quot;</span></span>
    <span class="Keyword">when</span> <span class="Number">9</span>..<span class="Number">20</span>
      <span class="String"><span class="String">&quot;</span>bigint(<span class="StringInterpolation"><span class="StringInterpolation">#{</span>limit<span class="StringInterpolation">}</span></span>)<span class="String">&quot;</span></span>
    <span class="Keyword">else</span>
      <span class="String"><span class="String">'</span>int(11)<span class="String">'</span></span>
    <span class="Keyword">end</span>
</pre>

<p>Para dejar esto más claro vamos a mapear esto en un archivo de migración y ver que tipo de dato se usa para cada columna:</p>

<pre class="mac_classic">    create_table <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>table_name</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>force</span> =&gt; <span class="BuiltInConstant">true</span> <span class="Keyword">do </span>|<span class="Variable">t</span>|

<span class="Comment">      <span class="Comment">#</span> 0 - 3: smallint</span>
      t.<span class="FunctionName">integer</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>column_one</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>limit</span> =&gt; <span class="Number">2</span> <span class="Comment"><span class="Comment">#</span> smallint(2)</span>

<span class="Comment">      <span class="Comment">#</span> 4 - 8: int</span>
      t.<span class="FunctionName">integer</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>column_two</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>limit</span> =&gt; <span class="Number">6</span> <span class="Comment"><span class="Comment">#</span> int(6)</span>

<span class="Comment">      <span class="Comment">#</span> 9 - 20: bigint</span>
      t.<span class="FunctionName">integer</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>column_three</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>limit</span> =&gt; <span class="Number">15</span> <span class="Comment"><span class="Comment">#</span> bigint(15)</span>

<span class="Comment">      <span class="Comment">#</span> si no usamos :limit int(11)</span>
      t.<span class="FunctionName">integer</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>column_four</span> <span class="Comment"><span class="Comment">#</span> int(11)</span>
    <span class="Keyword">end</span>
</pre>

<p>El adaptador de <strong>PostgreSQL</strong> tenía esta caraterística y <strong>MySQL</strong> sólo siguió esta tendencia.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Opcional :select en has_one y belongs_to</h2>

<p>Los ya conocidos métodos <strong>has_one</strong> y <strong>belongs_to</strong> ahora tienen la opción: <strong>:select</strong>.</p>

<p>El valor por defecto es "<em>" (como en "SELECT </em> FROM table"), pero se puede editar para recuperar sólo las columnas que vamos a usar.</p>

<p>No olvide incluir las <strong>claves promarias</strong> y las <strong>claves foráneas</strong>, de lo contrario obtendrá un error.</p>

<p>El método <strong>belongs_to</strong> ya no tiene la opción <strong>:order</strong>. Pero no se preocupe por que realmente no
era muy útil.</p>

<!-- -*- mode: markdown; coding: utf-8; -*- -->


<h2> Almacenando el nombre completo de una clase cuando usamos STI</h2>

<p>Siempre que usemos <strong>models</strong> con <strong>namespace</strong> y <strong>STI</strong>, <strong>ActiveRecord</strong> sólo almacena el nombre de la clase, sin el nombre del <strong>namespace</strong> (<em>demodulized</em>). Esto sólo funcionará si todas las clses en el <strong>STI</strong> estan en el mismo <strong>namespace</strong>. Veamos un ejemplo:</p>

<pre class="mac_classic">    <span class="Keyword">class</span> <span class="TypeName">CollectionItem<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>; <span class="Keyword">end</span>
    <span class="Keyword">class</span> <span class="TypeName">ComicCollection::Item<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> CollectionItem</span></span>; <span class="Keyword">end</span>

    item <span class="Keyword">=</span> <span class="LibraryObject">ComicCollection</span>::<span class="FunctionName">Item</span>.<span class="FunctionName">new</span>
    item.<span class="FunctionName">type</span> <span class="Comment"><span class="Comment">#</span> =&gt; 'Item'</span>

    item2 <span class="Keyword">=</span> <span class="LibraryObject">CollectionItem</span>.<span class="FunctionName">find</span>(item.<span class="FunctionName">id</span>)
<span class="Comment">    <span class="Comment">#</span> retorna un error, por que no puede encontrar</span>
<span class="Comment">    <span class="Comment">#</span> la clase Item</span>
</pre>

<p>Este cambio agrega una nueva opción que hace que <strong>ActiveRecord</strong> almacene el nombre completo de la clase.</p>

<p>Para habilitar/deshabilita esta característica, ud. debe incluir o editar lo siguiente en su <strong>environment.rb</strong>.</p>

<pre class="mac_classic">    <span class="LibraryObject">ActiveRecord</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">store_full_sti_class</span> <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
</pre>

<p>El valor por defecto es true.</p>

<h2> Method table_exists?</h2>

<p>New method for the <strong>AbstractAdapter</strong> class: <strong>table_exists</strong>. It is very simple to use:</p>

<pre class="mac_classic"><span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">ActiveRecord</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">connection</span>.<span class="FunctionName">table_exists?</span>(<span class="String"><span class="String">&quot;</span>users<span class="String">&quot;</span></span>)
=&gt; <span class="BuiltInConstant">true</span>
</pre>

<h2> Timestamped Migrations</h2>

<p>When you are just starting Rails or developing something on your own, <strong>migrations</strong> seem to be the best solution to all of your problems. However, when with a team of developers on a project, you will find out (if you haven't already) that it becomes a bit more troublesome to handle race conditions on migrations. The new timestamped migrations in Rails 2.1 to the rescue.</p>

<p>Before the introduction of <strong>timestamped migrations</strong>, each new migration created had a number which prefaced the migration name. If two migrations were generated by different developers and not committed instantly, they could end up having the same number preface by different migration info. At this point your schema_info is out of date and you have a conflict in your source control.</p>

<p>There were many ways to "try" to solve this problem. Many plugins were created with different approaches to solve this issue. Despite the plugins available, one thing was clear: the old way simply didn't work.   <br/>
</p>

<p>If you were using Git, then you would be digging an even deeper hole, since your team would probably have a couple of working branches and out-of-date <strong>migrations</strong> in all of them. You would have serious conflict problems when merging branches.</p>

<p>To solve this huge problem, the core team changed how <strong>migrations</strong> works in Rails.  Instead of prefacing each migration file with a number from corresponding to the current schema_info's version count, it is now prefaced with a string based on the <strong>UTC</strong> time and following the format YYYYMMDDHHMMSS.</p>

<p>Also a new table called <strong>schema_migrations</strong> was created and it stores which <strong>migrations</strong> that have already been executed. That way, if anyone creates a <strong>migration</strong> with a smaller number, rails will <strong>rollback</strong> migrations until the previous version and then run everything up to the current version.</p>

<p>Apparently, it solves the conflict problem with <strong>migrations</strong>.</p>

<p>There is an option to disable this feature by including the following line in <strong>environment.rb</strong>:</p>

<pre class="mac_classic">config.<span class="FunctionName">active_record</span>.<span class="FunctionName">timestamped_migrations</span> <span class="Keyword">=</span> <span class="BuiltInConstant">false</span>
</pre>

<p>There are also new rake tasks to "walk through" <strong>migrations</strong>:</p>

<pre class="mac_classic">rake db<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>migrate</span><span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>up</span>
rake db<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>migrate</span><span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>down</span>
</pre>

<h1> ActiveSupport</h1>

<p>Active Support is a collection of useful classes and default libraries extensions which were considered useful for Ruby on Rails Applications.
(wikipedia)</p>

<h2> ActiveSupport::CoreExtensions::Date::Calculations</h2>

<h3> Time#end_of_day</h3>

<p>Returns the current date with the time set to 11:59:59 PM.</p>

<h3> Time#end_of_week</h3>

<p>Returns the end of the week (Sunday 11:59:59 PM).</p>

<h3> Time#end_of_quarter</h3>

<p>Returns a Date object representing the end of the trimester. In other words, it returns the last day of either march, june, september or december, depending on the current date.</p>

<h3> Time#end_of_year</h3>

<p>Returns December 31 at 11:59:59 PM</p>

<h3> Time#in_time_zone</h3>

<p>This method is similar to <strong>Time#localtime</strong>, except by the fact that it uses <strong>Time.zone</strong> instead of the underlying operating system's timezone. You can pass either <strong>TimeZone</strong> or <strong>String</strong> as a parameter. Look at some examples:</p>

<pre class="mac_classic"><span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span> <span class="Keyword">=</span> <span class="String"><span class="String">'</span>Hawaii<span class="String">'</span></span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>).<span class="FunctionName">in_time_zone</span>
<span class="Comment"><span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 14:00:00 HST -10:00</span>

<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>).<span class="FunctionName">in_time_zone</span>(<span class="String"><span class="String">'</span>Alaska<span class="String">'</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 15:00:00 AKST -09:00</span>
</pre>

<h3> Time#days_in_month</h3>

<p>A bug in the method <strong>days_in_month</strong> was fixed, which returned the wrong number of days in february when the year was was not specified. </p>

<p>Changes comprise in using the current year as the default value when not specifying the year in method call. Suppose you were in a leap year. Look the following example:</p>

<pre class="mac_classic"><span class="Variable">Loading</span> development environment (<span class="Variable">Rails</span> <span class="Number">2.0</span>.<span class="Number">2</span>)
<span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Time</span>.<span class="FunctionName">days_in_month</span>(<span class="Number">2</span>)
=&gt; <span class="Number">28</span>

<span class="Variable">Loading</span> development environment (<span class="Variable">Rails</span> <span class="Number">2.1</span>.<span class="Number">0</span>)
<span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Time</span>.<span class="FunctionName">days_in_month</span>(<span class="Number">2</span>)
=&gt; <span class="Number">29</span>
</pre>

<h3> DateTime#to_f</h3>

<p><strong>DateTime</strong> class received a new method called <strong>to_f</strong> which returns the date as a type float number representing the number of seconds since the Unix epoch (number of seconds since january 1st, 1970, midnight).</p>

<h3> Date.current</h3>

<p><strong>Date</strong> class received a new method called <strong>current</strong> which must now be used instead of <strong>Date.today</strong>, because it considers the timezone set in <strong>config.time_zone</strong> in case it is set, returning a <strong>Time.zone.today</strong>. If it is not set, then it returns a <strong>Date.today</strong>.</p>

<h2> Fragment_exist?</h2>

<p>Two new methods were added to <strong>cache_store</strong>: <strong>fragment_exist?</strong> and <strong>exist?</strong>.</p>

<p>The method <strong>fragment_exist?</strong> does exactly what you would expect, it verifies if a cached fragment informed by one key exists.  Basically replacing the famous:</p>

<pre class="mac_classic"><span class="FunctionName">read_fragment</span>(path).<span class="FunctionName">nil?</span>
</pre>

<p><strong>exist?</strong> method was added to <strong>cache_store</strong>, while <strong>fragment_exist?</strong>  is a helper which you could use inside your controller.</p>

<h2> UTC or GMT?</h2>

<p>An amendment, but interesting. Until now Rails has been using the UTC acronym a lot, but when the method <strong>to_s</strong> from <strong>TimeZone</strong> is called, it will print GMT, not UTC. This is due to the fact that the GMT acronym is the most common among end users.</p>

<p>If you take a look in Windows control panel, where you can choose timezone, you'll notice the acronym used is GMT. Google and Yahoo also have been using GMT within their products.</p>

<pre class="mac_classic"><span class="LibraryObject">TimeZone</span>[<span class="String"><span class="String">'</span>Moscow<span class="String">'</span></span>].<span class="FunctionName">to_s</span> <span class="Comment"><span class="Comment">#</span>=&gt; &quot;(GMT+03:00) Moscow&quot;</span>
</pre>

<h2> JSON escape</h2>

<p><strong>json_escape</strong> method works like <strong>html_escape</strong>. It's very useful when we need to show <strong>JSON</strong> strings in a <strong>HTML</strong> page, for example, in a documentation process.</p>

<pre class="mac_classic">puts <span class="FunctionName">json_escape</span>(<span class="String"><span class="String">&quot;</span>is a &gt; 0 &amp; a &lt; 10?<span class="String">&quot;</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; is a \u003E 0 \u0026 a \u003C 10?</span>
</pre>

<p>We can also use the shortcut <strong>j</strong> when in ERB:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%=</span> j <span class="Variable"><span class="Variable">@</span>person</span>.<span class="FunctionName">to_json</span> <span class="String"><span class="String">%&gt;</span></span>
</pre>

<p>If you want all <strong>JSON</strong> code to be 'escaped' by default, include the following line in your <em>environment.rb</em> file:</p>

<pre class="mac_classic"><span class="LibraryObject">ActiveSupport</span>.<span class="FunctionName">escape_html_entities_in_json</span> <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
</pre>

<h2> Mem_cache_store now accepts options</h2>

<p>The inclusion of <strong>Memcache-Client</strong> inside <strong>ActiveSupport::Cache</strong> made things easier than ever, but it also took away its flexibility in not allowing us to customize nothing more than the IP of the <strong>memcached</strong> server.</p>

<p><strong>Jonathan Weiss</strong> made a patch which was included in Rails allowing extra options like these:</p>

<pre class="mac_classic"><span class="LibraryObject">ActiveSupport</span>::<span class="FunctionName">Cache</span>.<span class="FunctionName">lookup_store</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>mem_cache_store</span>, <span class="String"><span class="String">&quot;</span>localhost<span class="String">&quot;</span></span>

<span class="LibraryObject">ActiveSupport</span>::<span class="FunctionName">Cache</span>.<span class="FunctionName">lookup_store</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>mem_cache_store</span>, <span class="String"><span class="String">&quot;</span>localhost<span class="String">&quot;</span></span>, <span class="String"><span class="String">'</span>192.168.1.1<span class="String">'</span></span>, 
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>namespace</span> =&gt; <span class="String"><span class="String">'</span>foo<span class="String">'</span></span>
</pre>

<p>or</p>

<pre class="mac_classic">config.<span class="FunctionName">action_controller</span>.<span class="FunctionName">fragment_cache_store</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>mem_cache_store</span>, <span class="String"><span class="String">'</span>localhost<span class="String">'</span></span>,
    {<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>compression</span> =&gt; <span class="BuiltInConstant">true</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>debug</span> =&gt; <span class="BuiltInConstant">true</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>namespace</span> =&gt;<span class="String"><span class="String">'</span>foo<span class="String">'</span></span>}
</pre>

<h2> Time.current</h2>

<p>A new method for <strong>Time</strong> class. The <strong>current</strong> method's return depends on <strong>config.time_zone</strong>, if it was specified before, the method will return a <strong>Time.zone.now</strong>, otherwise will be a <strong>Time.now</strong>.</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> return value depends on config.time_zone</span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">current</span>
</pre>

<p><strong>since</strong> and <strong>ago</strong> methods also had their returning values changed, returning a <strong>TimeWithZone</strong> in case <strong>config.time_zone</strong> as specified.</p>

<p>It makes the <strong>Time.current</strong> method as new default method to get the actual time, replacing the <strong>Time.now</strong> (which keeps existing, but it doesn't consider the specified timezone).</p>

<p>The <strong>datetime_select</strong> methods, <strong>select_datetime</strong> and <strong>select_time</strong> also have been updated to have their default returning as <strong>Time.current</strong>.</p>

<h2>Removing whitespaces with squish method</h2>

<p>Two new methods added to the <strong>String</strong> object, <strong>squish</strong> and <strong>squish!</strong>.</p>

<p>These methods do the same as <strong>strip</strong> method. It removes white spaces from the beginning and the end of the text. It also removes unused white-spaces (multiple white-spaces) from the middle of the text
Look the example:</p>

<pre class="mac_classic">“    <span class="Variable">A</span>    text    full    of     spaces    “.<span class="FunctionName">strip</span>
<span class="Comment"><span class="Comment">#</span>=&gt; “A    text    full    of     spaces”</span>

“    <span class="Variable">A</span>    text    full    of     spaces    “.<span class="FunctionName">squish</span>
<span class="Comment"><span class="Comment">#</span>=&gt; “A text full of spaces”</span>
</pre>

<h1> ActiveResource</h1>

<p>ActiveResource is a layer responsible by the client side implementation of RESTful systems. Through ActiveResource is possible to consume RESTful services by using objects that work like a proxy for remote services.</p>

<h2> Using email as username.</h2>

<p>Some services use the e-mail as username, which forces us to use an URL like the following:</p>

<pre class="mac_classic">http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>ernesto.<span class="FunctionName">jimenez</span><span class="Variable"><span class="Variable">@</span>negonation</span>.<span class="FunctionName">com</span><span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>pass</span><span class="Variable"><span class="Variable">@</span>tractis</span>.<span class="FunctionName">com</span>
</pre>

<p>But this was causing a problem. Because we have two (@), the interpreter got lost when reading this. For this reason, <strong>ActiveResource</strong> was extended a little bit more, envisioning to make easier to use e-emails for authentication. Now you can do the following:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">Person<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveResource::Base</span></span>
  <span class="Variable">self</span>.<span class="FunctionName">site</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>http://tractis.com<span class="String">&quot;</span></span>
  <span class="Variable">self</span>.<span class="FunctionName">user</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>ernesto.jimenez@negonation.com<span class="String">&quot;</span></span>
  <span class="Variable">self</span>.<span class="FunctionName">password</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>pass<span class="String">&quot;</span></span>
<span class="Keyword">end</span>
</pre>

<h2> The clone method</h2>

<p>Now we can clone an existing resource:</p>

<pre class="mac_classic">ryan <span class="Keyword">=</span> <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="Number">1</span>)
not_ryan <span class="Keyword">=</span> ryan.<span class="FunctionName">clone</span>
not_ryan.<span class="FunctionName">new?</span>  <span class="Comment"><span class="Comment">#</span> =&gt; true</span>
</pre>

<p>Please note the copied object doesn't clone any of the class attributes, just the resource attributes.</p>

<pre class="mac_classic">ryan <span class="Keyword">=</span> <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="Number">1</span>)
ryan.<span class="FunctionName">address</span> <span class="Keyword">=</span> <span class="LibraryObject">StreetAddress</span>.<span class="FunctionName">find</span>(<span class="Number">1</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>person_id</span> =&gt; ryan.<span class="FunctionName">id</span>)
ryan.<span class="FunctionName">hash</span> <span class="Keyword">=</span> {<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>not</span> =&gt; <span class="String"><span class="String">&quot;</span>an ARes instance<span class="String">&quot;</span></span>} 

not_ryan <span class="Keyword">=</span> ryan.<span class="FunctionName">clone</span>
not_ryan.<span class="FunctionName">new?</span>            <span class="Comment"><span class="Comment">#</span> =&gt; true</span>
not_ryan.<span class="FunctionName">address</span>         <span class="Comment"><span class="Comment">#</span> =&gt; NoMethodError</span>
not_ryan.<span class="FunctionName">hash</span>            <span class="Comment"><span class="Comment">#</span> =&gt; {:not =&gt; &quot;an ARes instance&quot;}</span>
</pre>

<h2> Timeouts</h2>

<p>ActiveResource uses <strong>HTTP</strong> to access RESTful API's and because of that it is susceptible to problems with slow server responses or non-reachable servers. In some cases, calls to ActiveResource can expire (timeout). Now you can control the expiration time with the timeout property.</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">Person<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveResource::Base</span></span>
  <span class="Variable">self</span>.<span class="FunctionName">site</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>http://api.people.com:3000/<span class="String">&quot;</span></span>
  <span class="Variable">self</span>.<span class="FunctionName">timeout</span> <span class="Keyword">=</span> <span class="Number">5</span> <span class="Comment"><span class="Comment">#</span> waits 5 seconds before expire</span>
<span class="Keyword">end</span>
</pre>

<p>In this example above a timeout of 5 seconds was configured. A low value is recommended to allow your system to fail-fast, 
preventing cascading fails which could incapacitate your server.</p>

<p>Internally, ActiveResource shares resource from the Net:HTTP library to make HTTP requests. When you define a value for the timeout property, the same value is defined for the <strong>read_timeout</strong> of the Net:HTTP object instance which is being used.</p>

<p>The default value is 60 seconds.</p>

<h1> ActionPack</h1>

<p>Comprises ActionView (visualization generation for end user, like HTML, XML, JavaScript, and etc) and ActionController (business flow control)
(adapted from wikipedia)</p>

<h2> TimeZone</h2>

<h3> Defining a default timezone</h3>

<p>One new option was added to <strong>time_zone_select</strong> method, you can now present a default value in cases which your user didn't select any <strong>TimeZone</strong>, or when the database column is null. To achieve this, a <strong>:default</strong> option was created and can be used as such:</p>

<pre class="mac_classic"><span class="FunctionName">time_zone_select</span>(<span class="String"><span class="String">&quot;</span>user<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>time_zone<span class="String">&quot;</span></span>, <span class="BuiltInConstant">nil</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include_blank</span> =&gt; <span class="BuiltInConstant">true</span>)

<span class="FunctionName">time_zone_select</span>(<span class="String"><span class="String">&quot;</span>user<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>time_zone<span class="String">&quot;</span></span>, <span class="BuiltInConstant">nil</span>, 
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>default</span> =&gt; <span class="String"><span class="String">&quot;</span>Pacific Time (US &amp; Canada)<span class="String">&quot;</span></span> )

<span class="FunctionName">time_zone_select</span>( <span class="String"><span class="String">&quot;</span>user<span class="String">&quot;</span></span>, <span class="String"><span class="String">'</span>time_zone<span class="String">'</span></span>, <span class="LibraryObject">TimeZone</span>.<span class="FunctionName">us_zones</span>, 
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>default</span> =&gt; <span class="String"><span class="String">&quot;</span>Pacific Time (US &amp; Canada)<span class="String">&quot;</span></span>)
</pre>

<p>In cases where we use the <strong>:default</strong> option, it must be shown with the informed <strong>TimeZone</strong> already selected.</p>

<h3> The formatted_offset method</h3>

<p>The <strong>formatted_offset</strong> method was included in the <strong>Time</strong> and <strong>DateTime</strong> classes to return with the format <strong>+HH:MM</strong> the deviation of UTC time. For example, in our timezone (Brasilia time) the deviation value returned by the method would be a string with its value set to <strong>"-03:00″</strong>.</p>

<p>Let's see some examples:</p>

<p>Getting the deviation from a DateTime:</p>

<pre class="mac_classic">datetime <span class="Keyword">=</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">6</span>, <span class="Number">24</span>))
datetime.<span class="FunctionName">formatted_offset</span>         <span class="Comment"><span class="Comment">#</span> =&gt; &quot;-06:00″</span>
datetime.<span class="FunctionName">formatted_offset</span>(<span class="BuiltInConstant">false</span>)  <span class="Comment"><span class="Comment">#</span> =&gt; &quot;-0600″</span>
</pre>

<p>Now from Time:</p>

<pre class="mac_classic"><span class="LibraryObject">Time</span>.<span class="FunctionName">local</span>(<span class="Number">2000</span>).<span class="FunctionName">formatted_offset</span>         <span class="Comment"><span class="Comment">#</span> =&gt; &quot;-06:00″</span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">local</span>(<span class="Number">2000</span>).<span class="FunctionName">formatted_offset</span>(<span class="BuiltInConstant">false</span>)  <span class="Comment"><span class="Comment">#</span> =&gt; &quot;-0600″</span>
</pre>

<p>Note this method returns <strong>string</strong>, which can be either formatted or not depending of the value given as parameter.</p>

<h3> The with_env_tz method</h3>

<p>The <strong>with_env_tz</strong> method allows us to make tests with different timezones in a very simple way:</p>

<pre class="mac_classic"><span class="Keyword">def</span> <span class="FunctionName">test_local_offset</span>
  with_env_tz <span class="String"><span class="String">'</span>US/Eastern<span class="String">'</span></span> <span class="Keyword">do</span>
    assert_equal <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">5</span>, <span class="Number">24</span>), <span class="LibraryObject">DateTime</span>.<span class="FunctionName">local_offset</span>
  <span class="Keyword">end</span>
  with_env_tz <span class="String"><span class="String">'</span>US/Central<span class="String">'</span></span> <span class="Keyword">do</span>
    assert_equal <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">6</span>, <span class="Number">24</span>), <span class="LibraryObject">DateTime</span>.<span class="FunctionName">local_offset</span>
  <span class="Keyword">end</span>
<span class="Keyword">end</span>
</pre>

<p>This helper was supposed to call <strong>with_timezone</strong>, but it was renamed for <strong>with_env_tz</strong> to avoid confusion with the timezone informed by using <strong>ENV['TZ']</strong> and <strong>Time.zone</strong>.</p>

<h3> Time.zone_reset!</h3>

<p>Was removed for not being used anymore</p>

<h3> Time#in_current_time_zone</h3>

<p>Was modified to return <strong>self</strong> when <strong>Time.zone</strong> is null. </p>

<h3> Time#change_time_zone_to_current</h3>

<p>Was modified to return <strong>self</strong> when <strong>Time.zone</strong> is null. </p>

<h3> TimeZone#now</h3>

<p>The <strong>TimeZone#now</strong> method was modified to return an <strong>ActiveSupport::TimeWithZone</strong> representing the current time in the configured timezone as defined in <strong>Time.zone</strong>. For example:</p>

<pre class="mac_classic"><span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span> <span class="Keyword">=</span> <span class="String"><span class="String">'</span>Hawaii<span class="String">'</span></span>  <span class="Comment"><span class="Comment">#</span> =&gt; &quot;Hawaii&quot;</span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span>.<span class="FunctionName">now</span>         <span class="Comment"><span class="Comment">#</span> =&gt; Wed, 23 Jan 2008 20:24:27 HST -10:00</span>
</pre>

<h3> Compare_with_coercion</h3>

<p>The method <strong>compare_with_coercion</strong> (with an alias for &lt;=>) was created  in <strong>Time</strong> e <strong>DateTime</strong> classes, becoming possible to make a chronological comparison between the <strong>Time</strong>, <strong>DateTime</strong> classes and instances of  <strong>ActiveSupport::TimeWithZone</strong> objects. For a better understanding, take a look the examples bellow (each line result is in the comment placed following the code):</p>

<pre class="mac_classic"><span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">1999</span>, <span class="Number">12</span>, <span class="Number">31</span>, <span class="Number">23</span>, <span class="Number">59</span>, <span class="Number">59</span>, <span class="Number">999</span>) <span class="Comment"><span class="Comment">#</span> 1</span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">0</span>) <span class="Comment"><span class="Comment">#</span> 0</span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">001</span>)) <span class="Comment"><span class="Comment">#</span> -1</span>

<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">1999</span>, <span class="Number">12</span>, <span class="Number">31</span>, <span class="Number">23</span>, <span class="Number">59</span>, <span class="Number">59</span>) <span class="Comment"><span class="Comment">#</span> 1</span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">0</span>) <span class="Comment"><span class="Comment">#</span> 0</span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">1</span>)) <span class="Comment"><span class="Comment">#</span> -1</span>

<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">ActiveSupport</span>::<span class="FunctionName">TimeWithZone</span>.<span class="FunctionName">new</span>(<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">1999</span>, <span class="Number">12</span>, <span class="Number">31</span>, <span class="Number">23</span>, <span class="Number">59</span>, <span class="Number">59</span>) )
<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">ActiveSupport</span>::<span class="FunctionName">TimeWithZone</span>.<span class="FunctionName">new</span>(<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">0</span>) )
<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>) <span class="Keyword">&lt;=&gt;</span> <span class="LibraryObject">ActiveSupport</span>::<span class="FunctionName">TimeWithZone</span>.<span class="FunctionName">new</span>(<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>, <span class="Number">1</span>, <span class="Number">1</span>, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Number">1</span>) ))
</pre>

<h3> TimeWithZone#between?</h3>

<p>The <strong>between?</strong> method was included in the <strong>TimeWithZone</strong> class to verify if an instance is found between two dates. Example:</p>

<pre class="mac_classic"><span class="Variable"><span class="Variable">@</span>twz</span>.<span class="FunctionName">between?</span>(<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">1999</span>,<span class="Number">12</span>,<span class="Number">31</span>,<span class="Number">23</span>,<span class="Number">59</span>,<span class="Number">59</span>),
              <span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>,<span class="Number">1</span>,<span class="Number">1</span>,<span class="Number">0</span>,<span class="Number">0</span>,<span class="Number">1</span>))
</pre>

<h3> TimeZone#parse</h3>

<p>This method creates a new instance of <strong>ActiveSupport::TimeWithZone</strong> from a string. For example:</p>

<pre class="mac_classic"><span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>Hawaii<span class="String">&quot;</span></span>
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;Hawaii&quot;</span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span>.<span class="FunctionName">parse</span>(<span class="String"><span class="String">'</span>1999-12-31 14:00:00<span class="String">'</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 14:00:00 HST -10:00</span>


<span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span>.<span class="FunctionName">now</span>
<span class="Comment"><span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 14:00:00 HST -10:00</span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span>.<span class="FunctionName">parse</span>(<span class="String"><span class="String">'</span>22:30:00<span class="String">'</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 22:30:00 HST -10:00</span>
</pre>

<h3> TimeZone#at</h3>

<p>This method can be used to create a new instance of <strong>ActiveSupport::TimeWithZone</strong> from the number of seconds since Unix epoch. For example:</p>

<pre class="mac_classic"><span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span> <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>Hawaii<span class="String">&quot;</span></span> <span class="Comment"><span class="Comment">#</span> =&gt; &quot;Hawaii&quot;</span>
<span class="LibraryObject">Time</span>.<span class="FunctionName">utc</span>(<span class="Number">2000</span>).<span class="FunctionName">to_f</span>  <span class="Comment"><span class="Comment">#</span> =&gt; 946684800.0</span>

<span class="LibraryObject">Time</span>.<span class="FunctionName">zone</span>.<span class="FunctionName">at</span>(<span class="Number">946684800.0</span>)
<span class="Comment"><span class="Comment">#</span> =&gt; Fri, 31 Dec 1999 14:00:00 HST -10:00</span>
</pre>

<h3> More methods</h3>

<p>The <strong>to_a</strong>, <strong>to_f</strong>, <strong>to_i</strong>, <strong>httpdate</strong>, <strong>rfc2822</strong>, <strong>to_yaml</strong>, <strong>to_datetime</strong> and <strong>eql?</strong> methodos were added in the <strong>TImeWithZone</strong> class. For more information about these methodos please head to <strong>Rails</strong> documentation.</p>

<h3> TimeWithZone class preparing itself for Ruby 1.9</h3>

<p>In Ruby 1.9 we'll have some new methods in the <strong>Time</strong> class, methods such as:</p>

<pre class="mac_classic"><span class="LibraryObject">Time</span>.<span class="FunctionName">now</span>
<span class="Comment"><span class="Comment">#</span> =&gt; Thu Nov 03 18:58:25 CET 2005</span>

<span class="LibraryObject">Time</span>.<span class="FunctionName">now</span>.<span class="FunctionName">sunday?</span>
<span class="Comment"><span class="Comment">#</span> =&gt; false</span>
</pre>

<p>A respective method exists for each day of the week.</p>

<p>Another interesting things is that <strong>to_s</strong> method of <strong>Time</strong> object will have a different returning value. Today when we execute <strong>Time.new.to_s</strong>, we have the following:</p>

<pre class="mac_classic"><span class="LibraryObject">Time</span>.<span class="FunctionName">new</span>.<span class="FunctionName">to_s</span>
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;Thu Oct 12 10:39:27 +0200 2006″</span>
</pre>

<p>In Ruby 1.9 we will have:</p>

<pre class="mac_classic"><span class="LibraryObject">Time</span>.<span class="FunctionName">new</span>.<span class="FunctionName">to_s</span>
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;2006-10-12 10:39:24 +0200″</span>
</pre>

<p>What's all of that have to do with Rails 2.1? Everything. Rails is being prepared to deal with these modifications. The <strong>TimeWithZone</strong> class, for example, just received some enhancements to work with the methods of the first example.</p>

<h2> Auto Link</h2>

<p>The <strong>auto_link</strong> method receives any text given as parameter, and if the texts has some e-mail address or an website, it returns the same text, but with hyperlinks.</p>

<p>For example:</p>

<pre class="mac_classic"><span class="FunctionName">auto_link</span>(<span class="String"><span class="String">&quot;</span>Go to this website now: http://www.rubyonrails.com<span class="String">&quot;</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; Go to this website now: http://www.rubyonrails.com</span>
</pre>

<p>Some sites, like Amazon, use the "=" symbol in their URL's. This method doesn't recognize that symbol. Look how the method behaves in such case:</p>

<pre class="mac_classic"><span class="FunctionName">auto_link</span>(<span class="String"><span class="String">&quot;</span>http://www.amazon.com/Testing/ref=pd_bbs_sr_1<span class="String">&quot;</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; http://www.amazon.com/Testing/ref</span>
</pre>

<p>Note the method finished the hyperlink exactly before the "=" symbol, before Rails 2.1 that symbol was not supported. </p>

<p>The same method was updated later to also allow the use of URL's with parenthesis.</p>

<p>An URL example using parenthesis:</p>

<pre class="mac_classic">http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>en.<span class="FunctionName">wikipedia</span>.<span class="FunctionName">org</span><span class="Keyword">/</span>wiki<span class="Keyword">/</span><span class="Variable">Sprite_</span>(computer_graphics)
</pre>

<h2> Labels</h2>

<p>When creating a new form using <strong>scaffold</strong> it will be created with the following code:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="FunctionName">form_for</span>(<span class="Variable"><span class="Variable">@</span>post</span>) <span class="Keyword">do </span>|<span class="Variable">f</span>| <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;p<span class="String">&gt;</span></span>
    <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">label</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span> <span class="String"><span class="String">%&gt;</span>&lt;br /<span class="String">&gt;</span></span>
    <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">text_field</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;/p<span class="String">&gt;</span></span>
  <span class="Keyword">&lt;</span>p<span class="Keyword">&gt;</span>
    <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">label</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>body</span> <span class="String"><span class="String">%&gt;</span>&lt;br /<span class="String">&gt;</span></span>
    <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">text_area</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>body</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;/p<span class="String">&gt;</span></span>
  <span class="Keyword">&lt;</span>p<span class="Keyword">&gt;</span>
    <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">submit</span> <span class="String"><span class="String">&quot;</span>Update<span class="String">&quot;</span></span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;/p<span class="String">&gt;</span></span>
<span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="Keyword">end</span> <span class="String"><span class="String">%&gt;</span></span>
</pre>

<p>The <strong>label</strong> method was included. This method returns a <em>string</em> with the column title inside an HTML <strong>&lt;label></strong> tag.</p>

<pre class="mac_classic"><span class="Keyword">&gt;&gt;</span> f.<span class="FunctionName">label</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span>
=&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>post_title<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">Title</span><span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>

<span class="Keyword">&gt;&gt;</span> f.<span class="FunctionName">label</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span>, <span class="String"><span class="String">&quot;</span>A short title<span class="String">&quot;</span></span>
=&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>post_title<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">A</span> short title<span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>

<span class="Keyword">&gt;&gt;</span> label <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span>, <span class="String"><span class="String">&quot;</span>A short title<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class</span> =&gt; <span class="String"><span class="String">&quot;</span>title_label<span class="String">&quot;</span></span>
=&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>post_title<span class="String">&quot;</span></span> <span class="Keyword">class</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>title_label<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">A</span> short title<span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>
</pre>

<p>Did you notice the <strong>for</strong> parameter inside the tag ? "post_title" is the textbox title which contains our post title. The <strong>&lt;label></strong> tag is in fact a label associated to the <strong>post_title</strong> object. When someone clicks on the label (which isn't a link) the associated HTML controller receives focus.</p>

<p>Robby Russell wrote an interesting post in his blog about this subject. You can read it on: <a href="http://www.robbyonrails.com/articles/2007/12/02/that-checkbox-needs-a-label">http://www.robbyonrails.com/articles/2007/12/02/that-checkbox-needs-a-label</a></p>

<p>Also included was the <strong>label_tag</strong> method in <strong>FormTagHelper</strong>. This method works like label, but in a simpler way:</p>

<pre class="mac_classic"><span class="Keyword">&gt;&gt;</span> label_tag <span class="String"><span class="String">'</span>name<span class="String">'</span></span>
=&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>name<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">Name</span><span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span> 

<span class="Keyword">&gt;&gt;</span> label_tag <span class="String"><span class="String">'</span>name<span class="String">'</span></span>, <span class="String"><span class="String">'</span>Your name<span class="String">'</span></span>
=&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>name<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">Your</span> name<span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span> 

<span class="Keyword">&gt;&gt;</span> label_tag <span class="String"><span class="String">'</span>name<span class="String">'</span></span>, <span class="BuiltInConstant">nil</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class</span> =&gt; <span class="String"><span class="String">'</span>small_label<span class="String">'</span></span>
=&gt; <span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>name<span class="String">&quot;</span></span> <span class="Keyword">class</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>small_label<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">Name</span><span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>
</pre>

<p>The method also accepts the <strong>:for</strong> option, Look an example:</p>

<pre class="mac_classic"><span class="FunctionName">label</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>post</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>title</span>, <span class="BuiltInConstant">nil</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>for</span> =&gt; <span class="String"><span class="String">&quot;</span>my_for<span class="String">&quot;</span></span>)
</pre>

<p>This will return something like this:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span>label <span class="Keyword">for</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>my_for<span class="String">&quot;</span></span><span class="Keyword">&gt;</span><span class="Variable">Title</span><span class="Keyword">&lt;</span><span class="Keyword">/</span>label<span class="Keyword">&gt;</span>
</pre>

<h2> A new way of using partials</h2>

<p>Something very common in Rails software development is the use of <strong>partials</strong> to avoid code repetition. Here is a usage example:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%</span> form_for <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>user</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>url</span> =&gt; users_path <span class="Keyword">do </span><span class="String"><span class="String">%&gt;</span></span>
<span class="String">    &lt;%= render :partial =<span class="String">&gt;</span></span> <span class="String"><span class="String">'</span>form<span class="String">'</span></span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">    &lt;%= submit_tag 'Create' %<span class="String">&gt;</span></span>
<span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="Keyword">end</span> <span class="String"><span class="String">%&gt;</span></span>
</pre>

<p><strong>Partial</strong> is a code fragment (a template). The advantage of using a <strong>partial</strong> is to avoid unnecessary code repetition. Using a <strong>partial</strong> is very simple, you can start with something like this: <strong>render :partial => "name"</strong>. You must create a file with the same name of your <strong>partial</strong>, but using an underscore in front of it.</p>

<p>The code above shows ho we are used to do it, in Rails 2.1 you'll do the same thing in a slightly different way:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="FunctionName">form_for</span>(<span class="Variable"><span class="Variable">@</span>user</span>) <span class="Keyword">do </span>|<span class="Variable">f</span>| <span class="String"><span class="String">%&gt;</span></span>
<span class="String">    &lt;%= render :partial =<span class="String">&gt;</span></span> f <span class="String"><span class="String">%&gt;</span></span>
<span class="String">    &lt;%= submit_tag 'Create' %<span class="String">&gt;</span></span>
<span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="Keyword">end</span> <span class="String"><span class="String">%&gt;</span></span>
</pre>

<p>In this example we render the partial "users/_form", which will receive a variable called "form" with the references created by the <strong>FormBuilder</strong>.</p>

<p>The old way will continue to work in Rails 2.1.</p>

<h2> New namespaces in Atom Feed</h2>

<p>Do you know the <strong>atom_feed</strong> method? It is one of the new features of Rails 2.0, making easier the creation of Atom feeds. See an example of use:</p>

<p>In a <em>index.atom.builder</em> file:</p>

<pre class="mac_classic">atom_feed <span class="Keyword">do </span>|<span class="Variable">feed</span>|
  feed.<span class="FunctionName">title</span>(<span class="String"><span class="String">&quot;</span>Nome do Jogo<span class="String">&quot;</span></span>)
  feed.<span class="FunctionName">updated</span>((<span class="Variable"><span class="Variable">@</span>posts</span>.<span class="FunctionName">first</span>.<span class="FunctionName">created_at</span>))

  <span class="Keyword">for</span> post <span class="Keyword">in</span> <span class="Variable"><span class="Variable">@</span>posts</span>
    feed.<span class="FunctionName">entry</span>(post) <span class="Keyword">do </span>|<span class="Variable">entry</span>|
      entry.<span class="FunctionName">title</span>(post.<span class="FunctionName">title</span>)
      entry.<span class="FunctionName">content</span>(post.<span class="FunctionName">body</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>type</span> =&gt; <span class="String"><span class="String">'</span>html<span class="String">'</span></span>)

      entry.<span class="FunctionName">author</span> <span class="Keyword">do </span>|<span class="Variable">author</span>|
        author.<span class="FunctionName">name</span>(<span class="String"><span class="String">&quot;</span>Carlos Brando<span class="String">&quot;</span></span>)
      <span class="Keyword">end</span>
    <span class="Keyword">end</span>
  <span class="Keyword">end</span>
<span class="Keyword">end</span>
</pre>

<p>What is an Atom feed ? Atom is the name of XML based style and meta data. In other words is a protocol to publish content in Internet that is often updated, like a blog, for example. Feeds are always published in XML and in Atom it is identified as an application/atom+xml media type.</p>

<p>In the first versions of Rails 2.0 this method used to accept as parameter <strong>:language</strong>, <strong>:root_url</strong> and <strong>:url</strong> options, you can obtain more information about these methods in Rails Documentation. But with the update made, we can now include new namespaces in the root element of the feed. For example:</p>

<pre class="mac_classic"><span class="FunctionName">atom_feed</span>(<span class="String"><span class="String">'</span>xmlns:app<span class="String">'</span></span> =&gt; <span class="String"><span class="String">'</span>http://www.w3.org/2007/app<span class="String">'</span></span>) <span class="Keyword">do </span>|<span class="Variable">feed</span>|
</pre>

<p>Will return:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span>feed xml<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lang=</span><span class="String"><span class="String">&quot;</span>en-US<span class="String">&quot;</span></span> xmlns<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>http://www.w3.org/2005/Atom<span class="String">&quot;</span></span>
    xmlns<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>app=</span><span class="String"><span class="String">&quot;</span>http://www.w3.org/2007/app<span class="String">&quot;</span></span><span class="Keyword">&gt;</span>
</pre>

<p>Modifying the example used before, we could use this way:</p>

<pre class="mac_classic"><span class="FunctionName">atom_feed</span>({<span class="String"><span class="String">'</span>xmlns:app<span class="String">'</span></span> =&gt; <span class="String"><span class="String">'</span>http://www.w3.org/2007/app<span class="String">'</span></span>,
    <span class="String"><span class="String">'</span>xmlns:openSearch<span class="String">'</span></span> =&gt; <span class="String"><span class="String">'</span>http://a9.com/-/spec/opensearch/1.1/<span class="String">'</span></span>}) <span class="Keyword">do </span>|<span class="Variable">feed</span>| 

  feed.<span class="FunctionName">title</span>(<span class="String"><span class="String">&quot;</span>Nome do Jogo<span class="String">&quot;</span></span>)
  feed.<span class="FunctionName">updated</span>((<span class="Variable"><span class="Variable">@</span>posts</span>.<span class="FunctionName">first</span>.<span class="FunctionName">created_at</span>))
  feed.<span class="FunctionName">tag!</span>(openSearch<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>totalResults</span>, <span class="Number">10</span>) 

  <span class="Keyword">for</span> post <span class="Keyword">in</span> <span class="Variable"><span class="Variable">@</span>posts</span>
    feed.<span class="FunctionName">entry</span>(post) <span class="Keyword">do </span>|<span class="Variable">entry</span>|
      entry.<span class="FunctionName">title</span>(post.<span class="FunctionName">title</span>)
      entry.<span class="FunctionName">content</span>(post.<span class="FunctionName">body</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>type</span> =&gt; <span class="String"><span class="String">'</span>html<span class="String">'</span></span>)
      entry.<span class="FunctionName">tag!</span>(<span class="String"><span class="String">'</span>app:edited<span class="String">'</span></span>, <span class="LibraryObject">Time</span>.<span class="FunctionName">now</span>) 

      entry.<span class="FunctionName">author</span> <span class="Keyword">do </span>|<span class="Variable">author</span>|
        author.<span class="FunctionName">name</span>(<span class="String"><span class="String">&quot;</span>Carlos Brando<span class="String">&quot;</span></span>)
      <span class="Keyword">end</span>
    <span class="Keyword">end</span>
  <span class="Keyword">end</span>
<span class="Keyword">end</span>
</pre>

<h2> Cache</h2>

<p>All <strong>fragment_cache_key</strong> methods now return by default the namespace 'view/' as prefix.</p>

<p>All caching stores were removed from <strong>ActionController::Caching::Fragments::</strong><em> and now they can be found in <strong>ActiveSupport::Cache::</strong></em>. In this case, if you made a reference to a store, like <strong>ActionController::Caching::Fragments::MemoryStore</strong>, for example, you'll have to change its reference to <strong>ActiveSupport::Cache::MemoryStore</strong>.</p>

<p><strong>ActionController::Base.fragment_cache_store</strong> is no more and <strong>ActionController::Base.cache_store</strong> takes its place.</p>

<p>It was included in the <strong>ActiveRecord::Base</strong> the <strong>cache_key</strong> method to facilitate the storing cache of Active Records by the new libraries <strong>ActiveSupport::Cache::</strong>*. It works this way:</p>

<pre class="mac_classic"><span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Product</span>.<span class="FunctionName">new</span>.<span class="FunctionName">cache_key</span>
=&gt; <span class="String"><span class="String">&quot;</span>products/new<span class="String">&quot;</span></span>

<span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Product</span>.<span class="FunctionName">find</span>(<span class="Number">5</span>).<span class="FunctionName">cache_key</span>
=&gt; <span class="String"><span class="String">&quot;</span>products/5<span class="String">&quot;</span></span>

<span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">Person</span>.<span class="FunctionName">find</span>(<span class="Number">5</span>).<span class="FunctionName">cache_key</span>
=&gt; <span class="String"><span class="String">&quot;</span>people/5-20071224150000<span class="String">&quot;</span></span>
</pre>

<p><strong>ActiveSupport::Gzip.decompress/compress</strong>  was included to make easier the use as a wrapper for <strong>Zlib</strong>.</p>

<p>Now you can use among environment options the <strong>config.cache_store</strong> to specify the default place of caching store. It is worth mentioning, if the <strong>tmp/cache</strong> directory exists, the default is <strong>FileStore</strong>, in other case the <strong>MemoryStore</strong> will be used. You can configure in the following ways:</p>

<pre class="mac_classic">config.<span class="FunctionName">cache_store</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>memory_store</span>
config.<span class="FunctionName">cache_store</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>file_store</span>, <span class="String"><span class="String">&quot;</span>/path/to/cache/directory<span class="String">&quot;</span></span>
config.<span class="FunctionName">cache_store</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>drb_store</span>, <span class="String"><span class="String">&quot;</span>druby://localhost:9192<span class="String">&quot;</span></span>
config.<span class="FunctionName">cache_store</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>mem_cache_store</span>, <span class="String"><span class="String">&quot;</span>localhost<span class="String">&quot;</span></span>
config.<span class="FunctionName">cache_store</span> <span class="Keyword">=</span> <span class="LibraryObject">MyOwnStore</span>.<span class="FunctionName">new</span>(<span class="String"><span class="String">&quot;</span>parameter<span class="String">&quot;</span></span>)
</pre>

<p>To make things even easier, the comment bellow is included in <em>environments/production.rb</em> file, in order to remind you of this option.</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> Use a different cache store in production</span>
<span class="Comment"><span class="Comment">#</span> config.cache_store = :mem_cache_store</span>
</pre>

<h2> Applying title formatting in strings</h2>

<p>There was a bug when using <strong>String#titleize</strong> method in a string containing 's . The bug made the method return the 's in uppercase. See an example:</p>

<pre class="mac_classic"><span class="Keyword">&gt;&gt;</span> <span class="String"><span class="String">&quot;</span>brando’s blog<span class="String">&quot;</span></span>.<span class="FunctionName">titleize</span>
=&gt; <span class="String"><span class="String">&quot;</span>Brando’S Blog<span class="String">&quot;</span></span>
</pre>

<p>See the same example, but with the bug fixed:</p>

<pre class="mac_classic"><span class="Keyword">&gt;&gt;</span> <span class="String"><span class="String">&quot;</span>brando’s blog<span class="String">&quot;</span></span>.<span class="FunctionName">titleize</span>
=&gt; <span class="String"><span class="String">&quot;</span>Brando’s Blog<span class="String">&quot;</span></span>
</pre>

<h2> action_name</h2>

<p>In order to find out which view was called during running time of your view, we can use the <strong>action_name</strong> method:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%=</span> action_name <span class="String"><span class="String">%&gt;</span></span>
</pre>

<p>The return value will be the same as using <strong>params[:action]</strong>, but in a more elegant way.</p>

<h2> caches_action accepts conditionals</h2>

<p>The <strong>caches_action</strong> method now accepts the <strong>:if</strong> option, allowing the use of conditionals to specify when an <strong>action</strong> can be <strong>cached</strong>. For example:</p>

<pre class="mac_classic">caches_action <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>if</span> =&gt; <span class="LibraryObject">Proc</span>.<span class="FunctionName">new</span> { |<span class="Variable">c</span>| <span class="Keyword">!</span>c.<span class="FunctionName">request</span>.<span class="FunctionName">format</span>.<span class="FunctionName">json?</span> }
</pre>

<p>In the example above, the <strong>action index</strong> will go to the <strong>cache</strong> only if it's not accessed by a JSON request.</p>

<h2> Conditional in the caches_page method</h2>

<p>The <strong>caches_page</strong> method now has the option to use conditionals (<strong>:if</strong>). See example:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> The Rails 2.0 way</span>
caches_page <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span>

<span class="Comment"><span class="Comment">#</span> In Rails 2.1 you can use :if option</span>
caches_page <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>if</span> =&gt; <span class="LibraryObject">Proc</span>.<span class="FunctionName">new</span> { |<span class="Variable">c</span>| <span class="Keyword">!</span>c.<span class="FunctionName">request</span>.<span class="FunctionName">format</span>.<span class="FunctionName">json?</span> }
</pre>

<h2> flash.now now works in tests</h2>

<p>Who didn't have headaches because of this ? The problem was that during tests we could never confirm if a message was stored in flash, because it was cleared by Rails before going to your test script.</p>

<p>In rails 2.1 the problem was solved. Now you can include the following line in your tests:</p>

<pre class="mac_classic">assert_equal <span class="String"><span class="String">'</span>&gt;value_now&lt;<span class="String">'</span></span>, flash[<span class="String"><span class="String">'</span>test_now<span class="String">'</span></span>]
</pre>

<h2> Accessing Helpers outside Views</h2>

<p>How often have you created a <strong>helper</strong> and wished you could use it inside your <strong>controller</strong> ? To achieve this functionality you had to included the <strong>helper</strong> module inside the <strong>controller</strong>, which made your code look ugly.</p>

<p>In Rails 2.1 a proxy to access helpers outside views was developed. It works in a very simple way:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> To access simple_format method, for example</span>
<span class="LibraryObject">ApplicationController</span>.<span class="FunctionName">helpers</span>.<span class="FunctionName">simple_format</span>(text)
</pre>

<p>Simple and Clean!</p>

<h2> JSON</h2>

<p>Rails now accepts POST's requests of JSON content. For example, you can send a POST request this way:</p>

<pre class="mac_classic"><span class="Variable">POST</span> <span class="Keyword">/</span>posts
{<span class="String"><span class="String">&quot;</span>post<span class="String">&quot;</span></span>: {<span class="String"><span class="String">&quot;</span>title<span class="String">&quot;</span></span>: <span class="String"><span class="String">&quot;</span>Breaking News<span class="String">&quot;</span></span>}}
</pre>

<p>And everything goes to variable <strong>params</strong>. This works for example:</p>

<pre class="mac_classic"><span class="Keyword">def</span> <span class="FunctionName">create</span>
  <span class="Variable"><span class="Variable">@</span>post</span> <span class="Keyword">=</span> <span class="LibraryObject">Post</span>.<span class="FunctionName">create</span> params[<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>post</span>]
<span class="Comment">  <span class="Comment">#</span> …</span>
<span class="Keyword">end</span>
</pre>

<p>Some of you many not know JSON is a "competitor" for XML, and it is widely used for JavaScript data interchange because it's represented in this language. It takes its name from: <strong>JavaScript Object Notation</strong>.</p>

<h2> Path Names</h2>

<p>My blog readers (http://www.nomedojogo.com) should know about my <strong>Custom Resource Name</strong> plugin. I think it'll die very soon... :(</p>

<p>In rails you could already include the option <strong>:as</strong> in your routes (something I implemented in my plugin to keep compatibility). Now you will also have the <strong>:path_names</strong> option to change the name of your <strong>actions</strong>.</p>

<pre class="mac_classic">map.<span class="FunctionName">resource</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>schools</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>as</span> =&gt; <span class="String"><span class="String">'</span>escolas<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>path_names</span> =&gt; { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>new</span> =&gt; <span class="String"><span class="String">'</span>nova<span class="String">'</span></span> }
</pre>

<p>Of course, my plugin will remain being useful for users of earlier Rails versions.</p>

<h2> Defining the location of your routes file</h2>

<p>In Rails 2.1 you can define in which file your routes are stored, including the following line in your <em>enviroment.rb</em>:</p>

<pre class="mac_classic">config.<span class="FunctionName">routes_configuration_file</span>
</pre>

<p>This can be useful in a scenario where you have two separated front-ends that share the same modules, libraries and plugins.</p>

<p>For example, getsatisfaction.com and api.getsatisfaction.com share the same models, but not the controllers, helpers and views. getsatisfaction has its own routes file with optimizations to improve its SEO, while the API route's file doesn't know anything about SEO improvements.</p>

<h2> session(:on)</h2>

<p>Did you know it is possible to turn off sessions in rails? Here is how to do it:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">ApplicationController<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActionController::Base</span></span>
  session <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>off</span>
<span class="Keyword">end</span>
</pre>

<p>Note that in my example I'm turning off sessions for all controllers (<strong>ApplicationController</strong>), but I could also do it for a single controller.</p>

<p>If you want to have sessions on for a given controller in Rails 2.1 you can use the session method method passing the <strong>:on</strong> parameter:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">UsersController<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ApplicationController</span></span>
  session <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>on</span>
<span class="Keyword">end</span>
</pre>

<h2> Testing Helpers in a simple way</h2>

<p>One very boring thing to do in earlier versions of Rails is testing the <strong>helpers</strong>. I already suffered a lot to ensure 100% of coverage, creating tests for some <strong>helpers</strong>.</p>

<p>This became much simpler in Rails 2.1 with the <strong>ActionView::TestCase</strong> class. Look the example:</p>

<pre class="mac_classic"><span class="Keyword">module</span> <span class="TypeName">PeopleHelper</span>
  <span class="Keyword">def</span> <span class="FunctionName">title</span>(<span class="FunctionParameter">text</span>)
    <span class="FunctionName">content_tag</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>h1</span>, text)
  <span class="Keyword">end</span>

  <span class="Keyword">def</span> <span class="FunctionName">homepage_path</span>
    people_path
  <span class="Keyword">end</span>
<span class="Keyword">end</span>
</pre>

<p>Now look how we can do the same in Rails 2.1:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">PeopleHelperTest<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActionView::TestCase</span></span>
  <span class="Keyword">def</span> <span class="FunctionName">setup</span>
    <span class="LibraryObject">ActionController</span>::<span class="FunctionName">Routing</span>::<span class="FunctionName">Routes</span>.<span class="FunctionName">draw</span> <span class="Keyword">do </span>|<span class="Variable">map</span>|
      map.<span class="FunctionName">people</span> <span class="String"><span class="String">'</span>people<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>controller</span> =&gt; <span class="String"><span class="String">'</span>people<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>action</span> =&gt; <span class="String"><span class="String">'</span>index<span class="String">'</span></span>
      map.<span class="FunctionName">connect</span> <span class="String"><span class="String">'</span>:controller/:action/:id<span class="String">'</span></span>
    <span class="Keyword">end</span>
  <span class="Keyword">end</span>

  <span class="Keyword">def</span> <span class="FunctionName">test_title</span>
    assert_equal <span class="String"><span class="String">&quot;</span>&lt;h1&gt;Ruby on Rails&lt;/h1&gt;<span class="String">&quot;</span></span>, <span class="FunctionName">title</span>(<span class="String"><span class="String">&quot;</span>Ruby on Rails<span class="String">&quot;</span></span>)
  <span class="Keyword">end</span>

  <span class="Keyword">def</span> <span class="FunctionName">test_homepage_path</span>
    assert_equal <span class="String"><span class="String">&quot;</span>/people<span class="String">&quot;</span></span>, homepage_path
  <span class="Keyword">end</span>
<span class="Keyword">end</span>
</pre>

<h1> ActionController</h1>

<p>ActionController is the layer responsible by receiving web requests and taking decisions of what is going to be run and rendered or to redirect the request to another action.
An Action is defined as public methods within controllers which are automatically available through routes.</p>

<h2> ActionController::Routing</h2>

<h3> Map.root</h3>

<p>Now, when using <strong>map.root</strong> you can be much more <strong>DRY</strong> using an alias for that.</p>

<p>In the earlier versions of rails you used to do it like this:</p>

<pre class="mac_classic">map.<span class="FunctionName">new_session</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>controller</span> =&gt; <span class="String"><span class="String">'</span>sessions<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>action</span> =&gt; <span class="String"><span class="String">'</span>new<span class="String">'</span></span>
map.<span class="FunctionName">root</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>controller</span> =&gt; <span class="String"><span class="String">'</span>sessions<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>action</span> =&gt; <span class="String"><span class="String">'</span>new<span class="String">'</span></span>
</pre>

<p>Now you can do it this way:</p>

<pre class="mac_classic">map.<span class="FunctionName">new_session</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>controller</span> =&gt; <span class="String"><span class="String">'</span>sessions<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>action</span> =&gt; <span class="String"><span class="String">'</span>new<span class="String">'</span></span>
map.<span class="FunctionName">root</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>new_session</span>
</pre>

<h3> Routes recognition </h3>

<p>Routes recognition's old implementation used to sweep all routes, one by one, and often turned to be very time consuming. A new and smarter implementation was developed. It creates a tree for routes and the route recognition is made by prefixing, skipping similar routes. This approach lowers recognition time in approximately 2.7 times. </p>

<p>All the new implementations are in the file <strong>recognition_optimisation.rb</strong> and its working details are well explained in the comments. See the the documentation inside the source code itself for more information about its implementation.</p>

<h3> Assert_routing</h3>

<p>Now it's possible to test a route with an HTTP method. Look at the following example:</p>

<pre class="mac_classic"><span class="FunctionName">assert_routing</span>({ <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>method</span> =&gt; <span class="String"><span class="String">'</span>put<span class="String">'</span></span>,
                 <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>path</span> =&gt; <span class="String"><span class="String">'</span>/product/321<span class="String">'</span></span> },
               { <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>controller</span> =&gt; <span class="String"><span class="String">&quot;</span>product<span class="String">&quot;</span></span>,
                 <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>action</span> =&gt; <span class="String"><span class="String">&quot;</span>update<span class="String">&quot;</span></span>,
                 <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>id</span> =&gt; <span class="String"><span class="String">&quot;</span>321<span class="String">&quot;</span></span> })
</pre>

<h3> Map.resources</h3>

<p>Imagine you have a site written in a language other than english, and you want to taylor your routes to use the same language. In other words, instead of having:</p>

<pre class="mac_classic">http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>www.<span class="FunctionName">mysite</span>.<span class="FunctionName">com</span>.<span class="FunctionName">br</span><span class="Keyword">/</span>products<span class="Keyword">/</span><span class="Number">1234</span><span class="Keyword">/</span>reviews
</pre>

<p>You wished to have something like this:</p>

<pre class="mac_classic">http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>www.<span class="FunctionName">mysite</span>.<span class="FunctionName">com</span>.<span class="FunctionName">br</span><span class="Keyword">/</span>produtos<span class="Keyword">/</span><span class="Number">1234</span><span class="Keyword">/</span>comentarios
</pre>

<p>This was already possible, but not in a simple way and without compromising some rails conventions.</p>

<p>Now we have the option <strong>:as</strong> within <strong>map.resources</strong> to personalize our routes. Look our example to get the URL above in portuguese:</p>

<pre class="mac_classic">map.<span class="FunctionName">resources</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>products</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>as</span> =&gt; <span class="String"><span class="String">'</span>produtos<span class="String">'</span></span> <span class="Keyword">do </span>|<span class="Variable">product</span>|
<span class="Comment">  <span class="Comment">#</span> product_reviews_path(product) ==</span>
<span class="Comment">  <span class="Comment">#</span> '/produtos/1234/comentarios’</span>
  product.<span class="FunctionName">resources</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>product_reviews</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>as</span> =&gt; <span class="String"><span class="String">'</span>comentarios<span class="String">'</span></span>
<span class="Keyword">end</span>
</pre>

<h2> ActionController::Caching::Sweeping</h2>

<p>In the earlier versions of rails, when we declared a <strong>sweeper</strong>, we had to inform the class using symbols:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">ListsController<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ApplicationController</span></span>
  caches_action <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>show</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>public</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>feed</span>
  cache_sweeper <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>list_sweeper</span>,
                <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>only</span> =&gt; [ <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>edit</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>destroy</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>share</span> ]
<span class="Keyword">end</span>
</pre>

<p>Now it's possible to explicitly declare a class instead of using a symbol. This is necessary if your <strong>sweeper</strong> is inside a module. Though you can still use symbols for other cases from now on you can also do it this way:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">ListsController<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ApplicationController</span></span>
  caches_action <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>show</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>public</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>feed</span>
  cache_sweeper <span class="LibraryObject">OpenBar</span>::<span class="FunctionName">Sweeper</span>,
                <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>only</span> =&gt; [ <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>edit</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>destroy</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>share</span> ]
<span class="Keyword">end</span>
</pre>

<h1>ActionView</h1>

<p>ActionView is the layer responsible by the generation of the viewable interface visible to users through conversion of ERB templates.</p>

<h2> ActionView::Helpers::FormHelper</h2>

<h3> fields_for form_for with index option.</h3>

<p>The <strong>#fields_for</strong> and <strong>form_for</strong> methods received the <strong>:index</strong> option, removing the need of using <strong>:index => nil</strong> on each form object. Look the examples:</p>

<p>This is the way code used to be:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%</span> fields_for <span class="String"><span class="String">&quot;</span>project[task_attributes][]<span class="String">&quot;</span></span>, task <span class="Keyword">do </span>|<span class="Variable">f</span>| <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;%= f.text_field :name, :index =<span class="String">&gt;</span></span> <span class="BuiltInConstant">nil</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;%= f.hidden_field :id, :index =<span class="String">&gt;</span></span> <span class="BuiltInConstant">nil</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;%= f.hidden_field :should_destroy, :index =<span class="String">&gt;</span></span> <span class="BuiltInConstant">nil</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">&lt;% end %<span class="String">&gt;</span></span>
</pre>

<p>Now it looks like this:</p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%</span> fields_for <span class="String"><span class="String">&quot;</span>project[task_attributes][]<span class="String">&quot;</span></span>, task,
              <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>index</span> =&gt; <span class="BuiltInConstant">nil</span> <span class="Keyword">do </span>|<span class="Variable">f</span>| <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;%= f.text_field :name %<span class="String">&gt;</span></span>
  <span class="Keyword">&lt;</span><span class="Keyword">%=</span> f.<span class="FunctionName">hidden_field</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>id</span> <span class="String"><span class="String">%&gt;</span></span>
<span class="String">  &lt;%= f.hidden_field :should_destroy %<span class="String">&gt;</span></span>
<span class="Keyword">&lt;</span><span class="Keyword">%</span> <span class="Keyword">end</span> <span class="String"><span class="String">%&gt;</span></span>
</pre>

<h2> ActionView::Helpers::DateHelper</h2>

<p>Now, all these module methods dealing with dates  (<strong>date_select</strong>, <strong>time_select</strong>, <strong>select_datetime</strong>, etc.) are accepting <strong>HTML</strong> options. Look an example using <strong>date_select</strong></p>

<pre class="mac_classic"><span class="Keyword">&lt;</span><span class="Keyword">%=</span> date_select <span class="String"><span class="String">'</span>item<span class="String">'</span></span>,<span class="String"><span class="String">'</span>happening<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>order</span> =&gt; [<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>day</span>], <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class</span> =&gt; <span class="String"><span class="String">'</span>foobar<span class="String">'</span></span><span class="String"><span class="String">%&gt;</span></span>
</pre>

<h3> date_helper</h3>

<p>The <strong>date_helper</strong> method was updated to use <strong>Date.current</strong> in order to define its default value.</p>

<h2> ActionView::Helpers::AssetTagHelper</h2>

<h3> register_javascript_expansion</h3>

<p>This method registers one or more javascript files to be included when a symbol, defined by the programmer, is given as a parameter to the <strong>javascript_include_tag</strong> method. The idea is to call this method inside the <strong>init.rb</strong> of your plugin, in order to register the javascript files which your plugin places in the folder <strong>public/javascripts</strong>. Let's see how it works:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> In the init.rb file</span>
<span class="LibraryObject">ActionView</span>::<span class="FunctionName">Helpers</span>::<span class="FunctionName">AssetTagHelper</span>.<span class="FunctionName">register_javascript_expansion</span> 
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>monkey</span> =&gt; [<span class="String"><span class="String">&quot;</span>head<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>body<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>tail<span class="String">&quot;</span></span>] 

<span class="Comment"><span class="Comment">#</span> In our view:</span>
javascript_include_tag <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>monkey</span>

<span class="Comment"><span class="Comment">#</span> We are going to have:</span>
<span class="Keyword">&lt;</span>script type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span> src<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/javascripts/head.js<span class="String">&quot;</span></span>&gt;<span class="Keyword">&lt;</span><span class="Keyword">/</span>script<span class="Keyword">&gt;</span>
<span class="Keyword">&lt;</span>script type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span> src<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/javascripts/body.js<span class="String">&quot;</span></span>&gt;<span class="Keyword">&lt;</span><span class="Keyword">/</span>script<span class="Keyword">&gt;</span>
<span class="Keyword">&lt;</span>script type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span> src<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/javascripts/tail.js<span class="String">&quot;</span></span>&gt;<span class="Keyword">&lt;</span><span class="Keyword">/</span>script<span class="Keyword">&gt;</span>
</pre>

<h3> register_stylesheet_expansion</h3>

<p>This method does exactly the same as the <strong>ActionView::Helpers::AssetTagHelper#register_javascript_expansion</strong> method, but it creates a symbol to be used later when making calls to <strong>stylesheet_link_tag</strong> method. Look an example:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> In the init.rb file</span>
<span class="LibraryObject">ActionView</span>::<span class="FunctionName">Helpers</span>::<span class="FunctionName">AssetTagHelper</span>.<span class="FunctionName">register_stylesheet_expansion</span> 
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>monkey</span> =&gt; [<span class="String"><span class="String">&quot;</span>head<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>body<span class="String">&quot;</span></span>, <span class="String"><span class="String">&quot;</span>tail<span class="String">&quot;</span></span>] 

<span class="Comment"><span class="Comment">#</span> In our view:</span>
stylesheet_link_tag <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>monkey</span>

<span class="Comment"><span class="Comment">#</span> We are going to have:</span>
<span class="Keyword">&lt;</span>link href<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/stylesheets/head.css<span class="String">&quot;</span></span>  media<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>screen<span class="String">&quot;</span></span> rel<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>stylesheet<span class="String">&quot;</span></span> 
    type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/css<span class="String">&quot;</span></span> <span class="Keyword">/</span><span class="Keyword">&gt;</span>
<span class="Keyword">&lt;</span>link href<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/stylesheets/body.css<span class="String">&quot;</span></span>  media<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>screen<span class="String">&quot;</span></span> rel<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>stylesheet<span class="String">&quot;</span></span> 
    type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/css<span class="String">&quot;</span></span> <span class="Keyword">/</span><span class="Keyword">&gt;</span>
<span class="Keyword">&lt;</span>link href<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>/stylesheets/tail.css<span class="String">&quot;</span></span>  media<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>screen<span class="String">&quot;</span></span> rel<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>stylesheet<span class="String">&quot;</span></span> 
    type<span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>text/css<span class="String">&quot;</span></span> <span class="Keyword">/</span><span class="Keyword">&gt;</span>
</pre>

<h2> ActionView::Helpers::FormTagHelper</h2>

<h3> submit_tag</h3>

<p>It was added the <strong>:confirm</strong> option in the parameters of <strong>#submit_tag</strong> method. This option works the same way like the method <strong>link_to</strong>. Look an example:</p>

<pre class="mac_classic"><span class="FunctionName">submit_tag</span>(<span class="String"><span class="String">'</span>Save changes<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>confirm</span> =&gt; <span class="String"><span class="String">&quot;</span>Are you sure?<span class="String">&quot;</span></span>)
</pre>

<h2> ActionView::Helpers::NumberHelper</h2>

<h3> number_to_currency</h3>

<p>The <strong>number_to_currency</strong> method now accepts the <strong>:format</strong> option as a parameter,letting us to format the method's returning value. In earlier versions, when we had to format values for our local currency, we needed to include a space in front of <strong>:unit</strong> option to make the output format correct. See the examples:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> R$ is the symbol for Brazilian currency</span>
<span class="FunctionName">number_to_currency</span>(<span class="Number">9.99</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>separator</span> =&gt; <span class="String"><span class="String">&quot;</span>,<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>delimiter</span> =&gt; <span class="String"><span class="String">&quot;</span>.<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unit</span> =&gt; <span class="String"><span class="String">&quot;</span>R$<span class="String">&quot;</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;R$9,99″</span>

<span class="FunctionName">number_to_currency</span>(<span class="Number">9.99</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>format</span> =&gt; <span class="String"><span class="String">&quot;</span>%u %n<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>separator</span> =&gt; <span class="String"><span class="String">&quot;</span>,<span class="String">&quot;</span></span>, 
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>delimiter</span> =&gt; <span class="String"><span class="String">&quot;</span>.<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unit</span> =&gt; <span class="String"><span class="String">&quot;</span>R$<span class="String">&quot;</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;R$ 9,99″</span>
</pre>

<p>Besides that, we can customize in other forms, for example:</p>

<pre class="mac_classic"><span class="FunctionName">number_to_currency</span>(<span class="Number">9.99</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>format</span> =&gt; <span class="String"><span class="String">&quot;</span>%n in Brazilian reais<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>separator</span> =&gt; <span class="String"><span class="String">&quot;</span>,<span class="String">&quot;</span></span>,
    <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>delimiter</span> =&gt; <span class="String"><span class="String">&quot;</span>.<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unit</span> =&gt; <span class="String"><span class="String">&quot;</span>R$<span class="String">&quot;</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;9,99 em reais&quot;</span>
</pre>

<p>When creating your own formatting string, you can use the following parameters:</p>

<pre class="mac_classic"><span class="Keyword">%</span>u <span class="Variable">For</span> the currency
<span class="Keyword">%</span>n <span class="Variable">For</span> the number
</pre>

<h2> ActionView::Helpers::TextHelper</h2>

<h3> excerpt</h3>

<p>The <strong>excerpt</strong> method is a helper to find a word inside a phrase and return an abreviation of that phrase with the number of given characters as parameters before and after the word, adding, when necessary the "…". Look an example:</p>

<pre class="mac_classic"><span class="FunctionName">excerpt</span>(<span class="String"><span class="String">'</span>This is an example<span class="String">'</span></span>, <span class="String"><span class="String">'</span>an<span class="String">'</span></span>, <span class="Number">5</span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;…s is an examp…&quot;</span>
</pre>

<p>But the problem it was bugged. If you count, you'll see the method returned 6 chars and not 5. This bug was fixed. Look the example of the correct output for this method:</p>

<pre class="mac_classic"><span class="FunctionName">excerpt</span>(<span class="String"><span class="String">'</span>This is an example<span class="String">'</span></span>, <span class="String"><span class="String">'</span>an<span class="String">'</span></span>, <span class="Number">5</span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;…s is an exam…&quot;</span>
</pre>

<h3>simple_format</h3>

<p>The <strong>simple_format</strong> method basically receives as a parameter any text and formats it in a simple way to <strong>HTML</strong>. It takes the text and replaces line breaks (\n) by <strong>HTML</strong> tag "&lt; br />". And when we have two line breaks one after other  (\n\n)  it separates the text in paragraphs using "&lt; p>"tag.</p>

<p>In Rails 2.1 this method received an additional parameter. Besides text, we are going to be able to inform which <strong>HTML</strong> attributes we would like "&lt; p>" tag had. Look the examples:</p>

<pre class="mac_classic"><span class="FunctionName">simple_format</span>(<span class="String"><span class="String">&quot;</span>Hello Mom!<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>class</span> =&gt; <span class="String"><span class="String">'</span>description<span class="String">'</span></span>)
<span class="Comment"><span class="Comment">#</span> =&gt; &quot;&lt;p class=’description’&gt;Hello Mom!&lt;/p&gt;&quot;</span>
</pre>

<p>The <strong>HTML</strong> attributes will be added in all "&lt; p>" tags created by the method.</p>

<h1> Railties</h1>

<h2> config.gem</h2>

<p>Now it's possible to configure all necessary gems to get a project running by using a new feature called <strong>config.gem</strong>. In  <strong>environment.rb</strong> file you can specify which gems your project depends to run. Look at the example:</p>

<pre class="mac_classic">config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>bj<span class="String">&quot;</span></span>

config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>hpricot<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">'</span>0.6<span class="String">'</span></span>,
                      <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source</span> =&gt; <span class="String"><span class="String">&quot;</span>http://code.whytheluckystiff.net<span class="String">&quot;</span></span> 

config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>aws-s3<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>aws/s3<span class="String">&quot;</span></span>
</pre>

<p>To install all dependencies at once, we just use a Rake task:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> Installs all specified gems</span>
rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>install</span>
</pre>

<p>It's also possible to list which gems are being used in the running project by using:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> Listing all gem dependencies</span>
rake gems
</pre>

<p>If one of the gems have a <strong>rails/init.rb</strong> file and you want to take the gem with your application, you can use:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> Copy the specified gem to vendor/gems/nome_do_gem-x.x.x</span>
rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unpack</span> <span class="Variable">GEM</span><span class="Keyword">=</span>gem_name
</pre>

<p>Then, the gem will be copied to the directory  <strong>vendor/gems/gem_name-x.x.x</strong>. In case you don't specify gem name, Rails will copy all gems to the directory <strong>vendor/gem</strong></p>

<h2> config.gem in plugins</h2>

<p>The <strong>config.gem</strong> feature is also available for use with plugins.</p>

<p>Untill Rails 2.0 the <strong>init.rb</strong> file of a plugin used to look like this:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> init.rb of plugin open_id_authentication</span>
<span class="Keyword">require</span> <span class="String"><span class="String">'</span>yadis<span class="String">'</span></span> 
<span class="Keyword">require</span> <span class="String"><span class="String">'</span>openid<span class="String">'</span></span> 
<span class="LibraryObject">ActionController</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">send</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include</span>, <span class="Variable">OpenIdAuthentication</span> 
</pre>

<p>But in Rails 2.1 the <strong>init.rb</strong> file would be:</p>

<pre class="mac_classic">config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>ruby-openid<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>openid<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">&quot;</span>1.1.4<span class="String">&quot;</span></span>
config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>ruby-yadis<span class="String">&quot;</span></span>,  <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>yadis<span class="String">&quot;</span></span>,  <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">&quot;</span>0.3.4<span class="String">&quot;</span></span> 

config.<span class="FunctionName">after_initialize</span> <span class="Keyword">do</span>
  <span class="LibraryObject">ActionController</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">send</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include</span>, <span class="Variable">OpenIdAuthentication</span>
<span class="Keyword">end</span>
</pre>

<p>So, when you run the task to install all necessary gems, these gems will be among them.</p>

<h2> gems:build</h2>

<p>The <strong>gems:build</strong> task compiles all native extensions of gems which were installed through <strong>gems:unpack</strong>. The syntax is the following:</p>

<pre class="mac_classic">rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>build</span> <span class="Comment"><span class="Comment">#</span> For all gems</span>
rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>build</span> <span class="Variable">GEM</span><span class="Keyword">=</span>mygem <span class="Comment"><span class="Comment">#</span> I'm specifing the gem</span>
</pre>

<h2> New message when starting server</h2>

<p>There was a little improvement when starting Rails server, now it shows which Rails version is being loaded:</p>

<pre class="mac_classic"><span class="Variable">Rails</span> <span class="Number">2.1</span> application starting on http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span><span class="Number">0.0</span>.<span class="Number">0.0</span>:<span class="Number">3000</span>
</pre>

<h2> Rails.public_path</h2>

<p>It was added the <strong>Rails.public_path</strong> shortcut to recover the path of the project's <strong>"public"</strong> directory.</p>

<pre class="mac_classic"><span class="LibraryObject">Rails</span>.<span class="FunctionName">public_path</span>
</pre>

<h2> Rails.logger, Rails.root, Rails.env and Rails.cache</h2>

<p>In Rails 2.1 instead of using the constants: <strong>RAILS_DEFAULT_LOGGER</strong>, <strong>RAILS_ROOT</strong>, <strong>RAILS_ENV</strong> and <strong>RAILS_CACHE</strong>. We will use:</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> RAILS_DEFAULT_LOGGER</span>
<span class="LibraryObject">Rails</span>.<span class="FunctionName">logger</span>

<span class="Comment"><span class="Comment">#</span> RAILS_ROOT</span>
<span class="LibraryObject">Rails</span>.<span class="FunctionName">root</span>

<span class="Comment"><span class="Comment">#</span> RAILS_ENV</span>
<span class="LibraryObject">Rails</span>.<span class="FunctionName">env</span>

<span class="Comment"><span class="Comment">#</span> RAILS_CACHE</span>
<span class="LibraryObject">Rails</span>.<span class="FunctionName">cache</span>
</pre>

<h2> Rails.version</h2>

<p>In earlier versions to discover, during running time, what's the Rails version in use, we used:</p>

<pre class="mac_classic"><span class="LibraryObject">Rails</span>::<span class="FunctionName">VERSION</span>::<span class="FunctionName">STRING</span>
</pre>

<p>In Rails 2.1 changed to:</p>

<pre class="mac_classic"><span class="LibraryObject">Rails</span>.<span class="FunctionName">version</span>
</pre>

<h2>Getting information about a plugin</h2>

<p>This is one of the new Rails 2.0 features which you probably never used. I say "probably", because in some very specific cases it can be useful, for example, to know a plugin version.</p>

<p>To test it, we need to create a new file called <em>about.yml</em> in the plugin directory, something like this:</p>

<pre class="mac_classic">author: <span class="Variable">Carlos</span> <span class="Variable">Brando</span>
version: <span class="Number">1.2</span>.<span class="Number">0</span>
description: <span class="Variable">A</span> description about the plugin
url: http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>www.<span class="FunctionName">nomedojogo</span>.<span class="FunctionName">com</span>
</pre>

<p>We can get this information later this way:</p>

<pre class="mac_classic">plugin <span class="Keyword">=</span> <span class="LibraryObject">Rails</span>::<span class="FunctionName">Plugin</span>.<span class="FunctionName">new</span>(plugin_directory)
plugin.<span class="FunctionName">about</span>[<span class="String"><span class="String">&quot;</span>author<span class="String">&quot;</span></span>] <span class="Comment"><span class="Comment">#</span> =&gt; “Carlos Brando”</span>
plugin.<span class="FunctionName">about</span>[<span class="String"><span class="String">&quot;</span>url<span class="String">&quot;</span></span>] <span class="Comment"><span class="Comment">#</span> =&gt; “http://www.nomedojogo.com”</span>
</pre>

<p>If you find some good use for this feature and want to share with me, maybe i can change my mind about its real need.</p>

<h1> Rake Tasks, Plugins and Scripts</h1>

<h2> Tasks</h2>

<h3> rails:update</h3>

<p>From now on everytime you run the task <strong>rake rails:freeze:edge</strong> it will also run <strong>rails:update</strong>, updating the config files and <em>JavaScripts</em>.</p>

<h3> Database in 127.0.0.1</h3>

<p>A change was made in the file databases.rake that used to look only in localhost for local databases, it will now also consider the IP <strong>127.0.0.1</strong>. This works for both <strong>create</strong> and <strong>drop</strong> tasks. The databases.rake file was also refactored to make the code less repetitive.</p>

<h3> Freezing a specific Rails release.</h3>

<p>Until Rails 2.1 it wasn't possible to freeze a specific Rails release inside your project, you could only use its Revision as a parameter. In Rails 2.1, we can freeze a specific release using the command below:</p>

<pre class="mac_classic">rake rails<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>freeze</span><span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>edge</span> <span class="Variable">RELEASE</span><span class="Keyword">=</span><span class="Number">1.2</span>.<span class="Number">0</span>
</pre>

<h2> TimeZone</h2>

<h4> rake time:zones:all</h4>

<p>Return all the time zones known to Rails, grouped by offset. You can also filter the return value using the optional parameter OFFSET, for instance: OFFSET=-6.</p>

<h4> rake time:zones:us</h4>

<p>Shows a list with all US time zones. The OFFSET option is still valid here.</p>

<h4> rake time:zones:local</h4>

<p>Return all the time zones known to Rails that are in the same offset of your OS.</p>

<h2> Scripts</h2>

<h3> plugin</h3>

<p>The command script/plugin install now allows the use of –e/--export option, so that it issues a svn export. 
Added support for plugins hosted in GIT repositories.</p>

<h3> dbconsole</h3>

<p>This script does the same thig as script/console but for your database. In other words it connects to the command line client of your database.</p>

<p>Looking at the code, this apparently will only work for mysql, postgresql and sqlite(3). When another database is configured in database.yml, this script will show: "not supported for this database type".</p>

<h2> Plugins</h2>

<h3> Gems can now be plugins</h3>

<p>Now, any gem that has a <strong>rails/init.rb</strong> file can be installed inside the <strong>vendor</strong> directory of your Rails project just like a <strong>plugin</strong>.</p>

<h3> Using generators in plugins</h3>

<p>It's possible to configure <strong>Rails</strong> to search for <strong>plugins</strong> in places other than the <strong>vendor/plugins</strong> directory, just including this line of code in your <strong>environment.rb</strong>.</p>

<pre class="mac_classic">config.<span class="FunctionName">plugin_paths</span> <span class="Keyword">=</span> [<span class="String"><span class="String">'</span>lib/plugins<span class="String">'</span></span>, <span class="String"><span class="String">'</span>vendor/plugins<span class="String">'</span></span>]
</pre>

<p>Rails 2.0, however, had a bug in this configuration that showed up when the plugin had generators. Because of that bug Rails only found generators in plugins that were inside the <strong>vendor/plugins</strong> directory. In 2.1 this bug was squashed.</p>

<h1> Prototype and script.aculo.us</h1>

<h2> Prototype</h2>

<p>Rails 2.1 now uses Prototype version 1.6.0.1. It serves as a preparatory to version 1.8.1 of script.aculo.us.</p>

<h1> Ruby 1.9</h1>

<h2> Details</h2>

<p>The main focus of Rails changes was Ruby 1.9, even minor details were analyzed to increase Rails compatibility with the new Ruby version. Details like changing from <strong>File.exists?</strong> to <strong>File.exist?</strong> were not kept aside.</p>

<p>Also, in Ruby 1.9, the module <strong>Base64</strong> (base64.rb) was removed, because of that, all references to it were replaced by <strong>ActiveSupport::Base64</strong>.</p>

<h2>New methodos for DateTime class</h2>

<p>In order to keep compatibility (duck-typing) with <strong>Time</strong> class, three new methods were added to <strong>DateTime</strong> class. The methods are <strong>#utc</strong>, <strong>#utc?</strong> and <strong>#utc_offset</strong>. Look an example for each one:</p>

<pre class="mac_classic"><span class="Keyword">&gt;&gt;</span> date <span class="Keyword">=</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2005</span>, <span class="Number">2</span>, <span class="Number">21</span>, <span class="Number">10</span>, <span class="Number">11</span>, <span class="Number">12</span>, <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">6</span>, <span class="Number">24</span>))
<span class="Comment"><span class="Comment">#</span>=&gt; Mon, 21 Feb 2005 10:11:12 -0600</span>

<span class="Keyword">&gt;&gt;</span> date.<span class="FunctionName">utc</span>
<span class="Comment"><span class="Comment">#</span>=&gt; Mon, 21 Feb 2005 16:11:12 +0000</span>

<span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2005</span>, <span class="Number">2</span>, <span class="Number">21</span>, <span class="Number">10</span>, <span class="Number">11</span>, <span class="Number">12</span>, <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">6</span>, <span class="Number">24</span>)).<span class="FunctionName">utc?</span>
<span class="Comment"><span class="Comment">#</span>=&gt; false</span>

<span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2005</span>, <span class="Number">2</span>, <span class="Number">21</span>, <span class="Number">10</span>, <span class="Number">11</span>, <span class="Number">12</span>, <span class="Number">0</span>).<span class="FunctionName">utc?</span>
<span class="Comment"><span class="Comment">#</span>=&gt; true</span>

<span class="Keyword">&gt;&gt;</span> <span class="LibraryObject">DateTime</span>.<span class="FunctionName">civil</span>(<span class="Number">2005</span>, <span class="Number">2</span>, <span class="Number">21</span>, <span class="Number">10</span>, <span class="Number">11</span>, <span class="Number">12</span>, <span class="Variable">Rational</span>(<span class="Keyword">-</span><span class="Number">6</span>, <span class="Number">24</span>)).<span class="FunctionName">utc_offset</span>
<span class="Comment"><span class="Comment">#</span>=&gt; -21600</span>
</pre>

<h1> Debug</h1>

<h2>Native Ruby-debug</h2>

<p>It was enabled again the option for using <strong>ruby-debug</strong> in Rails tests. Now, since you already have the gem installed, it only needs the <strong>debugger</strong> method.</p>

<h1> Bugs and Fixes</h1>

<h2> Add columns in PostgreSQL</h2>

<p>There was a bug when using <strong>PostgreSQL</strong>. The bug occurred when creating a migration for adding a column in an existing table. Look an example:</p>

<p>File: <em>db/migrate/002_add_cost.rb</em></p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">AddCost<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Migration</span></span>
  <span class="Keyword">def</span> <span class="FunctionName">self.up</span>
    add_column <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>items</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>cost</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>decimal</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>precision</span> =&gt; <span class="Number">6</span>, 
   <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>scale</span> =&gt; <span class="Number">2</span>
  <span class="Keyword">end</span>

  <span class="Keyword">def</span> <span class="FunctionName">self.down</span>
    remove_column <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>items</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>cost</span>
  <span class="Keyword">end</span>
<span class="Keyword">end</span>
</pre>

<p>Note we are creating a column with <strong>:precision => 6</strong> and <strong>:scale => 2</strong>. Now run <strong>rake db:migrate</strong> and let's see how is our table in database:</p>

<table border="1" cellspacing="0" cellpadding="5">
    <tr>
        <td><strong>Column</strong></td>
        <td><strong>Type</strong></td>
        <td><strong>Modifiers</strong></td>
    </tr>
    <tr>
        <td>id</td>
        <td>integer</td>
        <td>not null</td>
    </tr>
    <tr>
        <td>descr</td>
        <td>character varying(255)</td>
        <td></td>
    </tr>
    <tr>
        <td>price</td>
        <td>numeric(5,2)</td>
        <td></td>
    </tr>
    <tr>
        <td>cost</td>
        <td>numeric</td>
        <td></td>
    </tr>
</table>


<p>See "cost" column which we just created. It is a common <strong>numeric</strong>, but it was supposed to be a column like "price", above it, more precisely a <strong>numeric(6,2)</strong>. In Rails 2.1 this error doesn't occur anymore and the column will be created in the correct way.</p>

<h2>Mime Types</h2>

<p>It was fixed a bug which didn't allow you to define the assigned attribute for <strong>request.format</strong> using a symbol. Now, we can use the code bellow:</p>

<pre class="mac_classic">request.<span class="FunctionName">format</span> <span class="Keyword">=</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>iphone</span>
assert_equal <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>iphone</span>, request.<span class="FunctionName">format</span>
</pre>

<h2>Bug fixes in change_column</h2>

<p>It was fixed an existing bug when using the <strong>change_column</strong> method with <strong>:null => true</strong> in a column created using <strong>:null => false</strong>. Because of this bug no changes were made when using the method.</p>

<h1> Additional Information</h1>

<h2> Protecting from Cross Site Scripting</h2>

<p>In Rails 2.0 the file <em>application.rb</em> looks like this:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">ApplicationController<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActionController::Base</span></span>
  helper <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>

  protect_from_forgery
<span class="Keyword">end</span>
</pre>

<p>Notice the call to the method <strong>protect_from_forgery</strong>.</p>

<p>Have you heard about Cross Site Scripting? This is the name of a security failure easily found in most websites and web applications that allows evil people (here I'm talking about teenagers with nothing to do and no social life) to alter the content of web pages, perform fishing attacks, take over the control of the browser through JavaScript code and in most cases force the user to execute some command they wish. That last type of attack is called cross-site request forgery.</p>

<p>Cross Site Request Forgery is a type of attack that forces legit users to execute a series of commands without even knowing. And with the increasing use of Ajax, things are getting even worse.</p>

<p>Actually, this method is useful to make sure that all forms your application is receiving are coming from itself, and not from a lost link in another site. It achieves it by including a token based on the session in all forms and Ajax requests generated by Rails, and later checking the authenticity of this token in the controller.</p>

<p>Remember that GET requests are not protected. But it won't be a problem if we use it only to bring data, and never to alter or save anything in our database.</p>

<p>If you want to learn more about CSRF (Cross-Site Request Forgery) use the addresses below:</p>

<ul>
<li><p><a href="http://www.nomedojogo.com/2008/01/14/como-um-garoto-chamado-samy-pode-derrubar-seu-site/isc.sans.org/diary.html?storyid=1750">http://www.nomedojogo.com/2008/01/14/como-um-garoto-chamado-samy-pode-derrubar-seu-site/isc.sans.org/diary.html?storyid=1750</a></p></li>
<li><p><a href="http://www.nomedojogo.com/2008/01/14/como-um-garoto-chamado-samy-pode-derrubar-seu-site/isc.sans.org/diary.html?storyid=1750">http://www.nomedojogo.com/2008/01/14/como-um-garoto-chamado-samy-pode-derrubar-seu-site/isc.sans.org/diary.html?storyid=1750</a></p></li>
</ul>


<p>But remember that this is not a definitive solution to our problem, or like we usually say, it's not a silver bullet.</p>

<h2> Used method_missing, then don't leave loose ends</h2>

<p>Due to Ruby's dynamic nature, the method <strong>respond_to?</strong> is crucial. How many times we had to check if a method exists in the object we're dealing with, or even check if the object is the same that we are expecting (<strong>is_a?</strong>)?</p>

<p>However there's something really important that many people forget. Look at this class that uses the method <strong>method_missing</strong>:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">Dog</span>
  <span class="Keyword">def</span> <span class="FunctionName">method_missing</span>(<span class="FunctionParameter">method<span class="FunctionParameter">,</span> <span class="Keyword">*</span>args<span class="FunctionParameter">,</span> <span class="Keyword">&amp;</span>block</span>)
    <span class="Keyword">if</span> method.<span class="FunctionName">to_s</span> <span class="Keyword">=~</span> <span class="String"><span class="String">/</span></span><span class="String">^bark</span><span class="String"><span class="String">/</span></span>
      puts <span class="String"><span class="String">&quot;</span>woofwoof!<span class="String">&quot;</span></span>
    <span class="Keyword">else</span>
      <span class="Keyword">super</span>
    <span class="Keyword">end</span>
  <span class="Keyword">end</span>
<span class="Keyword">end</span>

rex <span class="Keyword">=</span> <span class="LibraryObject">Dog</span>.<span class="FunctionName">new</span>
rex.<span class="FunctionName">bark</span> <span class="Comment"><span class="Comment">#</span>=&gt; woofwof!</span>
rex.<span class="FunctionName">bark!</span> <span class="Comment"><span class="Comment">#</span>=&gt; woofwoof!</span>
rex.<span class="FunctionName">bark_and_run</span> <span class="Comment"><span class="Comment">#</span>=&gt; woofwoof!</span>
</pre>

<p>I think you already know <strong>method_missing</strong>, don't you? In the example above I'm creating an instance of the class <strong>Dog</strong> and calling the methods <strong>bark</strong>, <strong>bark!</strong> e <strong>bark_and_run</strong> that don't exist. Then the method <strong>method_missing</strong> is called, where I use a simple regular expression to return "woofwoof!", whenever the name of the method begins with bark.</p>

<p>But look what happens when I try to use the method <strong>respond_to?</strong>:</p>

<pre class="mac_classic">rex.<span class="FunctionName">respond_to?</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>bark</span> <span class="Comment"><span class="Comment">#</span>=&gt; false</span>
rex.<span class="FunctionName">bark</span> <span class="Comment"><span class="Comment">#</span>=&gt; woofwoof!</span>
</pre>

<p>It returns false, and that makes all sense since the method doesn't really exist. Then it's my responsibility to change the method <strong>respond_to?</strong> to work properly using my special rule. I'll change my class to this:</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">Dog</span>
  <span class="Variable">METHOD_BARK</span> <span class="Keyword">=</span> <span class="String"><span class="String">/</span></span><span class="String">^bark</span><span class="String"><span class="String">/</span></span>

  <span class="Keyword">def</span> <span class="FunctionName">respond_to?</span>(<span class="FunctionParameter">method</span>)
    <span class="Keyword">return</span> <span class="BuiltInConstant">true</span> <span class="Keyword">if</span> method.<span class="FunctionName">to_s</span> <span class="Keyword">=~</span> <span class="Variable">METHOD_BARK</span>
    <span class="Keyword">super</span>
  <span class="Keyword">end</span>

  <span class="Keyword">def</span> <span class="FunctionName">method_missing</span>(<span class="FunctionParameter">method<span class="FunctionParameter">,</span> <span class="Keyword">*</span>args<span class="FunctionParameter">,</span> <span class="Keyword">&amp;</span>block</span>)
    <span class="Keyword">if</span> method.<span class="FunctionName">to_s</span> <span class="Keyword">=~</span> <span class="Variable">METHOD_BARK</span>
      puts <span class="String"><span class="String">&quot;</span>woofwoof!<span class="String">&quot;</span></span>
    <span class="Keyword">else</span>
      <span class="Keyword">super</span>
    <span class="Keyword">end</span>
  <span class="Keyword">end</span>
<span class="Keyword">end</span>

rex <span class="Keyword">=</span> <span class="LibraryObject">Dog</span>.<span class="FunctionName">new</span>
rex.<span class="FunctionName">respond_to?</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>bark</span>) <span class="Comment"><span class="Comment">#</span>=&gt; true</span>
rex.<span class="FunctionName">bark</span> <span class="Comment"><span class="Comment">#</span>=&gt; woofwoof!</span>
</pre>

<p>Now we're talking! This is a common mistake that I've seen in some codes, Rails itself included. Try to execute a  <strong>respond_to?</strong> to check the existence of methods like <strong>find_by_name</strong>, for example.</p>

<p>Ruby is an amazing and highly flexible language, but if we don't watch it we can leave loose ends like this.</p>

<p>Of course that in Rails 2.1 this problem was fixed, we can use <strong>respond_to?</strong> to check the existence of methods like <strong>find_by_something</strong>.</p>

<h2> PostgreSQL</h2>

<p>In Rails 2.0, the adapter for <strong>PostgreSQL</strong> had support only for versions 8.1 up to 8.3. It has been added support for versions 7.4 up to 8.3.</p>

<h1> CHANGELOG</h1>

<h2> ActionMailer</h2>

<p>* Fixed that a return-path header would be ignored #7572 [joost]</p>

<p>* Less verbose mail logging: just recipients for :info log level; the whole email for :debug only.  #8000 [iaddict, Tarmo Tänav]</p>

<p>* Updated TMail to version 1.2.1 [raasdnil]</p>

<p>* Fixed that you don't have to call super in ActionMailer::TestCase#setup #10406 [jamesgolick]</p>

<h2> ActionPack</h2>

<p>* InstanceTag#default_time_from_options overflows to DateTime [Geoff Buesing]</p>

<p>* Fixed that forgery protection can be used without session tracking (Peter Jones) [#139]</p>

<p>* Added session(:on) to turn session management back on in a controller subclass if the superclass turned it off (Peter Jones) [#136]</p>

<p>* Change the request forgery protection to go by Content-Type instead of request.format so that you can't bypass it by POSTing to "#{request.uri}.xml" [rick]
* InstanceTag#default_time_from_options with hash args uses Time.current as default; respects hash settings when time falls in system local spring DST gap [Geoff Buesing]</p>

<p>* select_date defaults to Time.zone.today when config.time_zone is set [Geoff Buesing]</p>

<p>* Fixed that TextHelper#text_field would corrypt when raw HTML was used as the value (mchenryc, Kevin Glowacz) [#80]</p>

<p>* Added ActionController::TestCase#rescue_action_in_public! to control whether the action under test should use the regular rescue_action path instead of simply raising the exception inline (great for error testing) [DHH]</p>

<p>* Reduce number of instance variables being copied from controller to view. [Pratik]</p>

<p>* select_datetime and select_time default to Time.zone.now when config.time_zone is set [Geoff Buesing]</p>

<p>* datetime_select defaults to Time.zone.now when config.time_zone is set [Geoff Buesing]</p>

<p>* Remove ActionController::Base#view_controller_internals flag. [Pratik]</p>

<p>* Add conditional options to caches_page method. [Paul Horsfall]</p>

<p>* Move missing template logic to ActionView. [Pratik]</p>

<p>* Introduce ActionView::InlineTemplate class. [Pratik]</p>

<p>* Automatically parse posted JSON content for Mime::JSON requests.  [rick]</p>

<pre class="mac_classic"><span class="Variable">POST</span> <span class="Keyword">/</span>posts
    {<span class="String"><span class="String">&quot;</span>post<span class="String">&quot;</span></span>: {<span class="String"><span class="String">&quot;</span>title<span class="String">&quot;</span></span>: <span class="String"><span class="String">&quot;</span>Breaking News<span class="String">&quot;</span></span>}}

<span class="Keyword">def</span> <span class="FunctionName">create</span>
    <span class="Variable"><span class="Variable">@</span>post</span> <span class="Keyword">=</span> <span class="LibraryObject">Post</span>.<span class="FunctionName">create</span> params[<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>post</span>]
<span class="Comment">    <span class="Comment">#</span> ...</span>
<span class="Keyword">end</span>
</pre>

<p>* add json_escape ERB util to escape html entities in json strings that are output in HTML pages. [rick]</p>

<p>* Provide a helper proxy to access helper methods from outside views. Closes #10839 [Josh Peek]
  e.g. ApplicationController.helpers.simple_format(text)</p>

<p>* Improve documentation. [Xavier Noria, leethal, jerome]</p>

<p>* Ensure RJS redirect_to doesn't html-escapes string argument. Closes #8546 [josh, eventualbuddha, Pratik]</p>

<p>* Support render :partial => collection of heterogeneous elements.  #11491 [Zach Dennis]</p>

<p>* Avoid remote_ip spoofing.  [Brian Candler]</p>

<p>* Added support for regexp flags like ignoring case in the :requirements part of routes declarations #11421 [NeilW]</p>

<p>* Fixed that ActionController::Base#read_multipart would fail if boundary was exactly 10240 bytes #10886 [ariejan]</p>

<p>* Fixed HTML::Tokenizer (used in sanitize helper) didn't handle unclosed CDATA tags #10071 [esad, packagethief]</p>

<p>* Improve documentation. [Radar, Jan De Poorter, chuyeow, xaviershay, danger, miloops, Xavier Noria,  Sunny Ripert]</p>

<p>* Fixed that FormHelper#radio_button would produce invalid ids #11298 [harlancrystal]</p>

<p>* Added :confirm option to submit_tag #11415 [miloops]</p>

<p>* Fixed NumberHelper#number_with_precision to properly round in a way that works equally on Mac, Windows, Linux (closes #11409, #8275, #10090, #8027) [zhangyuanyi]</p>

<p>* Allow the #simple_format text_helper to take an html_options hash for each paragraph.  #2448 [Francois Beausoleil, thechrisoshow]</p>

<p>* Fix regression from filter refactoring where re-adding a skipped filter resulted in it being called twice.  [rick]</p>

<p>* Refactor filters to use Active Support callbacks.  #11235 [Josh Peek]</p>

<p>* Fixed that polymorphic routes would modify the input array #11363 [thomas.lee]</p>

<p>* Added :format option to NumberHelper#number_to_currency to enable better localization support #11149 [lylo]</p>

<p>* Fixed that TextHelper#excerpt would include one character too many #11268 [Irfy]</p>

<p>* Fix more obscure nested parameter hash parsing bug.  #10797 [thomas.lee]</p>

<p>* Added ActionView::Helpers::register_javascript/stylesheet_expansion to make it easier for plugin developers to inject multiple assets.  #10350 [lotswholetime]</p>

<p>* Fix nested parameter hash parsing bug.  #10797 [thomas.lee]</p>

<p>* Allow using named routes in ActionController::TestCase before any request has been made. Closes #11273 [alloy]</p>

<p>* Fixed that sweepers defined by cache_sweeper will be added regardless of the perform_caching setting. Instead, control whether the sweeper should be run with the perform_caching setting. This makes testing easier when you want to turn perform_caching on/off [DHH]</p>

<p>* Make MimeResponds::Responder#any work without explicit types. Closes #11140 [jaw6]</p>

<p>* Better error message for type conflicts when parsing params.  Closes #7962 [spicycode, matt]</p>

<p>* Remove unused ActionController::Base.template_class. Closes #10787 [Pratik]</p>

<p>* Moved template handlers related code from ActionView::Base to ActionView::Template. [Pratik]</p>

<p>* Tests for div_for and content_tag_for helpers. Closes #11223 [thechrisoshow]</p>

<p>* Allow file uploads in Integration Tests.  Closes #11091 [RubyRedRick]</p>

<p>* Refactor partial rendering into a PartialTemplate class. [Pratik]</p>

<p>* Added that requests with JavaScript as the priority mime type in the accept header and no format extension in the parameters will be treated as though their format was :js when it comes to determining which template to render. This makes it possible for JS requests to automatically render action.js.rjs files without an explicit respond_to block  [DHH]</p>

<p>* Tests for distance_of_time_in_words with TimeWithZone instances. Closes #10914 [ernesto.jimenez]</p>

<p>* Remove support for multivalued (e.g., '&amp;'-delimited) cookies. [Jamis Buck]</p>

<p>* Fix problem with render :partial collections, records, and locals. #11057 [lotswholetime] </p>

<p>* Added support for naming concrete classes in sweeper declarations [DHH]</p>

<p>* Remove ERB trim variables from trace template in case ActionView::Base.erb_trim_mode is changed in the application.  #10098 [tpope, kampers]</p>

<p>* Fix typo in form_helper documentation.  #10650 [xaviershay, kampers]</p>

<p>* Fix bug with setting Request#format= after the getter has cached the value.  #10889 [cch1]</p>

<p>* Correct inconsistencies in RequestForgeryProtection docs.  #11032 [mislav]</p>

<p>* Introduce a Template class to ActionView.  #11024 [lifofifo]</p>

<p>* Introduce the :index option for form_for and fields_for to simplify multi-model forms (see http://railscasts.com/episodes/75).  #9883 [rmm5t]</p>

<p>* Introduce map.resources :cards, :as => 'tarjetas' to use a custom resource name in the URL: cards_path == '/tarjetas'.  #10578 [blj]</p>

<p>* TestSession supports indifferent access.  #7372 [tamc, Arsen7, mhackett, julik, jean.helou]</p>

<p>* Make assert_routing aware of the HTTP method used.  #8039 [mpalmer]
  e.g. assert_routing({ :method => 'put', :path => '/product/321' }, { :controller => "product", :action => "update", :id => "321" })</p>

<p>* Make map.root accept a single symbol as an argument to declare an alias.  #10818 [bscofield] </p>

<p>  e.g.  map.dashboard '/dashboard', :controller=>'dashboard'</p>

<pre class="mac_classic">    map.<span class="FunctionName">root</span>      <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>dashboard</span>
</pre>

<p>* Handle corner case with image_tag when passed 'messed up' image names. #9018 [duncanbeevers, mpalmer]</p>

<p>* Add label_tag helper for generating elements. #10802 [DefV]</p>

<p>* Introduce TemplateFinder to handle view paths and lookups.  #10800 [Pratik Naik] </p>

<p>* Performance: optimize route recognition. Large speedup for apps with many resource routes.  #10835 [oleganza]</p>

<p>* Make render :partial recognise form builders and use the _form partial.  #10814 [djanowski]</p>

<p>* Allow users to declare other namespaces when using the atom feed helpers. #10304 [david.calavera]</p>

<p>* Introduce send_file :x_sendfile => true to send an X-Sendfile response header.  [Jeremy Kemper]</p>

<p>* Fixed ActionView::Helpers::ActiveRecordHelper::form for when protect_from_forgery is used #10739 [jeremyevans]</p>

<p>* Provide nicer access to HTTP Headers.  Instead of request.env["HTTP_REFERRER"] you can now use request.headers["Referrer"]. [Koz]</p>

<p>* UrlWriter respects relative_url_root.  #10748 [Cheah Chu Yeow]</p>

<p>* The asset_host block takes the controller request as an optional second argument. Example: use a single asset host for SSL requests.  #10549 [Cheah Chu Yeow, Peter B, Tom Taylor]</p>

<p>* Support render :text => nil.  #6684 [tjennings, PotatoSalad, Cheah Chu Yeow]</p>

<p>* assert_response failures include the exception message.  #10688 [Seth Rasmussen]</p>

<p>* All fragment cache keys are now by default prefixed with the "views/" namespace [DHH]</p>

<p>* Moved the caching stores from ActionController::Caching::Fragments::* to ActiveSupport::Cache::*. If you're explicitly referring to a store, like ActionController::Caching::Fragments::MemoryStore, you need to update that reference with ActiveSupport::Cache::MemoryStore [DHH]</p>

<p>* Deprecated ActionController::Base.fragment_cache_store for ActionController::Base.cache_store [DHH]</p>

<p>* Made fragment caching in views work for rjs and builder as well #6642 [zsombor]</p>

<p>* Fixed rendering of partials with layout when done from site layout #9209 [antramm]</p>

<p>* Fix atom_feed_helper to comply with the atom spec.  Closes #10672 [xaviershay]</p>

<pre class="mac_classic"><span class="Variable">The</span> tags created <span class="Keyword">do </span><span class="Keyword">not</span> contain a date (http<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>/</span><span class="Keyword">/</span>feedvalidator.<span class="FunctionName">org</span><span class="Keyword">/</span>docs<span class="Keyword">/</span>error<span class="Keyword">/</span><span class="LibraryObject">InvalidTAG</span>.<span class="FunctionName">html</span>)
<span class="Variable">IDs</span> are <span class="Keyword">not</span> guaranteed unique
<span class="Variable">A</span> default <span class="Variable">self</span> link was <span class="Keyword">not</span> provided, contrary to the documentation
<span class="Variable">NOTE</span>:  <span class="Variable">This</span> changes tags <span class="Keyword">for</span> existing atom entries, but at least they validate now.
</pre>

<p>* Correct indentation in tests.  Closes #10671 [l.guidi]</p>

<p>* Fix that auto_link looks for ='s in url paths (Amazon urls have them).  Closes #10640 [bgreenlee]</p>

<p>* Ensure that test case setup is run even if overridden.  #10382 [Josh Peek]</p>

<p>* Fix HTML Sanitizer to allow trailing spaces in CSS style attributes.  Closes #10566 [wesley.moxam]</p>

<p>* Add :default option to time_zone_select.  #10590 [Matt Aimonetti]</p>

<h2> ActiveRecord</h2>

<p>* Add ActiveRecord::Base.sti_name that checks ActiveRecord::Base#store_full_sti_class? and returns either the full or demodulized name. [rick]</p>

<p>* Add first/last methods to associations/named_scope. Resolved #226. [Ryan Bates]</p>

<p>* Added SQL escaping for :limit and :offset #288 [Aaron Bedra, Steven Bristol, Jonathan Wiess] </p>

<p>* Added first/last methods to associations/named_scope. Resolved #226. [Ryan Bates]</p>

<p>* Ensure hm:t preloading honours reflection options. Resolves #137. [Frederick Cheung]</p>

<p>* Added protection against duplicate migration names (Aslak Hellesøy) [#112]</p>

<p>* Base#instantiate_time_object: eliminate check for Time.zone, since we can assume this is set if time_zone_aware_attributes is set to true [Geoff Buesing]</p>

<p>* Time zone aware attribute methods use Time.zone.parse instead of #to_time for String arguments, so that offset information in String is respected. Resolves #105. [Scott Fleckenstein, Geoff Buesing]</p>

<p>* Added change_table for migrations (Jeff Dean) [#71]. Example:</p>

<pre class="mac_classic">change_table <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>videos</span> <span class="Keyword">do </span>|<span class="Variable">t</span>|
  t.<span class="FunctionName">timestamps</span>                          <span class="Comment"><span class="Comment">#</span> adds created_at, updated_at</span>
  t.<span class="FunctionName">belongs_to</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>goat</span>                    <span class="Comment"><span class="Comment">#</span> adds goat_id integer</span>
  t.<span class="FunctionName">string</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>name</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>email</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>limit</span> =&gt; <span class="Number">20</span>  <span class="Comment"><span class="Comment">#</span> adds name and email both with a 20 char limit</span>
  t.<span class="FunctionName">remove</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>name</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>email</span>                <span class="Comment"><span class="Comment">#</span> removes the name and email columns</span>
<span class="Keyword">end</span>
</pre>

<p>* Fixed has_many :through .create with no parameters caused a "can't dup NilClass" error (Steven Soroka) [#85]</p>

<p>* Added block-setting of attributes for Base.create like Base.new already has (Adam Meehan) [#39]</p>

<p>* Fixed that pessimistic locking you reference the quoted table name (Josh Susser) [#67]</p>

<p>* Fixed that change_column should be able to use :null => true on a field that formerly had false [Nate Wiger] [#26]</p>

<p>* Added that the MySQL adapter should map integer to either smallint, int, or bigint depending on the :limit just like PostgreSQL [DHH]</p>

<p>* Change validates_uniqueness_of :case_sensitive option default back to true (from [9160]).  Love your database columns, don't LOWER them.  [rick]</p>

<p>* Add support for interleaving migrations by storing which migrations have run in the new schema_migrations table. Closes #11493 [jordi]</p>

<p>* ActiveRecord::Base#sum defaults to 0 if no rows are returned.  Closes #11550 [kamal]</p>

<p>* Ensure that respond_to? considers dynamic finder methods. Closes #11538. [floehopper]</p>

<p>* Ensure that save on parent object fails for invalid has_one association. Closes #10518. [Pratik]</p>

<p>* Remove duplicate code from associations. [Pratik]</p>

<p>* Refactor HasManyThroughAssociation to inherit from HasManyAssociation. Association callbacks and <association>_ids= now work with hm:t. #11516 [rubyruy]</p>

<p>* Ensure HABTM#create and HABTM#build do not load entire association. [Pratik]</p>

<p>* Improve documentation. [Xavier Noria, Jack Danger Canty, leethal]</p>

<p>* Tweak ActiveRecord::Base#to_json to include a root value in the returned hash: {"post": {"title": ...}} [rick]</p>

<pre class="mac_classic"><span class="LibraryObject">Post</span>.<span class="FunctionName">find</span>(<span class="Number">1</span>).<span class="FunctionName">to_json</span> <span class="Comment"><span class="Comment">#</span> =&gt; {&quot;title&quot;: ...}</span>
config.<span class="FunctionName">active_record</span>.<span class="FunctionName">include_root_in_json</span> <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
<span class="LibraryObject">Post</span>.<span class="FunctionName">find</span>(<span class="Number">1</span>).<span class="FunctionName">to_json</span> <span class="Comment"><span class="Comment">#</span> =&gt; {&quot;post&quot;: {&quot;title&quot;: ...}}</span>
</pre>

<p>* Add efficient #include? to AssociationCollection (for has_many/has_many :through/habtm).  [stopdropandrew]</p>

<p>* PostgreSQL: create_ and drop_database support.  #9042 [ez, pedz, nicksieger]</p>

<p>* Ensure that validates_uniqueness_of works with with_scope. Closes #9235. [nik.wakelin, cavalle]</p>

<p>* Partial updates include only unsaved attributes. Off by default; set YourClass.partial_updates = true to enable.  [Jeremy Kemper]</p>

<p>* Removing unnecessary uses_tzinfo helper from tests, given that TZInfo is now bundled [Geoff Buesing]</p>

<p>* Fixed that validates_size_of :within works in associations #11295, #10019 [cavalle]</p>

<p>* Track changes to unsaved attributes.  [Jeremy Kemper]</p>

<p>* Switched to UTC-timebased version numbers for migrations and the schema. This will as good as eliminate the problem of multiple migrations getting the same version assigned in different branches. Also added rake db:migrate:up/down to apply individual migrations that may need to be run when you merge branches #11458 [jbarnette]</p>

<p>* Fixed that has_many :through would ignore the hash conditions #11447 [miloops]</p>

<p>* Fix issue where the :uniq option of a has_many :through association is ignored when find(:all) is called.  Closes #9407 [cavalle]</p>

<p>* Fix duplicate table alias error when including an association with a has_many :through association on the same join table.  Closes #7310 [cavalle]</p>

<p>* More efficient association preloading code that compacts a through_records array in a central location.  Closes #11427 [danger]</p>

<p>* Improve documentation. [Radar, Jan De Poorter, chuyeow, xaviershay, danger, miloops, Xavier Noria,  Sunny Ripert]</p>

<p>* Fixed that ActiveRecord#Base.find_or_create/initialize would not honor attr_protected/accessible when used with a hash #11422 [miloops]</p>

<p>* Added ActiveRecord#Base.all/first/last as aliases for find(:all/:first/:last) #11413 [nkallen, thechrisoshow]</p>

<p>* Merge the has_finder gem, renamed as 'named_scope'.  #11404 [nkallen]</p>

<pre class="mac_classic"><span class="Keyword">class</span> <span class="TypeName">Article<span class="InheritedClassName"> <span class="InheritedClassName">&lt;</span> ActiveRecord::Base</span></span>
    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>published</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; {<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>published</span> =&gt; <span class="BuiltInConstant">true</span>}
    named_scope <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>popular</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; ...
<span class="Keyword">end</span>

<span class="LibraryObject">Article</span>.<span class="FunctionName">published</span>.<span class="FunctionName">paginate</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>page</span> =&gt; <span class="Number">1</span>)
<span class="LibraryObject">Article</span>.<span class="FunctionName">published</span>.<span class="FunctionName">popular</span>.<span class="FunctionName">count</span>
<span class="LibraryObject">Article</span>.<span class="FunctionName">popular</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>first</span>)
<span class="LibraryObject">Article</span>.<span class="FunctionName">popular</span>.<span class="FunctionName">find</span>(<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>all</span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>conditions</span> =&gt; {...})
</pre>

<p>See http://pivots.pivotallabs.com/users/nick/blog/articles/284-hasfinder-it-s-now-easier-than-ever-to-create-complex-re-usable-sql-queries</p>

<p>* Add has_one :through support.  #4756 [thechrisoshow]</p>

<p>* Migrations: create_table supports primary_key_prefix_type.  #10314 [student, thechrisoshow]</p>

<p>* Added logging for dependency load errors with fixtures #11056 [stuthulhu]</p>

<p>* Time zone aware attributes use Time#in_time_zone [Geoff Buesing]</p>

<p>* Fixed that scoped joins would not always be respected #6821 [Theory/Danger]</p>

<p>* Ensure that ActiveRecord::Calculations disambiguates field names with the table name.  #11027 [cavalle]</p>

<p>* Added add/remove_timestamps to the schema statements for adding the created_at/updated_at columns on existing tables #11129 [jramirez]</p>

<p>* Added ActiveRecord::Base.find(:last) #11338 [miloops]</p>

<p>* test_native_types expects DateTime.local_offset instead of DateTime.now.offset; fixes test breakage due to dst transition [Geoff Buesing]</p>

<p>* Add :readonly option to HasManyThrough associations. #11156 [miloops]</p>

<p>* Improve performance on :include/:conditions/:limit queries by selectively joining in the pre-query.  #9560 [dasil003]</p>

<p>* Perf fix: Avoid the use of named block arguments.  Closes #11109 [adymo]</p>

<p>* PostgreSQL: support server versions 7.4 through 8.0 and the ruby-pg driver.  #11127 [jdavis]</p>

<p>* Ensure association preloading doesn't break when an association returns nil. ##11145 [GMFlash]</p>

<p>* Make dynamic finders respect the :include on HasManyThrough associations.  #10998. [cpytel]</p>

<p>* Base#instantiate_time_object only uses Time.zone when Base.time_zone_aware_attributes is true; leverages Time#time_with_datetime_fallback for readability [Geoff Buesing]</p>

<p>* Refactor ConnectionAdapters::Column.new_time: leverage DateTime failover behavior of Time#time_with_datetime_fallback [Geoff Buesing]</p>

<p>* Improve associations performance by using symbol callbacks instead of string callbacks. #11108 [adymo]</p>

<p>* Optimise the BigDecimal conversion code.  #11110 [adymo]</p>

<p>* Introduce the :readonly option to all associations. Records from the association cannot be saved.  #11084 [miloops]</p>

<p>* Multiparameter attributes for time columns fail over to DateTime when out of range of Time [Geoff Buesing]</p>

<p>* Base#instantiate_time_object uses Time.zone.local() [Geoff Buesing]</p>

<p>* Add timezone-aware attribute readers and writers. #10982 [Geoff Buesing]</p>

<p>* Instantiating time objects in multiparameter attributes uses Time.zone if available.  #10982 [rick]</p>

<p>* Add note about how ActiveRecord::Observer classes are initialized in a Rails app. #10980 [fxn]</p>

<p>* MySQL: omit text/blob defaults from the schema instead of using an empty string.  #10963 [mdeiters]</p>

<p>* belongs_to supports :dependent => :destroy and :delete.  #10592 [Jonathan Viney]</p>

<p>* Introduce preload query strategy for eager :includes.  #9640 [Frederick Cheung, Aleksey Kondratenko, codafoo]</p>

<p>* Support aggregations in finder conditions.  #10572 [Ryan Kinderman]</p>

<p>* Organize and clean up the Active Record test suite.  #10742 [John Barnette]</p>

<p>* Ensure that modifying has_and_belongs_to_many actions clear the query cache.  Closes #10840 [john.andrews]</p>

<p>* Fix issue where Table#references doesn't pass a :null option to a *_type attribute for polymorphic associations.  Closes #10753 [railsjitsu]</p>

<p>* Fixtures: removed support for the ancient pre-YAML file format.  #10736 [John Barnette]</p>

<p>* More thoroughly quote table names.  #10698 [dimdenis, lotswholetime, Jeremy Kemper]</p>

<p>* update_all ignores scoped :order and :limit, so post.comments.update_all doesn't try to include the comment order in the update statement.  #10686 [Brendan Ribera]</p>

<p>* Added ActiveRecord::Base.cache_key to make it easier to cache Active Records in combination with the new ActiveSupport::Cache::* libraries [DHH]</p>

<p>* Make sure CSV fixtures are compatible with ruby 1.9's new csv implementation. [JEG2]</p>

<p>* Added by parameter to increment, decrement, and their bang varieties so you can do player1.increment!(:points, 5) #10542 [Sam]</p>

<p>* Optimize ActiveRecord::Base#exists? to use #select_all instead of #find.  Closes #10605 [jamesh, fcheung, protocool]</p>

<p>* Don't unnecessarily load has_many associations in after_update callbacks.  Closes #6822 [stopdropandrew, canadaduane]</p>

<p>* Eager belongs_to :include infers the foreign key from the association name rather than the class name.  #10517 [Jonathan Viney]</p>

<p>* SQLite: fix rename_ and remove_column for columns with unique indexes.  #10576 [Brandon Keepers]</p>

<p>* Ruby 1.9 compatibility.  #10655 [Jeremy Kemper, Dirkjan Bussink]</p>

<h2> ActiveResource</h2>

<p>2.1.0 (May 31st, 2008)*</p>

<p>* Fixed response logging to use length instead of the entire thing (seangeo) [#27]</p>

<p>* Fixed that to_param should be used and honored instead of hardcoding the id #11406 [gspiers]</p>

<p>* Improve documentation. [Radar, Jan De Poorter, chuyeow, xaviershay, danger, miloops, Xavier Noria,  Sunny Ripert]</p>

<p>* Use HEAD instead of GET in exists? [bscofield]</p>

<p>* Fix small documentation typo.  Closes #10670 [l.guidi]</p>

<p>* find_or_create_resource_for handles module nesting.  #10646 [xavier]</p>

<p>* Allow setting ActiveResource::Base#format before #site.  [rick]</p>

<p>* Support agnostic formats when calling custom methods.  Closes #10635 [joerichsen]</p>

<p>* Document custom methods.  #10589 [Cheah Chu Yeow]</p>

<p>* Ruby 1.9 compatibility.  [Jeremy Kemper]</p>

<h2>ActiveSupport</h2>

<p>* TimeZone#to_s shows offset as GMT instead of UTC, because GMT will be more familiar to end users (see time zone selects used by Windows OS, google.com and yahoo.com.) Reverts [8370] [Geoff Buesing]</p>

<p>* Hash.from_xml: datetime xml types overflow to Ruby DateTime class when out of range of Time. Adding tests for utc offsets [Geoff Buesing]</p>

<p>* TimeWithZone #+ and #- : ensure overflow to DateTime with Numeric arg [Geoff Buesing]</p>

<p>* Time#to_json: don't convert to utc before encoding. References #175 [Geoff Buesing]</p>

<p>* Remove unused JSON::RESERVED_WORDS, JSON.valid_identifier? and JSON.reserved_word? methods. Resolves #164. [Cheah Chu Yeow]</p>

<p>* Adding Date.current, which returns Time.zone.today if config.time_zone is set; otherwise returns Date.today [Geoff Buesing]</p>

<p>* TimeWithZone: date part getter methods (#year #mon #day etc) are defined on class; no longer relying on method_missing [Geoff Buesing]</p>

<p>* Time.zone.parse return nil for strings with no date information [Geoff Buesing]</p>

<p>* Time.zone.parse respects offset information in string. Resolves #105. [Scott Fleckenstein, Geoff Buesing]</p>

<p>* Added Ruby 1.8 implementation of Process.daemon</p>

<p>* Duration #since and #ago with no argument (e.g., 5.days.ago) return TimeWithZone when config.time_zone is set. Introducing Time.current, which returns Time.zone.now if config.time_zone is set, otherwise just returns Time.now [Geoff Buesing]</p>

<p>* Time#since behaves correctly when passed a Duration. Closes #11527 [kemiller]</p>

<p>* Add #getutc alias for DateTime#utc [Geoff Buesing]</p>

<p>* Refactor TimeWithZone: don't send #since, #ago, #+, #-, #advance through method_missing [Geoff Buesing]</p>

<p>* TimeWithZone respects config.active_support.use_standard_json_time_format [Geoff Buesing]</p>

<p>* Add config.active_support.escape_html_entities_in_json to allow disabling of html entity escaping.  [rick]</p>

<p>* Improve documentation. [Xavier Noria]</p>

<p>* Modified ActiveSupport::Callbacks::Callback#call to accept multiple arguments.</p>

<p>* Time #yesterday and #tomorrow behave correctly crossing DST boundary. Closes #7399 [sblackstone]</p>

<p>* TimeWithZone: Adding tests for dst and leap day edge cases when advancing time [Geoff Buesing]</p>

<p>* TimeWithZone#method_missing: send to utc to advance with dst correctness, otherwise send to time. Adding tests for time calculations methods [Geoff Buesing]</p>

<p>* Add config.active_support.use_standard_json_time_format setting so that Times and Dates export to ISO 8601 dates.  [rick]</p>

<p>* TZInfo: Removing unneeded TimezoneProxy class [Geoff Buesing]</p>

<p>* TZInfo: Removing unneeded TimezoneIndexDefinition, since we're not including Indexes::Timezones [Geoff Buesing] </p>

<p>* Removing unnecessary uses_tzinfo helper from tests, given that TZInfo is now bundled [Geoff Buesing]</p>

<p>* Bundling abbreviated version of TZInfo gem 0.3.8: only the classes and zone definitions required to support Rails time zone features are included. If a recent version of the full TZInfo gem is installed, this will take precedence over the bundled version [Geoff Buesing]</p>

<p>* TimeWithZone#marshal_load does zone lookup via Time.get_zone, so that tzinfo/Olson identifiers are handled [Geoff Buesing]</p>

<p>* Time.zone= accepts TZInfo::Timezone instances and Olson identifiers; wraps result in TimeZone instance [Geoff Buesing] </p>

<p>* TimeWithZone time conversions don't need to be wrapped in TimeOrDateTime, because TZInfo does this internally [Geoff Buesing]</p>

<p>* TimeWithZone#usec returns 0 instead of error when DateTime is wrapped [Geoff Buesing]</p>

<p>* Improve documentation. [Radar, Jan De Poorter, chuyeow, xaviershay, danger, miloops, Xavier Noria,  Sunny Ripert]</p>

<p>* Ensure that TimeWithZone#to_yaml works when passed a YAML::Emitter.  [rick]</p>

<p>* Ensure correct TimeWithZone#to_date [Geoff Buesing]</p>

<p>* Make TimeWithZone work with tzinfo 0.2.x: use TZInfo::Timezone#zone_identifier alias for #abbreviation, silence warnings on tests. Raise LoadError when TZInfo version is &lt; 0.2 by sniffing for TZInfo::TimeOrDateTime constant. Move all tzinfo-dependent TimeZone tests into uses_tzinfo block [Geoff Buesing]</p>

<p>* Time, DateTime and TimeWithZone #in_time_zone defaults to Time.zone. Removing now unneeded #in_current_time_zone [Geoff Buesing]</p>

<p>* TZInfo caches Timezone instances in its own internal hash cache, so TimeZone::MAPPING doesn't need to cache them as well [Geoff Buesing]</p>

<p>* Adding TimeZone#parse [Geoff Buesing]</p>

<p>* Adding TimeZone#at and DateTime#to_f [Geoff Buesing]</p>

<p>* TimeWithZone responds to Ruby 1.9 weekday-named query methods [Geoff Buesing]</p>

<p>* TimeWithZone caches TZInfo::TimezonePeriod used for time conversion so that it can be reused, and enforces DST rules correctly when instance is created from a local time [Geoff Buesing]</p>

<p>* Fixed that BufferedLogger should create its own directory if one doesn't already exist #11285 [lotswholetime]</p>

<p>* Fix Numeric time tests broken by DST change by anchoring them to fixed times instead of Time.now. Anchor TimeZone#now DST test to time specified with Time.at instead of Time.local to work around platform differences with Time.local and DST representation [Geoff Buesing]</p>

<p>* Removing unneeded #change_time_zone method from Time, DateTime and TimeWithZone [Geoff Buesing]</p>

<p>* TimeZone #local and #now correctly enforce DST rules [Geoff Buesing]</p>

<p>* TimeWithZone instances correctly enforce DST rules. Adding TimeZone#period_for_utc [Geoff Buesing]</p>

<p>* test_time_with_datetime_fallback expects DateTime.local_offset instead of DateTime.now.offset [Geoff Buesing]</p>

<p>* Adding TimeWithZone #marshal_dump and #marshal_load [Geoff Buesing]</p>

<p>* Add OrderedHash#to_hash [josh]</p>

<p>* Adding Time#end_of_day, _quarter, _week, and _year.  #9312 [Juanjo Bazan, Tarmo Tänav, BigTitus]</p>

<p>* Adding TimeWithZone#between? [Geoff Buesing]</p>

<p>* Time.=== returns true for TimeWithZone instances [Geoff Buesing]</p>

<p>* TimeWithZone #+ and #- behave consistently with numeric arguments regardless of whether wrapped time is a Time or DateTime; consistenty answers false to #acts_like?(:date) [Geoff Buesing]</p>

<p>* Add String#squish and String#squish! to remove consecutive chunks of whitespace.  #11123 [jordi, Henrik N]</p>

<p>* Serialize BigDecimals as Floats when using to_yaml. #8746 [ernesto.jimenez]</p>

<p>* Adding TimeWithZone #to_yaml, #to_datetime, #eql? and method aliases for duck-typing compatibility with Time [Geoff Buesing]</p>

<p>* TimeWithZone #in_time_zone returns +self+ if zone argument is the same as #time_zone [Geoff Buesing]</p>

<p>* Adding TimeWithZone #to_a, #to_f, #to_i, #httpdate, #rfc2822 [Geoff Buesing]</p>

<p>* Pruning unneeded TimeWithZone#change_time_zone_to_current [Geoff Buesing]</p>

<p>* Time#zone=, #in_time_zone and #change_time_zone accept a Duration [Geoff Buesing]</p>

<p>* Time#in_time_zone handles Time.local instances correctly [Geoff Buesing]</p>

<p>* Pruning unneeded Time#change_time_zone_to_current. Enhanced docs to #change_time_zone to explain the difference between this method and #in_time_zone [Geoff Buesing]</p>

<p>* TimeZone#new method renamed #local; when used with Time.zone, constructor now reads: Time.zone.local() [Geoff Buesing]</p>

<p>* Added Base64.encode64s to encode values in base64 without the newlines. This makes the values immediately usable as URL parameters or memcache keys without further processing [DHH]</p>

<p>* Remove :nodoc: entries around the ActiveSupport test/unit assertions.  #10946 [dancroak, jamesh]</p>

<p>* Add Time.zone_default accessor for setting the default time zone.  Rails::Configuration.time_zone sets this.  #10982 [Geoff Buesing]</p>

<p>* cache.fetch(key, :force => true) to force a cache miss.  [Jeremy Kemper]</p>

<p>* Support retrieving TimeZones with a Duration.  TimeZone[-28800] == TimeZone[-480.minutes].  [rick]</p>

<p>* TimeWithZone#- added, so that #- can handle a Time or TimeWithZone argument correctly [Geoff Buesing]</p>

<p>* with_timezone test helper renamed with_env_tz, to distinguish between setting ENV['TZ'] and setting Time.zone in tests [Geoff Buesing]</p>

<p>* Time#- coerces TimeWithZone argument to a Time instance so that difference in seconds can be calculated. Closes #10914 [Geoff Buesing, yyyc514]</p>

<p>* Adding UTC zone to TimeZone; TimeWithZone no longer has to fake UTC zone with nil [Geoff Buesing]</p>

<p>* Time.get_zone refactored to private method, given that the encapsulated logic is only useful internally [Geoff Buesing]</p>

<p>* Time.zone uses thread-local variable for thread safety. Adding Time.use_zone, for overriding Time.zone locally inside a block. Removing unneeded Time.zone_reset! [Geoff Buesing]</p>

<p>* TimeZone#to_s uses UTC rather than GMT; reapplying change that was undone in [8679]. #1689 [Cheah Chu Yeow]</p>

<p>* Time.days_in_month defaults to current year if no year is supplied as argument #10799 [Radar], uses Date.gregorian_leap? to determine leap year, and uses constant lookup to determine days in month [Geoff Buesing]<br/>
</p>

<p>* Adding Time and DateTime #compare_with_coercion, which layers behavior on #&lt;=> so that any combination of Time, DateTime and ActiveSupport::TimeWithZone instances can be chronologically compared [Geoff Buesing]</p>

<p>* TimeZone#now returns an ActiveSupport::TimeWithZone [Geoff Buesing]</p>

<p>* Time #in_current_time_zone and #change_time_zone_to_current return self when Time.zone is nil [Geoff Buesing]</p>

<p>* Remove unneeded #to_datetime_default_s alias for DateTime#to_s, given that we inherit a #to_default_s from Date that does exactly the same thing [Geoff Buesing]</p>

<p>* Refactor Time and DateTime #to_formatted_s: use ternary instead of nested if/else [Geoff Buesing]</p>

<p>* Adding Time and DateTime #formatted_offset, for outputting +HH:MM utc offset strings with cross-platform consistency [Geoff Buesing]</p>

<p>* Adding alternate_utc_string option to TimeZone#formatted_offset. Removing unneeded TimeZone#offset. [Geoff Buesing]</p>

<p>* Introduce ActiveSupport::TimeWithZone, for wrapping Time instances with a TimeZone. Introduce instance methods to Time for creating TimeWithZone instances, and class methods for managing a global time zone. [Geoff Buesing]</p>

<p>* Replace non-dst-aware TimeZone class with dst-aware class from tzinfo_timezone plugin. TimeZone#adjust and #unadjust are no longer available; tzinfo gem must now be present in order to perform time zone calculations, via #local_to_utc and #utc_to_local methods. [Geoff Buesing]</p>

<p>* Extract ActiveSupport::Callbacks from Active Record, test case setup and teardown, and ActionController::Dispatcher.  #10727 [Josh Peek]</p>

<p>* Introducing DateTime #utc, #utc? and #utc_offset, for duck-typing compatibility with Time. Closes #10002 [Geoff Buesing]</p>

<p>* Time#to_json uses Numeric#to_utc_offset_s to output a cross-platform-consistent representation without having to convert to DateTime. References #9750 [Geoff Buesing]</p>

<p>* Refactor number-to-HH:MM-string conversion logic from TimeZone#formatted_offset to a reusable Numeric#to_utc_offset_s method. [Geoff Buesing]</p>

<p>* Continue evolution toward ActiveSupport::TestCase.  #10679 [Josh Peek]</p>

<p>* TestCase: introduce declared setup and teardown callbacks. Pass a list of methods and an optional block to call before setup or after teardown. Setup callbacks are run in the order declared; teardown callbacks are run in reverse.  [Jeremy Kemper]</p>

<p>* Added ActiveSupport::Gzip.decompress/compress(source) as an easy wrapper for Zlib [Tobias Luetke]</p>

<p>* Included MemCache-Client to make the improved ActiveSupport::Cache::MemCacheStore work out of the box [Bob Cottrell, Eric Hodel]</p>

<p>* Added ActiveSupport::Cache::* framework as an extraction from ActionController::Caching::Fragments::* [DHH]</p>

<p>* Fixed String#titleize to work for strings with 's too #10571 [trek]</p>

<p>* Changed the implementation of Enumerable#group_by to use a double array approach instead of a hash such that the insert order is honored [DHH/Marcel]</p>

<p>* remove multiple enumerations from ActiveSupport::JSON#convert_json_to_yaml when dealing with date/time values.  [rick]</p>

<p>* Hash#symbolize_keys skips keys that can't be symbolized.  #10500 [Brad Greenlee]</p>

<p>* Ruby 1.9 compatibility.  #1689, #10466, #10468, #10554, #10594, #10632 [Cheah Chu Yeow, Pratik Naik, Jeremy Kemper, Dirkjan Bussink, fxn]</p>

<p>* TimeZone#to_s uses UTC rather than GMT.  #1689 [Cheah Chu Yeow]</p>

<p>* Refactor of Hash#symbolize_keys! to use Hash#replace.  Closes #10420 [ReinH]</p>

<p>* Fix HashWithIndifferentAccess#to_options! so it doesn't clear the options hash.  Closes #10419 [ReinH]</p>

<h2>Railties</h2>

<p>* script/dbconsole fires up the command-line database client.  #102 [Steve Purcell]</p>

<p>* Fix bug where plugin init.rb files from frozen gem specs weren't being run.  (pjb3) [#122 state:resolved]</p>

<p>* Made the location of the routes file configurable with config.routes_configuration_file (Scott Fleckenstein) [#88]</p>

<p>* Rails Edge info returns the latest git commit hash [Francesc Esplugas]</p>

<p>* Added Rails.public_path to control where HTML and assets are expected to be loaded from (defaults to Rails.root + "/public") #11581 [nicksieger]</p>

<p>* rake time:zones:local finds correct base utc offset for zones in the Southern Hemisphere [Geoff Buesing]</p>

<p>* Don't require rails/gem_builder during rails initialization, it's only needed for the gems:build task. [rick]</p>

<p>* script/performance/profiler compatibility with the ruby-prof >= 0.5.0. Closes #9176. [Catfish]</p>

<p>* Flesh out rake gems:unpack to unpack all gems, and add rake gems:build for native extensions. #11513 [ddollar]</p>

<pre class="mac_classic">rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unpack</span>             <span class="Comment"><span class="Comment">#</span> unpacks all gems</span>
rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unpack</span> <span class="Variable">GEM</span><span class="Keyword">=</span>mygem   <span class="Comment"><span class="Comment">#</span> unpacks only the gem 'mygem'</span>

rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>build</span>              <span class="Comment"><span class="Comment">#</span> builds all unpacked gems</span>
rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>build</span> <span class="Variable">GEM</span><span class="Keyword">=</span>mygem    <span class="Comment"><span class="Comment">#</span> builds only the gem 'mygem'</span>
</pre>

<p>* Add config.active_support for future configuration options.  Also, add more new Rails 3 config settings to new_rails_defaults.rb [rick]</p>

<p>* Add Rails.logger, Rails.root, Rails.env and Rails.cache shortcuts for RAILS_* constants [pratik]</p>

<p>* Allow files in plugins to be reloaded like the rest of the application.  [rick]</p>

<p>Enables or disables plugin reloading.</p>

<pre class="mac_classic">config.<span class="FunctionName">reload</span>\_plugins <span class="Keyword">=</span> <span class="BuiltInConstant">true</span>
</pre>

<p>You can get around this setting per plugin.</p>

<p>If #reload_plugins? == false (DEFAULT), add this to your plugin's init.rb to make it reloadable:</p>

<pre class="mac_classic"><span class="LibraryObject">Dependencies</span>.<span class="FunctionName">load_once_paths</span>.<span class="FunctionName">delete</span> lib\_path
</pre>

<p>If #reload_plugins? == true, add this to your plugin's init.rb to only load it once:</p>

<pre class="mac_classic"><span class="LibraryObject">Dependencies</span>.<span class="FunctionName">load_once_paths</span> <span class="Keyword">&lt;&lt;</span> lib_path
</pre>

<p>* Small tweak to allow plugins to specify gem dependencies.  [rick]</p>

<pre class="mac_classic"><span class="Comment"><span class="Comment">#</span> OLD open\_id\_authentication plugin init.rb</span>
<span class="Keyword">require</span> <span class="String"><span class="String">'</span>yadis<span class="String">'</span></span>
<span class="Keyword">require</span> <span class="String"><span class="String">'</span>openid<span class="String">'</span></span>
<span class="LibraryObject">ActionController</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">send</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include</span>, <span class="Variable">OpenIdAuthentication</span>

<span class="Comment"><span class="Comment">#</span> NEW</span>
config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>ruby-openid<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>openid<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">&quot;</span>1.1.4<span class="String">&quot;</span></span>
config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>ruby-yadis<span class="String">&quot;</span></span>,  <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>yadis<span class="String">&quot;</span></span>,  <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">&quot;</span>0.3.4<span class="String">&quot;</span></span>

config.<span class="FunctionName">after_initialize</span> <span class="Keyword">do</span>
    <span class="LibraryObject">ActionController</span>::<span class="FunctionName">Base</span>.<span class="FunctionName">send</span> <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>include</span>, <span class="Variable">OpenIdAuthentication</span>
<span class="Keyword">end</span>
</pre>

<p>* Added config.gem for specifying which gems are required by the application, as well as rake tasks for installing and freezing gems. [rick]</p>

<pre class="mac_classic"><span class="LibraryObject">Rails</span>::<span class="FunctionName">Initializer</span>.<span class="FunctionName">run</span> <span class="Keyword">do </span>|<span class="Variable">config</span>|
    config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>bj<span class="String">&quot;</span></span>
    config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>hpricot<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>version</span> =&gt; <span class="String"><span class="String">'</span>0.6<span class="String">'</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>source</span> =&gt; <span class="String"><span class="String">&quot;</span>http://code.whytheluckystiff.net<span class="String">&quot;</span></span>
    config.<span class="FunctionName">gem</span> <span class="String"><span class="String">&quot;</span>aws-s3<span class="String">&quot;</span></span>, <span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>lib</span> =&gt; <span class="String"><span class="String">&quot;</span>aws/s3<span class="String">&quot;</span></span>
<span class="Keyword">end</span>

<span class="Comment"><span class="Comment">#</span> List required gems.</span>
    rake gems

<span class="Comment"><span class="Comment">#</span> Install all required gems:</span>
    rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>install</span>

<span class="Comment"><span class="Comment">#</span> Unpack specified gem to vendor/gems/gem\_name-x.x.x</span>
    rake gems<span class="UserDefinedConstant"><span class="UserDefinedConstant">:</span>unpack</span> <span class="Variable">GEM</span><span class="Keyword">=</span>bj
</pre>

<p>* Removed the default .htaccess configuration as there are so many good deployment options now (kept it as an example in README) [DHH]</p>

<p>* config.time_zone accepts TZInfo::Timezone identifiers as well as Rails TimeZone identifiers [Geoff Buesing]</p>

<p>* Rails::Initializer#initialize_time_zone raises an error if value assigned to config.time_zone is not recognized. Rake time zone tasks only require ActiveSupport instead of entire environment [Geoff Buesing]</p>

<p>* Stop adding the antiquated test/mocks/* directories and only add them to the path if they're still there for legacy reasons [DHH]</p>

<p>* Added that gems can now be plugins if they include rails/init.rb #11444 [jbarnette]</p>

<p>* Added Plugin#about method to programmatically access the about.yml in a plugin #10979 [lazyatom]</p>

<pre class="mac_classic">plugin <span class="Keyword">=</span> <span class="LibraryObject">Rails</span>::<span class="FunctionName">Plugin</span>.<span class="FunctionName">new</span>(path\_to\_my\_plugin)
plugin.<span class="FunctionName">about</span>[<span class="String"><span class="String">&quot;</span>author<span class="String">&quot;</span></span>] <span class="Comment"><span class="Comment">#</span> =&gt; &quot;James Adam&quot;</span>
plugin.<span class="FunctionName">about</span>[<span class="String"><span class="String">&quot;</span>url<span class="String">&quot;</span></span>] <span class="Comment"><span class="Comment">#</span> =&gt; &quot;http://interblah.net&quot;</span>
</pre>

<p>* Improve documentation. [Radar, Jan De Poorter, chuyeow, xaviershay, danger, miloops, Xavier Noria,  Sunny Ripert]</p>

<p>* Added config.time_zone = 'UTC' in the default environment.rb [Geoff Buesing]</p>

<p>* Added rake tasks time:zones:all, time:zones:us and time:zones:local for finding time zone names for config.time_zone option [Geoff Buesing]</p>

<p>* Add config.time_zone for configuring the default Time.zone value.  #10982 [Geoff Buesing]</p>

<p>* Added support for installing plugins hosted at git repositories #11294 [danger]</p>

<p>* Fixed that script/generate would not look for plugin generators in plugin_paths #11000 [glv]</p>

<p>* Fixed database rake tasks to work with charset/collation and show proper error messages on failure. Closes #11301 [matt]</p>

<p>* Added a -e/--export to script/plugin install, uses svn export. #10847 [jon@blankpad.net)]</p>

<p>* Reshuffle load order so that routes and observers are initialized after plugins and app initializers.  Closes #10980 [rick]</p>

<p>* Git support for script/generate.  #10690 [ssoroka]</p>

<p>* Update scaffold to use labels instead of bold tags.  Closes #10757 [zach-inglis-lt3]</p>

<p>* Resurrect WordNet synonym lookups.  #10710 [tom./, matt]</p>

<p>* Added config.cache_store to environment options to control the default cache store (default is FileStore if tmp/cache is present, otherwise MemoryStore is used) [DHH]</p>

<p>* Added that rails:update is run when you do rails:freeze:edge to ensure you also get the latest JS and config files #10565 [jeff]</p>

<p>* SQLite: db:drop:all doesn't fail silently if the database is already open.  #10577 [Cheah Chu Yeow, mrichman]</p>

<p>* Introduce native mongrel handler and push mutex into dispatcher.  [Jeremy Kemper]</p>

<p>* Ruby 1.9 compatibility.  #1689, #10546 [Cheah Chu Yeow, frederico]</p>

        </div>

        <div class="white_page"></div>
        <div class="white_page"></div>

        <div class="backcover"></div>
</body>
</html>
